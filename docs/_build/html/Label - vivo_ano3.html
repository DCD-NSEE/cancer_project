

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Introduction &mdash; Cancer Project Documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introduction" href="Label%20-%20vivo_ano5.html" />
    <link rel="prev" title="Introduction" href="Label%20-%20vivo_ano1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cancer Project
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Libraries and functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html"><strong>Data Dictionary</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#Libraries"><strong>Libraries</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#Functions"><strong>Functions</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#References"><strong>References</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models.html"><strong>Reading the data</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models.html#Data-analysis"><strong>Data analysis</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models.html#Creating-new-columns"><strong>Creating new columns</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification obito_geral</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html#Third-approach"><strong>Third approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html#Fourth-approach"><strong>Fourth approach</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification obito_cancer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_cancer.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_cancer.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_cancer.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_cancer.html#Third-approach"><strong>Third approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_cancer.html#Fourth-approach"><strong>Fourth approach</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification vivo_ano1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Third-approach"><strong>Third approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Fourth-approach"><strong>Fourth approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Fifth-approach"><strong>Fifth approach</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification vivo_ano3</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="#First-approach"><strong>First approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Preprocessing"><strong>Preprocessing</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Training-machine-learning-models"><strong>Training machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost"><strong>XGBoost</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Second-approach"><strong>Second approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1"><strong>Preprocessing</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2"><strong>Training machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4"><strong>XGBoost</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Third-approach"><strong>Third approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id5"><strong>Preprocessing</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6"><strong>Training machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8"><strong>XGBoost</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Fourth-approach"><strong>Fourth approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id9"><strong>Preprocessing</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#SP"><strong>SP</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Other-states"><strong>Other states</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Training-and-evaluation-of-the-models"><strong>Training and evaluation of the models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11"><strong>XGBoost</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Testing-models-with-data-from-other-years"><strong>Testing models with data from other years</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-SP-for-years-2000-to-2003"><strong>Random Forest SP for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-SP-for-years-2000-to-2003"><strong>XGBoost SP for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-SP-for-years-2004-to-2007"><strong>Random Forest SP for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-SP-for-years-2004-to-2007"><strong>XGBoost SP for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-SP-for-years-2008-to-2011"><strong>Random Forest SP for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-SP-for-years-2008-to-2011"><strong>XGBoost SP for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-SP-for-years-2012-to-2015"><strong>Random Forest SP for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-SP-for-years-2012-to-2015"><strong>XGBoost SP for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Other-states-for-years-2000-to-2003"><strong>Random Forest Other states for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Other-states-for-years-2000-to-2003"><strong>XGBoost Other states for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Other-states-for-years-2004-to-2007"><strong>Random Forest Other states for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Other-states-for-years-2004-to-2007"><strong>XGBoost Other states for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Other-states-for-years-2008-to-2011"><strong>Random Forest Other states for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Other-states-for-years-2008-to-2011"><strong>XGBoost Other states for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Other-states-for-years-2012-to-2015"><strong>Random Forest Other states for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Other-states-for-years-2012-to-2015"><strong>XGBoost Other states for years 2012 to 2015</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Fifth-approach"><strong>Fifth approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id12"><strong>Preprocessing</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13"><strong>SP</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14"><strong>Other states</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id15"><strong>Training and evaluation of the models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17"><strong>XGBoost</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id18"><strong>Testing models with data from other years</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id19"><strong>Random Forest SP for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20"><strong>XGBoost SP for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21"><strong>Random Forest SP for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22"><strong>XGBoost SP for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23"><strong>Random Forest SP for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24"><strong>XGBoost SP for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25"><strong>Random Forest SP for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26"><strong>XGBoost SP for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27"><strong>Random Forest Other states for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28"><strong>XGBoost Other states for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29"><strong>Random Forest Other states for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id30"><strong>XGBoost Other states for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31"><strong>Random Forest Other states for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32"><strong>XGBoost Other states for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id33"><strong>Random Forest Other states for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id34"><strong>XGBoost Other states for years 2012 to 2015</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification vivo_ano5</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Third-approach"><strong>Third approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Fourth-approach"><strong>Fourth approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Fifth-approach"><strong>Fifth approach</strong></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cancer Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><strong>Introduction</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Label - vivo_ano3.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Introduction">
<h1><strong>Introduction</strong><a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h1>
<p>In this section, two machine learning models will be used to classify the <code class="docutils literal notranslate"><span class="pre">vivo_ano3</span></code> column, Random Forest and XGBoost, for both datasets, São Paulo and other states.</p>
<p>The label is 1 if the patient is alive after three years of treatment and 0 if not.</p>
<p>The first approach is using the “raw data”, the second is without the <code class="docutils literal notranslate"><span class="pre">EC</span></code> column, the third one is without <code class="docutils literal notranslate"><span class="pre">EC</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, the fourth is using the grouped years and without the column <code class="docutils literal notranslate"><span class="pre">EC</span></code> and the fifth is also with the years gruped and without <code class="docutils literal notranslate"><span class="pre">EC</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>.</p>
<p>The years will be grouped as follows: 2000 to 2003, 2004 to 2007, 2008 to 2011, 2012 to 2015 and 2016 until the end. So we will have 5 datasets for SP and another 5 for other states.</p>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the columns <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code> will not be used in this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 77)
(32891, 77)
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano3&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano3       1.000000
ULTIDIAG        0.746404
ULTICONS        0.740191
ULTITRAT        0.737903
vivo_ano5       0.688613
vivo_ano1       0.550659
obito_cancer    0.403906
obito_geral     0.365068
HORMONIO        0.236603
CIRURGIA        0.215579
MORFO           0.208184
ANODIAG         0.201279
ULTINFO         0.189965
QUIMIO          0.116880
G               0.103949
CLINICA         0.100960
DIAGTRAT        0.093799
SEXO            0.067311
TRATCONS        0.058532
CATEATEND       0.055419
Name: vivo_ano3, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano3&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano3       1.000000
ULTIDIAG        0.759271
ULTICONS        0.753968
ULTITRAT        0.749534
vivo_ano5       0.667262
vivo_ano1       0.547481
obito_cancer    0.399038
obito_geral     0.385518
ANODIAG         0.258962
CIRURGIA        0.235109
ULTINFO         0.218422
HORMONIO        0.215508
MORFO           0.186335
CATEATEND       0.139831
QUIMIO          0.120061
TRATCONS        0.116820
DIAGTRAT        0.113094
RECLOCAL        0.060846
RECNENHUM       0.059315
SEXO            0.059252
Name: vivo_ano3, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, it is clear that there is an imbalance, similar to the previous classification.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">vivo_ano3</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    260942
1    245095
Name: vivo_ano3, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">vivo_ano3</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    17264
1    15627
Name: vivo_ano3, dtype: int64
</pre></div></div>
</div>
<p>Years of diagnosis present in the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020])
</pre></div></div>
</div>
<p>Before dividing the datasets, it is necessary to select only the patients who have been followed up for at least three years.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP_ano3</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_SP</span><span class="o">.</span><span class="n">obito_geral</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">vivo_ano3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_SP_ano3</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(409182, 77)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other States</span>
<span class="n">df_fora_ano3</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_fora</span><span class="o">.</span><span class="n">obito_geral</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">vivo_ano3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_fora_ano3</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(25280, 77)
</pre></div></div>
</div>
</div>
<div class="section" id="First-approach">
<h1><strong>First approach</strong><a class="headerlink" href="#First-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with “raw data”.</p>
<div class="section" id="Preprocessing">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#Preprocessing" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the datasets: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;obito_geral&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_cancer&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">]</span>

<span class="c1"># &#39;RECNENHUM&#39;, &#39;RECLOCAL&#39;, &#39;RECREGIO&#39;, &#39;REC01&#39;, &#39;REC02&#39;, &#39;REC03&#39;, &#39;RECDIST&#39;</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano3&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (306886, 66), X_test = (102296, 66)
y_train = (306886,), y_test = (102296,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (18960, 66), X_test = (6320, 66)
y_train = (18960,), y_test = (6320,)
</pre></div></div>
</div>
</div>
<div class="section" id="Training-machine-learning-models">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#Training-machine-learning-models" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="Random-Forest">
<h3><strong>Random Forest</strong><a class="headerlink" href="#Random-Forest" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test the parameter <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was also used, because the model has difficulty learning the class with fewer examples, so using this parameter this class will have a higher weight in the training of the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.557</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                               <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                               <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.557, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_30_0.png" src="_images/Label_-_vivo_ano3_30_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.81      0.77     41022
           1       0.86      0.81      0.83     61274

    accuracy                           0.81    102296
   macro avg       0.80      0.81      0.80    102296
weighted avg       0.81      0.81      0.81    102296

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_32_0.png" src="_images/Label_-_vivo_ano3_32_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_33_0.png" src="_images/Label_-_vivo_ano3_33_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_34_0.png" src="_images/Label_-_vivo_ano3_34_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_36_0.png" src="_images/Label_-_vivo_ano3_36_0.png" />
</div>
</div>
<p>Note that larger values of the EC column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.967</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                 <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.967, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_39_0.png" src="_images/Label_-_vivo_ano3_39_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.82      0.78      2451
           1       0.88      0.82      0.85      3869

    accuracy                           0.82      6320
   macro avg       0.81      0.82      0.81      6320
weighted avg       0.82      0.82      0.82      6320

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm, with other states data, shows a good performance of the model, because the model achieves a 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_41_0.png" src="_images/Label_-_vivo_ano3_41_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_42_0.png" src="_images/Label_-_vivo_ano3_42_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_43_0.png" src="_images/Label_-_vivo_ano3_43_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_45_0.png" src="_images/Label_-_vivo_ano3_45_0.png" />
</div>
</div>
<p>Note that larger values of the EC column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="XGBoost">
<h3><strong>XGBoost</strong><a class="headerlink" href="#XGBoost" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A higher weight was also used for the class with fewer examples, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                               <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.65)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_50_0.png" src="_images/Label_-_vivo_ano3_50_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.77      0.83      0.80     41022
           1       0.88      0.83      0.85     61274

    accuracy                           0.83    102296
   macro avg       0.82      0.83      0.83    102296
weighted avg       0.83      0.83      0.83    102296

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_52_0.png" src="_images/Label_-_vivo_ano3_52_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_53_0.png" src="_images/Label_-_vivo_ano3_53_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_55_0.png" src="_images/Label_-_vivo_ano3_55_0.png" />
</div>
</div>
<p>Note that larger values of the EC column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.491</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=8, random_state=10, scale_pos_weight=0.491)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_58_0.png" src="_images/Label_-_vivo_ano3_58_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.76      0.83      0.79      2451
           1       0.89      0.83      0.86      3869

    accuracy                           0.83      6320
   macro avg       0.82      0.83      0.83      6320
weighted avg       0.84      0.83      0.83      6320

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm, with other states data, shows a good performance of the model, because the model achieves a 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_60_0.png" src="_images/Label_-_vivo_ano3_60_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_61_0.png" src="_images/Label_-_vivo_ano3_61_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_63_0.png" src="_images/Label_-_vivo_ano3_63_0.png" />
</div>
</div>
<p>Note that larger values of the EC column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
</div>
<div class="section" id="Second-approach">
<h1><strong>Second approach</strong><a class="headerlink" href="#Second-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach without column <code class="docutils literal notranslate"><span class="pre">EC</span></code> as a feature.</p>
<div class="section" id="id1">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the datasets: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;obito_geral&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_cancer&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">]</span>

<span class="c1"># &#39;RECNENHUM&#39;, &#39;RECLOCAL&#39;, &#39;RECREGIO&#39;, &#39;REC01&#39;, &#39;REC02&#39;, &#39;REC03&#39;, &#39;RECDIST&#39;</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano3&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (306886, 65), X_test = (102296, 65)
y_train = (306886,), y_test = (102296,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (18960, 65), X_test = (6320, 65)
y_train = (18960,), y_test = (6320,)
</pre></div></div>
</div>
</div>
<div class="section" id="id2">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id3">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test the parameter <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was also used, because the model has difficulty learning the class with fewer examples, so using this parameter this class will have a higher weight in the training of the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.548</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                               <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                               <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.548, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_80_0.png" src="_images/Label_-_vivo_ano3_80_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.81      0.77     41022
           1       0.86      0.81      0.83     61274

    accuracy                           0.81    102296
   macro avg       0.80      0.81      0.80    102296
weighted avg       0.81      0.81      0.81    102296

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_82_0.png" src="_images/Label_-_vivo_ano3_82_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_83_0.png" src="_images/Label_-_vivo_ano3_83_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_84_0.png" src="_images/Label_-_vivo_ano3_84_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_86_0.png" src="_images/Label_-_vivo_ano3_86_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.08</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                 <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.08, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_89_0.png" src="_images/Label_-_vivo_ano3_89_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.82      0.78      2451
           1       0.88      0.82      0.85      3869

    accuracy                           0.82      6320
   macro avg       0.81      0.82      0.81      6320
weighted avg       0.83      0.82      0.82      6320

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm, with other states data, shows a good performance of the model, because the model achieves a 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_91_0.png" src="_images/Label_-_vivo_ano3_91_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_92_0.png" src="_images/Label_-_vivo_ano3_92_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_93_0.png" src="_images/Label_-_vivo_ano3_93_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_95_0.png" src="_images/Label_-_vivo_ano3_95_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="id4">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A higher weight was also used for the class with fewer examples, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                               <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.645</span><span class="p">,</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.645)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_100_0.png" src="_images/Label_-_vivo_ano3_100_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.77      0.83      0.80     41022
           1       0.88      0.83      0.85     61274

    accuracy                           0.83    102296
   macro avg       0.82      0.83      0.83    102296
weighted avg       0.83      0.83      0.83    102296

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_102_0.png" src="_images/Label_-_vivo_ano3_102_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_103_0.png" src="_images/Label_-_vivo_ano3_103_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_105_0.png" src="_images/Label_-_vivo_ano3_105_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.4)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_108_0.png" src="_images/Label_-_vivo_ano3_108_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.76      0.83      0.79      2451
           1       0.89      0.83      0.86      3869

    accuracy                           0.83      6320
   macro avg       0.82      0.83      0.83      6320
weighted avg       0.84      0.83      0.83      6320

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm, with other states data, shows a good performance of the model, because the model achieves a 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_110_0.png" src="_images/Label_-_vivo_ano3_110_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_111_0.png" src="_images/Label_-_vivo_ano3_111_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_113_0.png" src="_images/Label_-_vivo_ano3_113_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
</div>
<div class="section" id="Third-approach">
<h1><strong>Third approach</strong><a class="headerlink" href="#Third-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach without columns <code class="docutils literal notranslate"><span class="pre">EC</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code> as features.</p>
<div class="section" id="id5">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the datasets: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;obito_geral&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_cancer&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;HORMONIO&#39;</span><span class="p">]</span>

<span class="c1"># &#39;RECNENHUM&#39;, &#39;RECLOCAL&#39;, &#39;RECREGIO&#39;, &#39;REC01&#39;, &#39;REC02&#39;, &#39;REC03&#39;, &#39;RECDIST&#39;</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano3&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (306886, 64), X_test = (102296, 64)
y_train = (306886,), y_test = (102296,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (18960, 64), X_test = (6320, 64)
y_train = (18960,), y_test = (6320,)
</pre></div></div>
</div>
</div>
<div class="section" id="id6">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id7">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test the parameter <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was also used, because the model has difficulty learning the class with fewer examples, so using this parameter this class will have a higher weight in the training of the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.55</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                               <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                               <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.55, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_130_0.png" src="_images/Label_-_vivo_ano3_130_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.81      0.77     41022
           1       0.86      0.81      0.83     61274

    accuracy                           0.81    102296
   macro avg       0.80      0.81      0.80    102296
weighted avg       0.81      0.81      0.81    102296

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_132_0.png" src="_images/Label_-_vivo_ano3_132_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_133_0.png" src="_images/Label_-_vivo_ano3_133_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_134_0.png" src="_images/Label_-_vivo_ano3_134_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_136_0.png" src="_images/Label_-_vivo_ano3_136_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.13</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                 <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.13, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_139_0.png" src="_images/Label_-_vivo_ano3_139_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.82      0.78      2451
           1       0.88      0.82      0.85      3869

    accuracy                           0.82      6320
   macro avg       0.81      0.82      0.81      6320
weighted avg       0.83      0.82      0.82      6320

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm, with other states data, shows a good performance of the model, because the model achieves a 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_141_0.png" src="_images/Label_-_vivo_ano3_141_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_142_0.png" src="_images/Label_-_vivo_ano3_142_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_143_0.png" src="_images/Label_-_vivo_ano3_143_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_145_0.png" src="_images/Label_-_vivo_ano3_145_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="id8">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A higher weight was also used for the class with fewer examples, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                               <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.635</span><span class="p">,</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.635)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_150_0.png" src="_images/Label_-_vivo_ano3_150_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.77      0.83      0.80     41022
           1       0.88      0.83      0.85     61274

    accuracy                           0.83    102296
   macro avg       0.82      0.83      0.83    102296
weighted avg       0.83      0.83      0.83    102296

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_152_0.png" src="_images/Label_-_vivo_ano3_152_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_153_0.png" src="_images/Label_-_vivo_ano3_153_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATAMENTO</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_155_0.png" src="_images/Label_-_vivo_ano3_155_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.477</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=8, random_state=10, scale_pos_weight=0.477)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_158_0.png" src="_images/Label_-_vivo_ano3_158_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.76      0.83      0.80      2451
           1       0.89      0.83      0.86      3869

    accuracy                           0.83      6320
   macro avg       0.82      0.83      0.83      6320
weighted avg       0.84      0.83      0.84      6320

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm, with other states data, shows a good performance of the model, because the model achieves a 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_160_0.png" src="_images/Label_-_vivo_ano3_160_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_161_0.png" src="_images/Label_-_vivo_ano3_161_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATAMENTO</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_163_0.png" src="_images/Label_-_vivo_ano3_163_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
</div>
<div class="section" id="Fourth-approach">
<h1><strong>Fourth approach</strong><a class="headerlink" href="#Fourth-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with grouped years and without the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>.</p>
<div class="section" id="id9">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation. We will use the years grouped too, resulting in 5 datasets for SP and more 5 for other states.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the datasets: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;obito_geral&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_cancer&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;EC&#39;</span><span class="p">]</span>

<span class="c1"># &#39;RECNENHUM&#39;, &#39;RECLOCAL&#39;, &#39;RECREGIO&#39;, &#39;REC01&#39;, &#39;REC02&#39;, &#39;REC03&#39;, &#39;RECDIST&#39;</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano3&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<p>The process will be done 5 times for SP and other states, using the datasets with grouped years.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="SP">
<h3><strong>SP</strong><a class="headerlink" href="#SP" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (45987, 65), X_test = (15329, 65)
y_train = (45987,), y_test = (15329,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (57801, 65), X_test = (19267, 65)
y_train = (57801,), y_test = (19267,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2011</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (77655, 65), X_test = (25886, 65)
y_train = (77655,), y_test = (25886,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (89562, 65), X_test = (29854, 65)
y_train = (89562,), y_test = (29854,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2016</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2021</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (35880, 65), X_test = (11961, 65)
y_train = (35880,), y_test = (11961,)
</pre></div></div>
</div>
</div>
<div class="section" id="Other-states">
<h3><strong>Other states</strong><a class="headerlink" href="#Other-states" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2631, 65), X_test = (877, 65)
y_train = (2631,), y_test = (877,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3652, 65), X_test = (1218, 65)
y_train = (3652,), y_test = (1218,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2011</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (4387, 65), X_test = (1463, 65)
y_train = (4387,), y_test = (1463,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (5346, 65), X_test = (1782, 65)
y_train = (5346,), y_test = (1782,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2016</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2943, 65), X_test = (981, 65)
y_train = (2943,), y_test = (981,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Training-and-evaluation-of-the-models">
<h2><strong>Training and evaluation of the models</strong><a class="headerlink" href="#Training-and-evaluation-of-the-models" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id10">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>The first model is the Random Forest, the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used because the models have difficulty to learn the class with fewer examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">rf_sp_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.427</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.427, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_189_0.png" src="_images/Label_-_vivo_ano3_189_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.75      0.80      0.77      6561
           1       0.84      0.80      0.82      8768

    accuracy                           0.80     15329
   macro avg       0.79      0.80      0.80     15329
weighted avg       0.80      0.80      0.80     15329

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2000 to 2003, shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_191_0.png" src="_images/Label_-_vivo_ano3_191_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_192_0.png" src="_images/Label_-_vivo_ano3_192_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_193_0.png" src="_images/Label_-_vivo_ano3_193_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>, and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_195_0.png" src="_images/Label_-_vivo_ano3_195_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">rf_sp_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.565</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.565, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_198_0.png" src="_images/Label_-_vivo_ano3_198_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.80      0.76      7502
           1       0.86      0.80      0.83     11765

    accuracy                           0.80     19267
   macro avg       0.79      0.80      0.79     19267
weighted avg       0.81      0.80      0.80     19267

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2004 to 2007, shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_200_0.png" src="_images/Label_-_vivo_ano3_200_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_201_0.png" src="_images/Label_-_vivo_ano3_201_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_202_0.png" src="_images/Label_-_vivo_ano3_202_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_204_0.png" src="_images/Label_-_vivo_ano3_204_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">rf_sp_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.798</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.798, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_207_0.png" src="_images/Label_-_vivo_ano3_207_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.81      0.76      9519
           1       0.88      0.81      0.85     16367

    accuracy                           0.81     25886
   macro avg       0.80      0.81      0.81     25886
weighted avg       0.82      0.81      0.82     25886

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2008 to 2011, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_209_0.png" src="_images/Label_-_vivo_ano3_209_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_210_0.png" src="_images/Label_-_vivo_ano3_210_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_211_0.png" src="_images/Label_-_vivo_ano3_211_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_213_0.png" src="_images/Label_-_vivo_ano3_213_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">rf_sp_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.05, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_216_0.png" src="_images/Label_-_vivo_ano3_216_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.71      0.81      0.76     10609
           1       0.89      0.81      0.85     19245

    accuracy                           0.81     29854
   macro avg       0.80      0.81      0.80     29854
weighted avg       0.82      0.81      0.82     29854

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2012 to 2015, shows a good performance of the model with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_218_0.png" src="_images/Label_-_vivo_ano3_218_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_219_0.png" src="_images/Label_-_vivo_ano3_219_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_220_0.png" src="_images/Label_-_vivo_ano3_220_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_222_0.png" src="_images/Label_-_vivo_ano3_222_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">rf_sp_16_21</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.196</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.196}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_225_0.png" src="_images/Label_-_vivo_ano3_225_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.87      0.83      0.85      6750
           1       0.80      0.83      0.81      5211

    accuracy                           0.83     11961
   macro avg       0.83      0.83      0.83     11961
weighted avg       0.84      0.83      0.83     11961

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2016 to 2021, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_227_0.png" src="_images/Label_-_vivo_ano3_227_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_228_0.png" src="_images/Label_-_vivo_ano3_228_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_229_0.png" src="_images/Label_-_vivo_ano3_229_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_231_0.png" src="_images/Label_-_vivo_ano3_231_0.png" />
</div>
</div>
<p>Note that larger values of the ANODIAG column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">rf_fora_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.22</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.22, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_235_0.png" src="_images/Label_-_vivo_ano3_235_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.68      0.78      0.72       327
           1       0.85      0.78      0.81       550

    accuracy                           0.78       877
   macro avg       0.76      0.78      0.77       877
weighted avg       0.79      0.78      0.78       877

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2000 to 2003, also shows a good performance of the model, and we have a balanced main diagonal with 78% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_237_0.png" src="_images/Label_-_vivo_ano3_237_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_238_0.png" src="_images/Label_-_vivo_ano3_238_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_239_0.png" src="_images/Label_-_vivo_ano3_239_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_241_0.png" src="_images/Label_-_vivo_ano3_241_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">rf_fora_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.89</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.89, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_244_0.png" src="_images/Label_-_vivo_ano3_244_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.82      0.77       445
           1       0.89      0.82      0.85       773

    accuracy                           0.82      1218
   macro avg       0.80      0.82      0.81      1218
weighted avg       0.82      0.82      0.82      1218

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2004 to 2007, also shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_246_0.png" src="_images/Label_-_vivo_ano3_246_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_247_0.png" src="_images/Label_-_vivo_ano3_247_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_248_0.png" src="_images/Label_-_vivo_ano3_248_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_250_0.png" src="_images/Label_-_vivo_ano3_250_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">rf_fora_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.5452</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.5452, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_253_0.png" src="_images/Label_-_vivo_ano3_253_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.71      0.82      0.76       517
           1       0.89      0.82      0.85       946

    accuracy                           0.82      1463
   macro avg       0.80      0.82      0.80      1463
weighted avg       0.83      0.82      0.82      1463

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2008 to 2011, also shows a good performance of the model, presenting 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_255_0.png" src="_images/Label_-_vivo_ano3_255_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_256_0.png" src="_images/Label_-_vivo_ano3_256_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_257_0.png" src="_images/Label_-_vivo_ano3_257_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_259_0.png" src="_images/Label_-_vivo_ano3_259_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">rf_fora_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.995</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.995, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_262_0.png" src="_images/Label_-_vivo_ano3_262_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.81      0.75       592
           1       0.90      0.82      0.86      1190

    accuracy                           0.82      1782
   macro avg       0.79      0.82      0.80      1782
weighted avg       0.83      0.82      0.82      1782

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2012 to 2015, also shows a good performance of the model, presenting 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_264_0.png" src="_images/Label_-_vivo_ano3_264_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_265_0.png" src="_images/Label_-_vivo_ano3_265_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_266_0.png" src="_images/Label_-_vivo_ano3_266_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_268_0.png" src="_images/Label_-_vivo_ano3_268_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">rf_fora_16_20</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.29</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.29}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_271_0.png" src="_images/Label_-_vivo_ano3_271_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.85      0.87       562
           1       0.81      0.85      0.83       419

    accuracy                           0.85       981
   macro avg       0.85      0.85      0.85       981
weighted avg       0.85      0.85      0.85       981

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2016 to 2020, also shows a good performance of the model, presenting 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_273_0.png" src="_images/Label_-_vivo_ano3_273_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_274_0.png" src="_images/Label_-_vivo_ano3_274_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_275_0.png" src="_images/Label_-_vivo_ano3_275_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_277_0.png" src="_images/Label_-_vivo_ano3_277_0.png" />
</div>
</div>
<p>Note that larger values of the ANODIAG column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="id11">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost models follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. The hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> was also used in some trainings, in order to obtain a balanced main diagonal in the confusion matrix.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">xgb_sp_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.645</span><span class="p">)</span>

<span class="n">xgb_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.645)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_283_0.png" src="_images/Label_-_vivo_ano3_283_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.76      0.81      0.79      6561
           1       0.85      0.81      0.83      8768

    accuracy                           0.81     15329
   macro avg       0.81      0.81      0.81     15329
weighted avg       0.81      0.81      0.81     15329

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2000 to 2003, shows a good performance of the model, here with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_285_0.png" src="_images/Label_-_vivo_ano3_285_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_286_0.png" src="_images/Label_-_vivo_ano3_286_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_288_0.png" src="_images/Label_-_vivo_ano3_288_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">xgb_sp_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.62</span><span class="p">)</span>

<span class="n">xgb_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.62)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_291_0.png" src="_images/Label_-_vivo_ano3_291_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.82      0.78      7502
           1       0.87      0.82      0.84     11765

    accuracy                           0.82     19267
   macro avg       0.81      0.82      0.81     19267
weighted avg       0.82      0.82      0.82     19267

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2004 to 2007, shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_293_0.png" src="_images/Label_-_vivo_ano3_293_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_294_0.png" src="_images/Label_-_vivo_ano3_294_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with some advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_296_0.png" src="_images/Label_-_vivo_ano3_296_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">xgb_sp_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.505</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.505)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_299_0.png" src="_images/Label_-_vivo_ano3_299_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.83      0.79      9519
           1       0.90      0.83      0.86     16367

    accuracy                           0.83     25886
   macro avg       0.82      0.83      0.82     25886
weighted avg       0.84      0.83      0.83     25886

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2008 to 2011, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_301_0.png" src="_images/Label_-_vivo_ano3_301_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_302_0.png" src="_images/Label_-_vivo_ano3_302_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_304_0.png" src="_images/Label_-_vivo_ano3_304_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">xgb_sp_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.47</span><span class="p">)</span>

<span class="n">xgb_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.47)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_307_0.png" src="_images/Label_-_vivo_ano3_307_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.83      0.77     10609
           1       0.90      0.83      0.86     19245

    accuracy                           0.83     29854
   macro avg       0.81      0.83      0.82     29854
weighted avg       0.84      0.83      0.83     29854

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2012 to 2015, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_309_0.png" src="_images/Label_-_vivo_ano3_309_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_310_0.png" src="_images/Label_-_vivo_ano3_310_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. Following we have <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_312_0.png" src="_images/Label_-_vivo_ano3_312_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">xgb_sp_16_21</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.199</span><span class="p">)</span>

<span class="n">xgb_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.199)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_315_0.png" src="_images/Label_-_vivo_ano3_315_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.85      0.87      6750
           1       0.82      0.85      0.83      5211

    accuracy                           0.85     11961
   macro avg       0.85      0.85      0.85     11961
weighted avg       0.85      0.85      0.85     11961

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2016 to 2021, shows a good performance of the model, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_317_0.png" src="_images/Label_-_vivo_ano3_317_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_318_0.png" src="_images/Label_-_vivo_ano3_318_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">RECDIST</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_320_0.png" src="_images/Label_-_vivo_ano3_320_0.png" />
</div>
</div>
<p>Note that larger values of the ANODIAG column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">xgb_fora_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.392</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=0.392)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_324_0.png" src="_images/Label_-_vivo_ano3_324_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.79      0.74       327
           1       0.86      0.79      0.82       550

    accuracy                           0.79       877
   macro avg       0.78      0.79      0.78       877
weighted avg       0.80      0.79      0.79       877

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2000 to 2003, also shows a good performance of the model, with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_326_0.png" src="_images/Label_-_vivo_ano3_326_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_327_0.png" src="_images/Label_-_vivo_ano3_327_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TRATHOSP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_329_0.png" src="_images/Label_-_vivo_ano3_329_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">xgb_fora_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.475</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=0.475)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_332_0.png" src="_images/Label_-_vivo_ano3_332_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.83      0.78       445
           1       0.89      0.83      0.86       773

    accuracy                           0.83      1218
   macro avg       0.81      0.83      0.82      1218
weighted avg       0.84      0.83      0.83      1218

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2004 to 2007, also shows a good performance of the model with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_334_0.png" src="_images/Label_-_vivo_ano3_334_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_335_0.png" src="_images/Label_-_vivo_ano3_335_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_337_0.png" src="_images/Label_-_vivo_ano3_337_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">xgb_fora_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.415</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=0.415)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_340_0.png" src="_images/Label_-_vivo_ano3_340_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.81      0.75       517
           1       0.89      0.81      0.85       946

    accuracy                           0.81      1463
   macro avg       0.80      0.81      0.80      1463
weighted avg       0.82      0.81      0.82      1463

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2008 to 2011, also shows a good performance of the model with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_342_0.png" src="_images/Label_-_vivo_ano3_342_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_343_0.png" src="_images/Label_-_vivo_ano3_343_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_345_0.png" src="_images/Label_-_vivo_ano3_345_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">xgb_fora_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=0.32)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_348_0.png" src="_images/Label_-_vivo_ano3_348_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.82      0.75       592
           1       0.90      0.82      0.86      1190

    accuracy                           0.82      1782
   macro avg       0.80      0.82      0.81      1782
weighted avg       0.83      0.82      0.83      1782

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2012 to 2015, also shows a good performance of the model with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_350_0.png" src="_images/Label_-_vivo_ano3_350_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_351_0.png" src="_images/Label_-_vivo_ano3_351_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_353_0.png" src="_images/Label_-_vivo_ano3_353_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">xgb_fora_16_20</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.111</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=1.111)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_356_0.png" src="_images/Label_-_vivo_ano3_356_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.85      0.87       562
           1       0.81      0.85      0.83       419

    accuracy                           0.85       981
   macro avg       0.85      0.85      0.85       981
weighted avg       0.85      0.85      0.85       981

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2016 to 2020, shows the best performance comparing with the other models, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_358_0.png" src="_images/Label_-_vivo_ano3_358_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_359_0.png" src="_images/Label_-_vivo_ano3_359_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_361_0.png" src="_images/Label_-_vivo_ano3_361_0.png" />
</div>
</div>
<p>Note that larger values of the ANODIAG column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
<div class="section" id="Testing-models-with-data-from-other-years">
<h2><strong>Testing models with data from other years</strong><a class="headerlink" href="#Testing-models-with-data-from-other-years" title="Permalink to this headline">¶</a></h2>
<p>We will use test data from the following years in the trained models for each set of years grouped together.</p>
<div class="section" id="Random-Forest-SP-for-years-2000-to-2003">
<h3><strong>Random Forest SP for years 2000 to 2003</strong><a class="headerlink" href="#Random-Forest-SP-for-years-2000-to-2003" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_366_0.png" src="_images/Label_-_vivo_ano3_366_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.79      0.75      7502
           1       0.86      0.80      0.83     11765

    accuracy                           0.80     19267
   macro avg       0.79      0.80      0.79     19267
weighted avg       0.80      0.80      0.80     19267

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_367_0.png" src="_images/Label_-_vivo_ano3_367_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.71      0.77      0.74      9519
           1       0.86      0.82      0.84     16367

    accuracy                           0.80     25886
   macro avg       0.79      0.80      0.79     25886
weighted avg       0.81      0.80      0.80     25886

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_368_0.png" src="_images/Label_-_vivo_ano3_368_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.78      0.73     10609
           1       0.87      0.81      0.84     19245

    accuracy                           0.80     29854
   macro avg       0.78      0.80      0.79     29854
weighted avg       0.81      0.80      0.80     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_369_0.png" src="_images/Label_-_vivo_ano3_369_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.78      0.81      6750
           1       0.74      0.79      0.76      5211

    accuracy                           0.79     11961
   macro avg       0.78      0.79      0.78     11961
weighted avg       0.79      0.79      0.79     11961

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-SP-for-years-2000-to-2003">
<h3><strong>XGBoost SP for years 2000 to 2003</strong><a class="headerlink" href="#XGBoost-SP-for-years-2000-to-2003" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_371_0.png" src="_images/Label_-_vivo_ano3_371_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.77      0.75      7502
           1       0.85      0.83      0.84     11765

    accuracy                           0.80     19267
   macro avg       0.79      0.80      0.80     19267
weighted avg       0.81      0.80      0.81     19267

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_372_0.png" src="_images/Label_-_vivo_ano3_372_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.73      0.74      0.74      9519
           1       0.85      0.84      0.85     16367

    accuracy                           0.81     25886
   macro avg       0.79      0.79      0.79     25886
weighted avg       0.81      0.81      0.81     25886

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_373_0.png" src="_images/Label_-_vivo_ano3_373_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.72      0.71     10609
           1       0.84      0.83      0.84     19245

    accuracy                           0.79     29854
   macro avg       0.77      0.78      0.78     29854
weighted avg       0.79      0.79      0.79     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_374_0.png" src="_images/Label_-_vivo_ano3_374_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.74      0.78      6750
           1       0.70      0.80      0.75      5211

    accuracy                           0.77     11961
   macro avg       0.77      0.77      0.77     11961
weighted avg       0.77      0.77      0.77     11961

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-SP-for-years-2004-to-2007">
<h3><strong>Random Forest SP for years 2004 to 2007</strong><a class="headerlink" href="#Random-Forest-SP-for-years-2004-to-2007" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_376_0.png" src="_images/Label_-_vivo_ano3_376_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.79      0.74      9519
           1       0.87      0.81      0.84     16367

    accuracy                           0.80     25886
   macro avg       0.79      0.80      0.79     25886
weighted avg       0.81      0.80      0.80     25886

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_377_0.png" src="_images/Label_-_vivo_ano3_377_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.78      0.73     10609
           1       0.87      0.81      0.84     19245

    accuracy                           0.80     29854
   macro avg       0.78      0.80      0.79     29854
weighted avg       0.81      0.80      0.80     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_378_0.png" src="_images/Label_-_vivo_ano3_378_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.78      0.80      6750
           1       0.73      0.79      0.76      5211

    accuracy                           0.78     11961
   macro avg       0.78      0.78      0.78     11961
weighted avg       0.79      0.78      0.78     11961

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-SP-for-years-2004-to-2007">
<h3><strong>XGBoost SP for years 2004 to 2007</strong><a class="headerlink" href="#XGBoost-SP-for-years-2004-to-2007" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_380_0.png" src="_images/Label_-_vivo_ano3_380_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.75      0.77      0.76      9519
           1       0.86      0.85      0.86     16367

    accuracy                           0.82     25886
   macro avg       0.81      0.81      0.81     25886
weighted avg       0.82      0.82      0.82     25886

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_381_0.png" src="_images/Label_-_vivo_ano3_381_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.71      0.74      0.72     10609
           1       0.85      0.83      0.84     19245

    accuracy                           0.80     29854
   macro avg       0.78      0.79      0.78     29854
weighted avg       0.80      0.80      0.80     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_382_0.png" src="_images/Label_-_vivo_ano3_382_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.84      0.71      0.77      6750
           1       0.69      0.83      0.75      5211

    accuracy                           0.76     11961
   macro avg       0.77      0.77      0.76     11961
weighted avg       0.78      0.76      0.76     11961

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-SP-for-years-2008-to-2011">
<h3><strong>Random Forest SP for years 2008 to 2011</strong><a class="headerlink" href="#Random-Forest-SP-for-years-2008-to-2011" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_384_0.png" src="_images/Label_-_vivo_ano3_384_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.77      0.74     10609
           1       0.87      0.83      0.85     19245

    accuracy                           0.81     29854
   macro avg       0.79      0.80      0.80     29854
weighted avg       0.81      0.81      0.81     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_385_0.png" src="_images/Label_-_vivo_ano3_385_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.79      0.80      6750
           1       0.74      0.78      0.76      5211

    accuracy                           0.78     11961
   macro avg       0.78      0.78      0.78     11961
weighted avg       0.78      0.78      0.78     11961

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-SP-for-years-2008-to-2011">
<h3><strong>XGBoost SP for years 2008 to 2011</strong><a class="headerlink" href="#XGBoost-SP-for-years-2008-to-2011" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_387_0.png" src="_images/Label_-_vivo_ano3_387_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.77      0.68      0.72     10609
           1       0.83      0.89      0.86     19245

    accuracy                           0.81     29854
   macro avg       0.80      0.78      0.79     29854
weighted avg       0.81      0.81      0.81     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_388_0.png" src="_images/Label_-_vivo_ano3_388_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.69      0.75      6750
           1       0.67      0.82      0.74      5211

    accuracy                           0.74     11961
   macro avg       0.75      0.75      0.74     11961
weighted avg       0.76      0.74      0.74     11961

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-SP-for-years-2012-to-2015">
<h3><strong>Random Forest SP for years 2012 to 2015</strong><a class="headerlink" href="#Random-Forest-SP-for-years-2012-to-2015" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_390_0.png" src="_images/Label_-_vivo_ano3_390_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.82      0.82      6750
           1       0.77      0.77      0.77      5211

    accuracy                           0.80     11961
   macro avg       0.79      0.79      0.79     11961
weighted avg       0.80      0.80      0.80     11961

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-SP-for-years-2012-to-2015">
<h3><strong>XGBoost SP for years 2012 to 2015</strong><a class="headerlink" href="#XGBoost-SP-for-years-2012-to-2015" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_392_0.png" src="_images/Label_-_vivo_ano3_392_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.81      0.82      0.82      6750
           1       0.76      0.75      0.76      5211

    accuracy                           0.79     11961
   macro avg       0.79      0.78      0.79     11961
weighted avg       0.79      0.79      0.79     11961

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-Other-states-for-years-2000-to-2003">
<h3><strong>Random Forest Other states for years 2000 to 2003</strong><a class="headerlink" href="#Random-Forest-Other-states-for-years-2000-to-2003" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_394_0.png" src="_images/Label_-_vivo_ano3_394_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.68      0.83      0.75       445
           1       0.89      0.78      0.83       773

    accuracy                           0.79      1218
   macro avg       0.78      0.80      0.79      1218
weighted avg       0.81      0.79      0.80      1218

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_395_0.png" src="_images/Label_-_vivo_ano3_395_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.64      0.85      0.73       517
           1       0.90      0.74      0.81       946

    accuracy                           0.78      1463
   macro avg       0.77      0.79      0.77      1463
weighted avg       0.81      0.78      0.78      1463

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_396_0.png" src="_images/Label_-_vivo_ano3_396_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.61      0.86      0.71       592
           1       0.91      0.73      0.81      1190

    accuracy                           0.77      1782
   macro avg       0.76      0.79      0.76      1782
weighted avg       0.81      0.77      0.78      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_397_0.png" src="_images/Label_-_vivo_ano3_397_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.81      0.86      0.84       562
           1       0.80      0.72      0.76       419

    accuracy                           0.80       981
   macro avg       0.80      0.79      0.80       981
weighted avg       0.80      0.80      0.80       981

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-Other-states-for-years-2000-to-2003">
<h3><strong>XGBoost Other states for years 2000 to 2003</strong><a class="headerlink" href="#XGBoost-Other-states-for-years-2000-to-2003" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_399_0.png" src="_images/Label_-_vivo_ano3_399_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.86      0.77       445
           1       0.91      0.78      0.84       773

    accuracy                           0.81      1218
   macro avg       0.80      0.82      0.80      1218
weighted avg       0.83      0.81      0.81      1218

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_400_0.png" src="_images/Label_-_vivo_ano3_400_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.66      0.86      0.75       517
           1       0.91      0.75      0.82       946

    accuracy                           0.79      1463
   macro avg       0.78      0.81      0.79      1463
weighted avg       0.82      0.79      0.80      1463

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_401_0.png" src="_images/Label_-_vivo_ano3_401_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.62      0.86      0.72       592
           1       0.91      0.74      0.82      1190

    accuracy                           0.78      1782
   macro avg       0.77      0.80      0.77      1782
weighted avg       0.82      0.78      0.79      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_402_0.png" src="_images/Label_-_vivo_ano3_402_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.85      0.84       562
           1       0.79      0.76      0.78       419

    accuracy                           0.81       981
   macro avg       0.81      0.81      0.81       981
weighted avg       0.81      0.81      0.81       981

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-Other-states-for-years-2004-to-2007">
<h3><strong>Random Forest Other states for years 2004 to 2007</strong><a class="headerlink" href="#Random-Forest-Other-states-for-years-2004-to-2007" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_404_0.png" src="_images/Label_-_vivo_ano3_404_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.83      0.75       517
           1       0.90      0.79      0.84       946

    accuracy                           0.81      1463
   macro avg       0.79      0.81      0.80      1463
weighted avg       0.82      0.81      0.81      1463

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_405_0.png" src="_images/Label_-_vivo_ano3_405_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.64      0.83      0.73       592
           1       0.90      0.77      0.83      1190

    accuracy                           0.79      1782
   macro avg       0.77      0.80      0.78      1782
weighted avg       0.82      0.79      0.80      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_406_0.png" src="_images/Label_-_vivo_ano3_406_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.84      0.84      0.84       562
           1       0.78      0.78      0.78       419

    accuracy                           0.81       981
   macro avg       0.81      0.81      0.81       981
weighted avg       0.81      0.81      0.81       981

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-Other-states-for-years-2004-to-2007">
<h3><strong>XGBoost Other states for years 2004 to 2007</strong><a class="headerlink" href="#XGBoost-Other-states-for-years-2004-to-2007" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_408_0.png" src="_images/Label_-_vivo_ano3_408_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.66      0.83      0.73       517
           1       0.89      0.77      0.82       946

    accuracy                           0.79      1463
   macro avg       0.77      0.80      0.78      1463
weighted avg       0.81      0.79      0.79      1463

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_409_0.png" src="_images/Label_-_vivo_ano3_409_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.64      0.84      0.73       592
           1       0.90      0.77      0.83      1190

    accuracy                           0.79      1782
   macro avg       0.77      0.80      0.78      1782
weighted avg       0.82      0.79      0.80      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_410_0.png" src="_images/Label_-_vivo_ano3_410_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.86      0.85       562
           1       0.80      0.77      0.79       419

    accuracy                           0.82       981
   macro avg       0.82      0.82      0.82       981
weighted avg       0.82      0.82      0.82       981

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-Other-states-for-years-2008-to-2011">
<h3><strong>Random Forest Other states for years 2008 to 2011</strong><a class="headerlink" href="#Random-Forest-Other-states-for-years-2008-to-2011" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_412_0.png" src="_images/Label_-_vivo_ano3_412_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.68      0.81      0.74       592
           1       0.90      0.81      0.85      1190

    accuracy                           0.81      1782
   macro avg       0.79      0.81      0.80      1782
weighted avg       0.83      0.81      0.82      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_413_0.png" src="_images/Label_-_vivo_ano3_413_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.85      0.80      0.83       562
           1       0.75      0.81      0.78       419

    accuracy                           0.81       981
   macro avg       0.80      0.81      0.80       981
weighted avg       0.81      0.81      0.81       981

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-Other-states-for-years-2008-to-2011">
<h3><strong>XGBoost Other states for years 2008 to 2011</strong><a class="headerlink" href="#XGBoost-Other-states-for-years-2008-to-2011" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_415_0.png" src="_images/Label_-_vivo_ano3_415_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.79      0.74       592
           1       0.89      0.84      0.86      1190

    accuracy                           0.82      1782
   macro avg       0.80      0.81      0.80      1782
weighted avg       0.83      0.82      0.82      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_416_0.png" src="_images/Label_-_vivo_ano3_416_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.79      0.82       562
           1       0.75      0.82      0.78       419

    accuracy                           0.81       981
   macro avg       0.80      0.81      0.80       981
weighted avg       0.81      0.81      0.81       981

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-Other-states-for-years-2012-to-2015">
<h3><strong>Random Forest Other states for years 2012 to 2015</strong><a class="headerlink" href="#Random-Forest-Other-states-for-years-2012-to-2015" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_418_0.png" src="_images/Label_-_vivo_ano3_418_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.85      0.83      0.84       562
           1       0.78      0.81      0.79       419

    accuracy                           0.82       981
   macro avg       0.82      0.82      0.82       981
weighted avg       0.82      0.82      0.82       981

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-Other-states-for-years-2012-to-2015">
<h3><strong>XGBoost Other states for years 2012 to 2015</strong><a class="headerlink" href="#XGBoost-Other-states-for-years-2012-to-2015" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_420_0.png" src="_images/Label_-_vivo_ano3_420_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.84      0.85       562
           1       0.79      0.82      0.81       419

    accuracy                           0.83       981
   macro avg       0.83      0.83      0.83       981
weighted avg       0.83      0.83      0.83       981

</pre></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="Fifth-approach">
<h1><strong>Fifth approach</strong><a class="headerlink" href="#Fifth-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with grouped years and without the columns <code class="docutils literal notranslate"><span class="pre">EC</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>.</p>
<div class="section" id="id12">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation. We will use the years grouped too, resulting in 5 datasets for SP and more 5 for other states.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the datasets: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;obito_geral&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_cancer&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;HORMONIO&#39;</span><span class="p">]</span>

<span class="c1"># &#39;RECNENHUM&#39;, &#39;RECLOCAL&#39;, &#39;RECREGIO&#39;, &#39;REC01&#39;, &#39;REC02&#39;, &#39;REC03&#39;, &#39;RECDIST&#39;</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano3&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<p>The process will be done 5 times for SP and other states, using the datasets with grouped years.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="id13">
<h3><strong>SP</strong><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (45987, 64), X_test = (15329, 64)
y_train = (45987,), y_test = (15329,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (57801, 64), X_test = (19267, 64)
y_train = (57801,), y_test = (19267,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2011</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (77655, 64), X_test = (25886, 64)
y_train = (77655,), y_test = (25886,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (89562, 64), X_test = (29854, 64)
y_train = (89562,), y_test = (29854,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2016</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2021</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (35880, 64), X_test = (11961, 64)
y_train = (35880,), y_test = (11961,)
</pre></div></div>
</div>
</div>
<div class="section" id="id14">
<h3><strong>Other states</strong><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2631, 64), X_test = (877, 64)
y_train = (2631,), y_test = (877,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3652, 64), X_test = (1218, 64)
y_train = (3652,), y_test = (1218,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2011</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (4387, 64), X_test = (1463, 64)
y_train = (4387,), y_test = (1463,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (5346, 64), X_test = (1782, 64)
y_train = (5346,), y_test = (1782,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora_ano3</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2016</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2943, 64), X_test = (981, 64)
y_train = (2943,), y_test = (981,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id15">
<h2><strong>Training and evaluation of the models</strong><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id16">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>The first model is the Random Forest, the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used because the models have difficulty to learn the class with fewer examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">rf_sp_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.47</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.47, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_445_0.png" src="_images/Label_-_vivo_ano3_445_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.75      0.80      0.77      6561
           1       0.84      0.80      0.82      8768

    accuracy                           0.80     15329
   macro avg       0.79      0.80      0.79     15329
weighted avg       0.80      0.80      0.80     15329

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2000 to 2003, shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_447_0.png" src="_images/Label_-_vivo_ano3_447_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_448_0.png" src="_images/Label_-_vivo_ano3_448_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_449_0.png" src="_images/Label_-_vivo_ano3_449_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>, and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_451_0.png" src="_images/Label_-_vivo_ano3_451_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">rf_sp_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.6, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_454_0.png" src="_images/Label_-_vivo_ano3_454_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.80      0.75      7502
           1       0.86      0.80      0.83     11765

    accuracy                           0.80     19267
   macro avg       0.79      0.80      0.79     19267
weighted avg       0.80      0.80      0.80     19267

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2004 to 2007, shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_456_0.png" src="_images/Label_-_vivo_ano3_456_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_457_0.png" src="_images/Label_-_vivo_ano3_457_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_458_0.png" src="_images/Label_-_vivo_ano3_458_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_460_0.png" src="_images/Label_-_vivo_ano3_460_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">rf_sp_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.84</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.84, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_463_0.png" src="_images/Label_-_vivo_ano3_463_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.82      0.76      9519
           1       0.88      0.82      0.85     16367

    accuracy                           0.82     25886
   macro avg       0.80      0.82      0.81     25886
weighted avg       0.82      0.82      0.82     25886

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2008 to 2011, shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_465_0.png" src="_images/Label_-_vivo_ano3_465_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_466_0.png" src="_images/Label_-_vivo_ano3_466_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_467_0.png" src="_images/Label_-_vivo_ano3_467_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_469_0.png" src="_images/Label_-_vivo_ano3_469_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">rf_sp_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.06</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.06, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_472_0.png" src="_images/Label_-_vivo_ano3_472_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.71      0.81      0.76     10609
           1       0.89      0.81      0.85     19245

    accuracy                           0.81     29854
   macro avg       0.80      0.81      0.80     29854
weighted avg       0.82      0.81      0.82     29854

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2012 to 2015, shows a good performance of the model with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_474_0.png" src="_images/Label_-_vivo_ano3_474_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_475_0.png" src="_images/Label_-_vivo_ano3_475_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_476_0.png" src="_images/Label_-_vivo_ano3_476_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_478_0.png" src="_images/Label_-_vivo_ano3_478_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">rf_sp_16_21</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.21</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.21}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_481_0.png" src="_images/Label_-_vivo_ano3_481_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.87      0.84      0.85      6750
           1       0.80      0.84      0.82      5211

    accuracy                           0.84     11961
   macro avg       0.83      0.84      0.83     11961
weighted avg       0.84      0.84      0.84     11961

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2016 to 2021, shows a good performance of the model, with 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_483_0.png" src="_images/Label_-_vivo_ano3_483_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_484_0.png" src="_images/Label_-_vivo_ano3_484_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_485_0.png" src="_images/Label_-_vivo_ano3_485_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_487_0.png" src="_images/Label_-_vivo_ano3_487_0.png" />
</div>
</div>
<p>Note that larger values of the ANODIAG column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">rf_fora_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.224</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.224, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_491_0.png" src="_images/Label_-_vivo_ano3_491_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.67      0.77      0.72       327
           1       0.85      0.77      0.81       550

    accuracy                           0.77       877
   macro avg       0.76      0.77      0.76       877
weighted avg       0.78      0.77      0.78       877

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2000 to 2003, also shows a good performance of the model, and we have a balanced main diagonal with 77% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_493_0.png" src="_images/Label_-_vivo_ano3_493_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_494_0.png" src="_images/Label_-_vivo_ano3_494_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_495_0.png" src="_images/Label_-_vivo_ano3_495_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_497_0.png" src="_images/Label_-_vivo_ano3_497_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">rf_fora_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">1.987</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1.987, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_500_0.png" src="_images/Label_-_vivo_ano3_500_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.81      0.76       445
           1       0.88      0.81      0.85       773

    accuracy                           0.81      1218
   macro avg       0.80      0.81      0.80      1218
weighted avg       0.82      0.81      0.82      1218

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2004 to 2007, also shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_502_0.png" src="_images/Label_-_vivo_ano3_502_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_503_0.png" src="_images/Label_-_vivo_ano3_503_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_504_0.png" src="_images/Label_-_vivo_ano3_504_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_506_0.png" src="_images/Label_-_vivo_ano3_506_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">rf_fora_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.465</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.465, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_509_0.png" src="_images/Label_-_vivo_ano3_509_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.81      0.75       517
           1       0.89      0.81      0.85       946

    accuracy                           0.81      1463
   macro avg       0.79      0.81      0.80      1463
weighted avg       0.82      0.81      0.81      1463

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2008 to 2011, also shows a good performance of the model, presenting 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_511_0.png" src="_images/Label_-_vivo_ano3_511_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_512_0.png" src="_images/Label_-_vivo_ano3_512_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_513_0.png" src="_images/Label_-_vivo_ano3_513_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_515_0.png" src="_images/Label_-_vivo_ano3_515_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">rf_fora_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mf">2.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 2.95, 1: 1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_518_0.png" src="_images/Label_-_vivo_ano3_518_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.82      0.75       592
           1       0.90      0.82      0.86      1190

    accuracy                           0.82      1782
   macro avg       0.80      0.82      0.80      1782
weighted avg       0.83      0.82      0.82      1782

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2012 to 2015, also shows a good performance of the model, presenting 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_520_0.png" src="_images/Label_-_vivo_ano3_520_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_521_0.png" src="_images/Label_-_vivo_ano3_521_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_522_0.png" src="_images/Label_-_vivo_ano3_522_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_524_0.png" src="_images/Label_-_vivo_ano3_524_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">rf_fora_16_20</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.2968</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.2968}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_527_0.png" src="_images/Label_-_vivo_ano3_527_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.86      0.87       562
           1       0.82      0.86      0.84       419

    accuracy                           0.86       981
   macro avg       0.85      0.86      0.85       981
weighted avg       0.86      0.86      0.86       981

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2016 to 2020, also shows a good performance of the model, presenting 86% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_529_0.png" src="_images/Label_-_vivo_ano3_529_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_530_0.png" src="_images/Label_-_vivo_ano3_530_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_531_0.png" src="_images/Label_-_vivo_ano3_531_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_533_0.png" src="_images/Label_-_vivo_ano3_533_0.png" />
</div>
</div>
<p>Note that larger values of the ANODIAG column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="id17">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost models follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. The hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> was also used in some trainings, in order to obtain a balanced main diagonal in the confusion matrix.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">xgb_sp_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.635</span><span class="p">)</span>

<span class="n">xgb_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.635)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_539_0.png" src="_images/Label_-_vivo_ano3_539_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.76      0.81      0.79      6561
           1       0.85      0.81      0.83      8768

    accuracy                           0.81     15329
   macro avg       0.81      0.81      0.81     15329
weighted avg       0.81      0.81      0.81     15329

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2000 to 2003, shows a good performance of the model, here with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_541_0.png" src="_images/Label_-_vivo_ano3_541_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_542_0.png" src="_images/Label_-_vivo_ano3_542_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATAMENTO</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_544_0.png" src="_images/Label_-_vivo_ano3_544_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">xgb_sp_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.606</span><span class="p">)</span>

<span class="n">xgb_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.606)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_547_0.png" src="_images/Label_-_vivo_ano3_547_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.81      0.77      7502
           1       0.87      0.81      0.84     11765

    accuracy                           0.81     19267
   macro avg       0.80      0.81      0.81     19267
weighted avg       0.82      0.81      0.82     19267

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2004 to 2007, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_549_0.png" src="_images/Label_-_vivo_ano3_549_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_550_0.png" src="_images/Label_-_vivo_ano3_550_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATAMENTO</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_552_0.png" src="_images/Label_-_vivo_ano3_552_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">xgb_sp_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.5)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_555_0.png" src="_images/Label_-_vivo_ano3_555_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.83      0.78      9519
           1       0.90      0.83      0.86     16367

    accuracy                           0.83     25886
   macro avg       0.82      0.83      0.82     25886
weighted avg       0.84      0.83      0.83     25886

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2008 to 2011, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_557_0.png" src="_images/Label_-_vivo_ano3_557_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_558_0.png" src="_images/Label_-_vivo_ano3_558_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_560_0.png" src="_images/Label_-_vivo_ano3_560_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">xgb_sp_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.47</span><span class="p">)</span>

<span class="n">xgb_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=0.47)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_563_0.png" src="_images/Label_-_vivo_ano3_563_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.83      0.77     10609
           1       0.90      0.83      0.86     19245

    accuracy                           0.83     29854
   macro avg       0.81      0.83      0.82     29854
weighted avg       0.84      0.83      0.83     29854

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2012 to 2015, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_565_0.png" src="_images/Label_-_vivo_ano3_565_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_566_0.png" src="_images/Label_-_vivo_ano3_566_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. Following we have <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">TRATAMENTO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_568_0.png" src="_images/Label_-_vivo_ano3_568_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">xgb_sp_16_21</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.23</span><span class="p">)</span>

<span class="n">xgb_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.23)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_571_0.png" src="_images/Label_-_vivo_ano3_571_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.85      0.87      6750
           1       0.82      0.85      0.84      5211

    accuracy                           0.85     11961
   macro avg       0.85      0.85      0.85     11961
weighted avg       0.86      0.85      0.85     11961

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2016 to 2021, shows a good performance of the model, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_573_0.png" src="_images/Label_-_vivo_ano3_573_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_574_0.png" src="_images/Label_-_vivo_ano3_574_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">RECDIST</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_576_0.png" src="_images/Label_-_vivo_ano3_576_0.png" />
</div>
</div>
<p>Note that larger values of the ANODIAG column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">xgb_fora_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.368</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=0.368)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_580_0.png" src="_images/Label_-_vivo_ano3_580_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.79      0.73       327
           1       0.86      0.79      0.82       550

    accuracy                           0.79       877
   macro avg       0.78      0.79      0.78       877
weighted avg       0.80      0.79      0.79       877

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2000 to 2003, also shows a good performance of the model, with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_582_0.png" src="_images/Label_-_vivo_ano3_582_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_583_0.png" src="_images/Label_-_vivo_ano3_583_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">TRATHOSP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_585_0.png" src="_images/Label_-_vivo_ano3_585_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">xgb_fora_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.449</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=0.449)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_588_0.png" src="_images/Label_-_vivo_ano3_588_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.73      0.82      0.78       445
           1       0.89      0.83      0.86       773

    accuracy                           0.83      1218
   macro avg       0.81      0.83      0.82      1218
weighted avg       0.83      0.83      0.83      1218

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2004 to 2007, also shows a good performance of the model with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_590_0.png" src="_images/Label_-_vivo_ano3_590_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_591_0.png" src="_images/Label_-_vivo_ano3_591_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATAMENTO</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_593_0.png" src="_images/Label_-_vivo_ano3_593_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">xgb_fora_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=0.4)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_596_0.png" src="_images/Label_-_vivo_ano3_596_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.81      0.75       517
           1       0.89      0.81      0.85       946

    accuracy                           0.81      1463
   macro avg       0.79      0.81      0.80      1463
weighted avg       0.82      0.81      0.81      1463

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2008 to 2011, also shows a good performance of the model with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_598_0.png" src="_images/Label_-_vivo_ano3_598_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_599_0.png" src="_images/Label_-_vivo_ano3_599_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, but not with a lot of advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_601_0.png" src="_images/Label_-_vivo_ano3_601_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">xgb_fora_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.324</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=0.324)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_604_0.png" src="_images/Label_-_vivo_ano3_604_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.82      0.76       592
           1       0.90      0.82      0.86      1190

    accuracy                           0.82      1782
   macro avg       0.80      0.82      0.81      1782
weighted avg       0.84      0.82      0.83      1782

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2012 to 2015, also shows a good performance of the model with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_606_0.png" src="_images/Label_-_vivo_ano3_606_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_607_0.png" src="_images/Label_-_vivo_ano3_607_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_609_0.png" src="_images/Label_-_vivo_ano3_609_0.png" />
</div>
</div>
<p>Note that larger values of the ECGRUP column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">xgb_fora_16_20</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.031</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=1.031)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_612_0.png" src="_images/Label_-_vivo_ano3_612_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.85      0.87       562
           1       0.81      0.85      0.83       419

    accuracy                           0.85       981
   macro avg       0.85      0.85      0.85       981
weighted avg       0.85      0.85      0.85       981

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2016 to 2020, shows the best performance comparing with the other models, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_614_0.png" src="_images/Label_-_vivo_ano3_614_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_615_0.png" src="_images/Label_-_vivo_ano3_615_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_617_0.png" src="_images/Label_-_vivo_ano3_617_0.png" />
</div>
</div>
<p>Note that larger values of the ANODIAG column, shown in pink, have more influence for the model’s prediction to be class 0, smaller values have greater weight for the prediction to be class 1. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
<div class="section" id="id18">
<h2><strong>Testing models with data from other years</strong><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>We will use test data from the following years in the trained models for each set of years grouped together.</p>
<div class="section" id="id19">
<h3><strong>Random Forest SP for years 2000 to 2003</strong><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_622_0.png" src="_images/Label_-_vivo_ano3_622_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.79      0.75      7502
           1       0.85      0.80      0.83     11765

    accuracy                           0.80     19267
   macro avg       0.79      0.79      0.79     19267
weighted avg       0.80      0.80      0.80     19267

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_623_0.png" src="_images/Label_-_vivo_ano3_623_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.71      0.77      0.74      9519
           1       0.86      0.82      0.84     16367

    accuracy                           0.80     25886
   macro avg       0.78      0.79      0.79     25886
weighted avg       0.81      0.80      0.80     25886

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_624_0.png" src="_images/Label_-_vivo_ano3_624_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.78      0.73     10609
           1       0.87      0.80      0.84     19245

    accuracy                           0.80     29854
   macro avg       0.78      0.79      0.78     29854
weighted avg       0.81      0.80      0.80     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_625_0.png" src="_images/Label_-_vivo_ano3_625_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.78      0.80      6750
           1       0.73      0.79      0.76      5211

    accuracy                           0.78     11961
   macro avg       0.78      0.78      0.78     11961
weighted avg       0.79      0.78      0.78     11961

</pre></div></div>
</div>
</div>
<div class="section" id="id20">
<h3><strong>XGBoost SP for years 2000 to 2003</strong><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_627_0.png" src="_images/Label_-_vivo_ano3_627_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.73      0.77      0.75      7502
           1       0.85      0.82      0.83     11765

    accuracy                           0.80     19267
   macro avg       0.79      0.80      0.79     19267
weighted avg       0.80      0.80      0.80     19267

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_628_0.png" src="_images/Label_-_vivo_ano3_628_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.74      0.74      0.74      9519
           1       0.85      0.85      0.85     16367

    accuracy                           0.81     25886
   macro avg       0.79      0.79      0.79     25886
weighted avg       0.81      0.81      0.81     25886

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_629_0.png" src="_images/Label_-_vivo_ano3_629_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.73      0.71     10609
           1       0.85      0.83      0.84     19245

    accuracy                           0.79     29854
   macro avg       0.77      0.78      0.78     29854
weighted avg       0.79      0.79      0.79     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_630_0.png" src="_images/Label_-_vivo_ano3_630_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.73      0.78      6750
           1       0.70      0.80      0.74      5211

    accuracy                           0.76     11961
   macro avg       0.76      0.76      0.76     11961
weighted avg       0.77      0.76      0.76     11961

</pre></div></div>
</div>
</div>
<div class="section" id="id21">
<h3><strong>Random Forest SP for years 2004 to 2007</strong><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_632_0.png" src="_images/Label_-_vivo_ano3_632_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.70      0.79      0.74      9519
           1       0.87      0.81      0.84     16367

    accuracy                           0.80     25886
   macro avg       0.79      0.80      0.79     25886
weighted avg       0.81      0.80      0.80     25886

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_633_0.png" src="_images/Label_-_vivo_ano3_633_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.79      0.74     10609
           1       0.87      0.80      0.84     19245

    accuracy                           0.80     29854
   macro avg       0.78      0.80      0.79     29854
weighted avg       0.81      0.80      0.80     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_634_0.png" src="_images/Label_-_vivo_ano3_634_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.77      0.80      6750
           1       0.73      0.79      0.76      5211

    accuracy                           0.78     11961
   macro avg       0.78      0.78      0.78     11961
weighted avg       0.79      0.78      0.78     11961

</pre></div></div>
</div>
</div>
<div class="section" id="id22">
<h3><strong>XGBoost SP for years 2004 to 2007</strong><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_636_0.png" src="_images/Label_-_vivo_ano3_636_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.75      0.77      0.76      9519
           1       0.86      0.85      0.86     16367

    accuracy                           0.82     25886
   macro avg       0.80      0.81      0.81     25886
weighted avg       0.82      0.82      0.82     25886

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_637_0.png" src="_images/Label_-_vivo_ano3_637_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.71      0.74      0.72     10609
           1       0.85      0.83      0.84     19245

    accuracy                           0.80     29854
   macro avg       0.78      0.79      0.78     29854
weighted avg       0.80      0.80      0.80     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_638_0.png" src="_images/Label_-_vivo_ano3_638_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.85      0.69      0.76      6750
           1       0.68      0.84      0.75      5211

    accuracy                           0.76     11961
   macro avg       0.76      0.77      0.76     11961
weighted avg       0.77      0.76      0.76     11961

</pre></div></div>
</div>
</div>
<div class="section" id="id23">
<h3><strong>Random Forest SP for years 2008 to 2011</strong><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_640_0.png" src="_images/Label_-_vivo_ano3_640_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.72      0.77      0.74     10609
           1       0.87      0.84      0.85     19245

    accuracy                           0.81     29854
   macro avg       0.79      0.80      0.80     29854
weighted avg       0.81      0.81      0.81     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_641_0.png" src="_images/Label_-_vivo_ano3_641_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.78      0.80      6750
           1       0.73      0.77      0.75      5211

    accuracy                           0.78     11961
   macro avg       0.78      0.78      0.78     11961
weighted avg       0.78      0.78      0.78     11961

</pre></div></div>
</div>
</div>
<div class="section" id="id24">
<h3><strong>XGBoost SP for years 2008 to 2011</strong><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_643_0.png" src="_images/Label_-_vivo_ano3_643_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.76      0.67      0.71     10609
           1       0.83      0.88      0.86     19245

    accuracy                           0.81     29854
   macro avg       0.80      0.78      0.79     29854
weighted avg       0.81      0.81      0.81     29854

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_644_0.png" src="_images/Label_-_vivo_ano3_644_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.69      0.75      6750
           1       0.67      0.81      0.73      5211

    accuracy                           0.74     11961
   macro avg       0.75      0.75      0.74     11961
weighted avg       0.76      0.74      0.74     11961

</pre></div></div>
</div>
</div>
<div class="section" id="id25">
<h3><strong>Random Forest SP for years 2012 to 2015</strong><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_646_0.png" src="_images/Label_-_vivo_ano3_646_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.82      0.82      6750
           1       0.77      0.77      0.77      5211

    accuracy                           0.80     11961
   macro avg       0.79      0.79      0.79     11961
weighted avg       0.80      0.80      0.80     11961

</pre></div></div>
</div>
</div>
<div class="section" id="id26">
<h3><strong>XGBoost SP for years 2012 to 2015</strong><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_648_0.png" src="_images/Label_-_vivo_ano3_648_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.81      0.82      0.81      6750
           1       0.76      0.76      0.76      5211

    accuracy                           0.79     11961
   macro avg       0.79      0.79      0.79     11961
weighted avg       0.79      0.79      0.79     11961

</pre></div></div>
</div>
</div>
<div class="section" id="id27">
<h3><strong>Random Forest Other states for years 2000 to 2003</strong><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_650_0.png" src="_images/Label_-_vivo_ano3_650_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.83      0.76       445
           1       0.89      0.79      0.84       773

    accuracy                           0.80      1218
   macro avg       0.79      0.81      0.80      1218
weighted avg       0.82      0.80      0.81      1218

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_651_0.png" src="_images/Label_-_vivo_ano3_651_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.66      0.86      0.75       517
           1       0.91      0.75      0.82       946

    accuracy                           0.79      1463
   macro avg       0.78      0.81      0.79      1463
weighted avg       0.82      0.79      0.80      1463

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_652_0.png" src="_images/Label_-_vivo_ano3_652_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.61      0.86      0.71       592
           1       0.91      0.73      0.81      1190

    accuracy                           0.77      1782
   macro avg       0.76      0.79      0.76      1782
weighted avg       0.81      0.77      0.78      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_653_0.png" src="_images/Label_-_vivo_ano3_653_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.86      0.84       562
           1       0.80      0.74      0.77       419

    accuracy                           0.81       981
   macro avg       0.81      0.80      0.80       981
weighted avg       0.81      0.81      0.81       981

</pre></div></div>
</div>
</div>
<div class="section" id="id28">
<h3><strong>XGBoost Other states for years 2000 to 2003</strong><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_655_0.png" src="_images/Label_-_vivo_ano3_655_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.68      0.86      0.76       445
           1       0.90      0.77      0.83       773

    accuracy                           0.80      1218
   macro avg       0.79      0.81      0.80      1218
weighted avg       0.82      0.80      0.81      1218

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_656_0.png" src="_images/Label_-_vivo_ano3_656_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.65      0.86      0.74       517
           1       0.91      0.75      0.82       946

    accuracy                           0.79      1463
   macro avg       0.78      0.81      0.78      1463
weighted avg       0.82      0.79      0.79      1463

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_657_0.png" src="_images/Label_-_vivo_ano3_657_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.62      0.83      0.71       592
           1       0.90      0.74      0.82      1190

    accuracy                           0.77      1782
   macro avg       0.76      0.79      0.76      1782
weighted avg       0.81      0.77      0.78      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_658_0.png" src="_images/Label_-_vivo_ano3_658_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.85      0.84       562
           1       0.79      0.77      0.78       419

    accuracy                           0.82       981
   macro avg       0.81      0.81      0.81       981
weighted avg       0.82      0.82      0.82       981

</pre></div></div>
</div>
</div>
<div class="section" id="id29">
<h3><strong>Random Forest Other states for years 2004 to 2007</strong><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_660_0.png" src="_images/Label_-_vivo_ano3_660_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.83      0.75       517
           1       0.89      0.80      0.84       946

    accuracy                           0.81      1463
   macro avg       0.79      0.81      0.80      1463
weighted avg       0.82      0.81      0.81      1463

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_661_0.png" src="_images/Label_-_vivo_ano3_661_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.65      0.83      0.73       592
           1       0.90      0.78      0.83      1190

    accuracy                           0.79      1782
   macro avg       0.78      0.80      0.78      1782
weighted avg       0.82      0.79      0.80      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_662_0.png" src="_images/Label_-_vivo_ano3_662_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.84      0.83      0.83       562
           1       0.77      0.78      0.78       419

    accuracy                           0.81       981
   macro avg       0.80      0.81      0.80       981
weighted avg       0.81      0.81      0.81       981

</pre></div></div>
</div>
</div>
<div class="section" id="id30">
<h3><strong>XGBoost Other states for years 2004 to 2007</strong><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_664_0.png" src="_images/Label_-_vivo_ano3_664_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.66      0.82      0.73       517
           1       0.89      0.77      0.83       946

    accuracy                           0.79      1463
   macro avg       0.78      0.80      0.78      1463
weighted avg       0.81      0.79      0.79      1463

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_665_0.png" src="_images/Label_-_vivo_ano3_665_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.64      0.84      0.73       592
           1       0.91      0.76      0.83      1190

    accuracy                           0.79      1782
   macro avg       0.77      0.80      0.78      1782
weighted avg       0.82      0.79      0.79      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_666_0.png" src="_images/Label_-_vivo_ano3_666_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.84      0.83       562
           1       0.78      0.75      0.77       419

    accuracy                           0.80       981
   macro avg       0.80      0.80      0.80       981
weighted avg       0.80      0.80      0.80       981

</pre></div></div>
</div>
</div>
<div class="section" id="id31">
<h3><strong>Random Forest Other states for years 2008 to 2011</strong><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_668_0.png" src="_images/Label_-_vivo_ano3_668_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.69      0.80      0.74       592
           1       0.89      0.82      0.85      1190

    accuracy                           0.81      1782
   macro avg       0.79      0.81      0.80      1782
weighted avg       0.83      0.81      0.82      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_669_0.png" src="_images/Label_-_vivo_ano3_669_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.80      0.83       562
           1       0.75      0.83      0.79       419

    accuracy                           0.81       981
   macro avg       0.81      0.81      0.81       981
weighted avg       0.82      0.81      0.81       981

</pre></div></div>
</div>
</div>
<div class="section" id="id32">
<h3><strong>XGBoost Other states for years 2008 to 2011</strong><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_671_0.png" src="_images/Label_-_vivo_ano3_671_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.68      0.78      0.73       592
           1       0.88      0.82      0.85      1190

    accuracy                           0.80      1782
   macro avg       0.78      0.80      0.79      1782
weighted avg       0.81      0.80      0.81      1782

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_672_0.png" src="_images/Label_-_vivo_ano3_672_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.80      0.83       562
           1       0.75      0.83      0.79       419

    accuracy                           0.81       981
   macro avg       0.81      0.81      0.81       981
weighted avg       0.81      0.81      0.81       981

</pre></div></div>
</div>
</div>
<div class="section" id="id33">
<h3><strong>Random Forest Other states for years 2012 to 2015</strong><a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_674_0.png" src="_images/Label_-_vivo_ano3_674_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.82      0.84       562
           1       0.78      0.82      0.80       419

    accuracy                           0.82       981
   macro avg       0.82      0.82      0.82       981
weighted avg       0.82      0.82      0.82       981

</pre></div></div>
</div>
</div>
<div class="section" id="id34">
<h3><strong>XGBoost Other states for years 2012 to 2015</strong><a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano3_676_0.png" src="_images/Label_-_vivo_ano3_676_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.83      0.85       562
           1       0.78      0.82      0.80       419

    accuracy                           0.83       981
   macro avg       0.82      0.82      0.82       981
weighted avg       0.83      0.83      0.83       981

</pre></div></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Label%20-%20vivo_ano5.html" class="btn btn-neutral float-right" title="Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Label%20-%20vivo_ano1.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Lucas Buk Cardoso.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>