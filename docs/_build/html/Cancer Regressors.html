

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Regression - Delta t7 &mdash; Cancer Project Documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Classification - ob" href="Cancer%20Classifiers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cancer Project
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Libraries and functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html"><strong>Libraries</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#Functions"><strong>Functions</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#References"><strong>References</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Data Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Data%20Analysis.html"><strong>Reading the data</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Data%20Analysis.html#Data-analysis"><strong>Data analysis</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Data%20Analysis.html#Creating-new-columns"><strong>Creating new columns</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Classifiers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Classifiers.html"><strong>Classification - ob</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Classifiers.html#Classification---RECNENHUM"><strong>Classification - RECNENHUM</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Classifiers.html#Classification---RECDIST"><strong>Classification - RECDIST</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Regressors</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Regression - Delta t7</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Training-and-testing-split"><strong>Training and testing split</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Encoder-and-normalization"><strong>Encoder and normalization</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Training-and-evaluation-the-machine-learning-models"><strong>Training and evaluation the machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Regressor"><strong>Random Forest Regressor</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Regressor"><strong>XGBoost Regressor</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Regression---Delta-t8"><strong>Regression - Delta t8</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1"><strong>Reading the data</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2"><strong>Training and testing split</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3"><strong>Encoder and normalization</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4"><strong>Training and evaluation the machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5"><strong>Random Forest Regressor</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6"><strong>XGBoost Regressor</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Regression---Delta-t9"><strong>Regression - Delta t9</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id7"><strong>Reading the data</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8"><strong>Training and testing split</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9"><strong>Encoder and normalization</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10"><strong>Training and evaluation the machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11"><strong>Random Forest Regressor</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12"><strong>XGBoost Regressor</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cancer Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><strong>Regression - Delta t7</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Cancer Regressors.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Regression---Delta-t7">
<h1><strong>Regression - Delta t7</strong><a class="headerlink" href="#Regression---Delta-t7" title="Permalink to this headline">¶</a></h1>
<p>Difference of days between last information and consultation</p>
<p>In this section, two machine learning models will be used to predict the <code class="docutils literal notranslate"><span class="pre">delta_t7</span></code> column, Random Forest Regressor and XGBoost Regressor.</p>
<div class="section" id="Reading-the-data">
<h2><strong>Reading the data</strong><a class="headerlink" href="#Reading-the-data" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the column <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code> will be dropped, as well the <code class="docutils literal notranslate"><span class="pre">IDADE</span></code> column, because the column <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code> will be used, both have information about the age of the patients.</p>
<p>The columns <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code>, can be used as a label in a future analysis, so they will not be as features of the created models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(806402, 94)
(62317, 94)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DTRECIDIVA    717377
delta_t6      717377
delta_t5      717377
delta_t4      717377
IDADE              1
TRATAMENTO         0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DTRECIDIVA    57799
delta_t6      57799
delta_t5      57799
delta_t4      57799
NAOTRAT           0
LOCALTNM          0
dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="Training-and-testing-split">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#Training-and-testing-split" title="Permalink to this headline">¶</a></h2>
<p>To define the columns that will be used as features and the label, the process will be similar to the one used previously.</p>
<p>For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT,</span> <span class="pre">DTDIAG,</span> <span class="pre">DTTRAT,</span> <span class="pre">DTRECIDIVA,</span> <span class="pre">DTULTINFO</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>. Regarding <code class="docutils literal notranslate"><span class="pre">PERDASEG</span></code>, it has already been discussed in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Classifiers.html#Reading-the-data">classification - ob section</a>.</p>
<p>The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG,</span> <span class="pre">TRATCONS,</span> <span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1,</span> <span class="pre">delta_t2,</span> <span class="pre">delta_t3</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;IDADE&#39;</span><span class="p">,</span> <span class="s1">&#39;PERDASEG&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="s1">&#39;ano_ob&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;delta_t7&#39;</span>
</pre></div>
</div>
</div>
<p>Again we will use the function created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">,</span> <span class="n">y_testSP</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (604801, 70), X_test = (201601, 70)
y_train = (604801,), y_test = (201601,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">,</span> <span class="n">y_testFora</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (46737, 70), X_test = (15580, 70)
y_train = (46737,), y_test = (15580,)
</pre></div></div>
</div>
</div>
<div class="section" id="Encoder-and-normalization">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#Encoder-and-normalization" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to preprocess the training data, for this we will use the function <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Training-and-evaluation-the-machine-learning-models">
<h2><strong>Training and evaluation the machine learning models</strong><a class="headerlink" href="#Training-and-evaluation-the-machine-learning-models" title="Permalink to this headline">¶</a></h2>
<p>To preprocess the test data we will usa the function <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_testSP_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span><span class="p">)</span>
<span class="n">X_testFora_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="Random-Forest-Regressor">
<h3><strong>Random Forest Regressor</strong><a class="headerlink" href="#Random-Forest-Regressor" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest Regressor, for this test the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> and <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameters will be used, the first one to obtain the same training values of the model every time it is runned. The <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> to increase the depth of the tree in the training models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rfr_sp</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rfr_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestRegressor(bootstrap=True, ccp_alpha=0.0, criterion=&#39;mse&#39;,
                      max_depth=10, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                      max_samples=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      n_estimators=100, n_jobs=None, oob_score=False,
                      random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rfr_fora</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rfr_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestRegressor(bootstrap=True, ccp_alpha=0.0, criterion=&#39;mse&#39;,
                      max_depth=10, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                      max_samples=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      n_estimators=100, n_jobs=None, oob_score=False,
                      random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<p>Below we have the metrics for the Random Forest Regressor models, followed by the graph with the most important features for each model.</p>
<p>To calculate the metrics it was created a function, <code class="docutils literal notranslate"><span class="pre">validate_regression</span></code>, that returns some metrics of the model: MAE, MSE, RMSE and R².</p>
<blockquote>
<div><p>Go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a> to see the complete function.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testSP_</span><span class="p">,</span> <span class="n">rfr_sp</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 789.053
Mean Squared Error: 1206990.927
Root Mean Squared Error: 1098.631
Score: 0.411
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>400744</th>
      <td>1601</td>
      <td>1069.693860</td>
    </tr>
    <tr>
      <th>369215</th>
      <td>821</td>
      <td>413.669676</td>
    </tr>
    <tr>
      <th>387264</th>
      <td>607</td>
      <td>1397.548772</td>
    </tr>
    <tr>
      <th>296234</th>
      <td>450</td>
      <td>506.058025</td>
    </tr>
    <tr>
      <th>712621</th>
      <td>950</td>
      <td>1196.496278</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>This first model for the São Paulo data did not perform well in predicting the difference between the last information and the medical consultation, as can be seen in the metrics used in the validation, the R² value was 0.41.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rfr_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_33_0.png" src="_images/Cancer_Regressors_33_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">MORFO</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testFora_</span><span class="p">,</span> <span class="n">rfr_fora</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 666.512
Mean Squared Error: 936813.721
Root Mean Squared Error: 967.891
Score: 0.464
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1077</th>
      <td>725</td>
      <td>599.482480</td>
    </tr>
    <tr>
      <th>15361</th>
      <td>937</td>
      <td>1189.573078</td>
    </tr>
    <tr>
      <th>3301</th>
      <td>0</td>
      <td>149.476432</td>
    </tr>
    <tr>
      <th>32432</th>
      <td>3338</td>
      <td>2186.653566</td>
    </tr>
    <tr>
      <th>39694</th>
      <td>649</td>
      <td>1563.660468</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>As in the model for data from São Paulo, using data from other states, it was also not possible to obtain a good performance in predicting the difference between the last information and the medical consultation. The value of R² was 0.46, the errors were lower than in the previous model, but even so they do not represent a good regressor.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rfr_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_38_0.png" src="_images/Cancer_Regressors_38_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">MORFO</span></code>, <code class="docutils literal notranslate"><span class="pre">EC</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>, the first one with a good difference to the others</p>
</div></blockquote>
</div>
<div class="section" id="XGBoost-Regressor">
<h3><strong>XGBoost Regressor</strong><a class="headerlink" href="#XGBoost-Regressor" title="Permalink to this headline">¶</a></h3>
<p>Here will be tested the XGBoost Regressor, for this test the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> and <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameters will be used, the first one to obtain the same training values of the model every time it is runned. The <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> to increase the depth of the tree in the training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgbr_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgbr_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, gamma=0,
             importance_type=&#39;gain&#39;, learning_rate=0.1, max_delta_step=0,
             max_depth=10, min_child_weight=1, missing=None, n_estimators=100,
             n_jobs=1, nthread=None, objective=&#39;reg:linear&#39;, random_state=10,
             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
             silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgbr_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgbr_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, gamma=0,
             importance_type=&#39;gain&#39;, learning_rate=0.1, max_delta_step=0,
             max_depth=10, min_child_weight=1, missing=None, n_estimators=100,
             n_jobs=1, nthread=None, objective=&#39;reg:linear&#39;, random_state=10,
             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
             silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<p>Below we have the metrics for the XGBoost Regressor models, followed by the graph with the most important features for each model.</p>
<p>To calculate the metrics it was created a function, <code class="docutils literal notranslate"><span class="pre">validate_regression</span></code>, that returns some metrics of the model: MAE, MSE, RMSE and R².</p>
<blockquote>
<div><p>Go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a> to see the complete function.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testSP_</span><span class="p">,</span> <span class="n">xgbr_sp</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 689.512
Mean Squared Error: 987826.482
Root Mean Squared Error: 993.895
Score: 0.518
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>400744</th>
      <td>1601</td>
      <td>1152.513794</td>
    </tr>
    <tr>
      <th>369215</th>
      <td>821</td>
      <td>524.870361</td>
    </tr>
    <tr>
      <th>387264</th>
      <td>607</td>
      <td>1982.705566</td>
    </tr>
    <tr>
      <th>296234</th>
      <td>450</td>
      <td>311.787750</td>
    </tr>
    <tr>
      <th>712621</th>
      <td>950</td>
      <td>1346.640381</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>With the XGBoost regressor, a better model for SP data was obtained in relation to the Random Forest model presented in the previous section, but the score value was 0.52.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgbr_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_48_0.png" src="_images/Cancer_Regressors_48_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testFora_</span><span class="p">,</span> <span class="n">xgbr_fora</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 624.762
Mean Squared Error: 874175.481
Root Mean Squared Error: 934.974
Score: 0.500
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1077</th>
      <td>725</td>
      <td>467.573486</td>
    </tr>
    <tr>
      <th>15361</th>
      <td>937</td>
      <td>834.992310</td>
    </tr>
    <tr>
      <th>3301</th>
      <td>0</td>
      <td>80.842232</td>
    </tr>
    <tr>
      <th>32432</th>
      <td>3338</td>
      <td>2378.826904</td>
    </tr>
    <tr>
      <th>39694</th>
      <td>649</td>
      <td>1536.617432</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>As in the previous model, using the XGBoost regressor, a better model was obtained for data from other states in relation to the Random Forest model, with a score of 0.50, but still a model that does not present good prediction results.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgbr_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_53_0.png" src="_images/Cancer_Regressors_53_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">EC</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="Regression---Delta-t8">
<h1><strong>Regression - Delta t8</strong><a class="headerlink" href="#Regression---Delta-t8" title="Permalink to this headline">¶</a></h1>
<p>Difference of days between last information and diagnosis</p>
<p>In this section, two machine learning models will be used to predict the <code class="docutils literal notranslate"><span class="pre">delta_t8</span></code> column, Random Forest Regressor and XGBoost Regressor.</p>
<div class="section" id="id1">
<h2><strong>Reading the data</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the column <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code> will be dropped, as well the <code class="docutils literal notranslate"><span class="pre">IDADE</span></code> column, because the column <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code> will be used, both have information about the age of the patients.</p>
<p>The columns <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code>, can be used as a label in a future analysis, so they will not be as features of the created models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(806402, 94)
(62317, 94)
</pre></div></div>
</div>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DTRECIDIVA    717377
delta_t6      717377
delta_t5      717377
delta_t4      717377
IDADE              1
TRATAMENTO         0
dtype: int64
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DTRECIDIVA    57799
delta_t6      57799
delta_t5      57799
delta_t4      57799
NAOTRAT           0
LOCALTNM          0
dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="id2">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>To define the columns that will be used as features and the label, the process will be similar to the one used previously.</p>
<p>For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT,</span> <span class="pre">DTDIAG,</span> <span class="pre">DTTRAT,</span> <span class="pre">DTRECIDIVA,</span> <span class="pre">DTULTINFO</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>. Regarding <code class="docutils literal notranslate"><span class="pre">PERDASEG</span></code>, it has already been discussed in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Classifiers.html#Reading-the-data">classification - ob section</a>.</p>
<p>The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG,</span> <span class="pre">TRATCONS,</span> <span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1,</span> <span class="pre">delta_t2,</span> <span class="pre">delta_t3</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;IDADE&#39;</span><span class="p">,</span> <span class="s1">&#39;PERDASEG&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="s1">&#39;ano_ob&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;delta_t8&#39;</span>
</pre></div>
</div>
</div>
<p>Again we will use the function created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">,</span> <span class="n">y_testSP</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (604801, 70), X_test = (201601, 70)
y_train = (604801,), y_test = (201601,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">,</span> <span class="n">y_testFora</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (46737, 70), X_test = (15580, 70)
y_train = (46737,), y_test = (15580,)
</pre></div></div>
</div>
</div>
<div class="section" id="id3">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to preprocess the training data, for this we will use the function <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h2><strong>Training and evaluation the machine learning models</strong><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>To preprocess the test data we will usa the function <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_testSP_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span><span class="p">)</span>
<span class="n">X_testFora_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id5">
<h3><strong>Random Forest Regressor</strong><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest Regressor, for this test the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> and <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameters will be used, the first one to obtain the same training values of the model every time it is runned. The <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> to increase the depth of the tree in the training models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rfr_sp</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rfr_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestRegressor(bootstrap=True, ccp_alpha=0.0, criterion=&#39;mse&#39;,
                      max_depth=10, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                      max_samples=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      n_estimators=100, n_jobs=None, oob_score=False,
                      random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rfr_fora</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rfr_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestRegressor(bootstrap=True, ccp_alpha=0.0, criterion=&#39;mse&#39;,
                      max_depth=10, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                      max_samples=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      n_estimators=100, n_jobs=None, oob_score=False,
                      random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<p>Below we have the metrics for the Random Forest Regressor models, followed by the graph with the most important features for each model.</p>
<p>To calculate the metrics it was created a function, <code class="docutils literal notranslate"><span class="pre">validate_regression</span></code>, that returns some metrics of the model: MAE, MSE, RMSE and R².</p>
<blockquote>
<div><p>Go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a> to see the complete function.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testSP_</span><span class="p">,</span> <span class="n">rfr_sp</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 782.222
Mean Squared Error: 1195702.948
Root Mean Squared Error: 1093.482
Score: 0.415
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>400744</th>
      <td>1601</td>
      <td>1084.059347</td>
    </tr>
    <tr>
      <th>369215</th>
      <td>821</td>
      <td>518.474025</td>
    </tr>
    <tr>
      <th>387264</th>
      <td>607</td>
      <td>1377.023778</td>
    </tr>
    <tr>
      <th>296234</th>
      <td>433</td>
      <td>458.217164</td>
    </tr>
    <tr>
      <th>712621</th>
      <td>932</td>
      <td>1187.299115</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>Using the difference in days between last information and diagnosis as label, a good predictor for SP data was also not obtained, its score was 0.41.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rfr_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_90_0.png" src="_images/Cancer_Regressors_90_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">MORFO</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testFora_</span><span class="p">,</span> <span class="n">rfr_fora</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 663.871
Mean Squared Error: 933287.954
Root Mean Squared Error: 966.068
Score: 0.464
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1077</th>
      <td>724</td>
      <td>560.414422</td>
    </tr>
    <tr>
      <th>15361</th>
      <td>936</td>
      <td>1261.124292</td>
    </tr>
    <tr>
      <th>3301</th>
      <td>0</td>
      <td>186.681097</td>
    </tr>
    <tr>
      <th>32432</th>
      <td>3365</td>
      <td>2201.181639</td>
    </tr>
    <tr>
      <th>39694</th>
      <td>663</td>
      <td>1631.297124</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>As in the model for data from São Paulo, using data from other states, it was also not possible to obtain a good performance predicting delta_t8. The value of R² was 0.46, the errors were lower than in the previous model, but even so they do not represent a good regressor.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rfr_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_95_0.png" src="_images/Cancer_Regressors_95_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">MORFO</span></code>, <code class="docutils literal notranslate"><span class="pre">EC</span></code> and <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="id6">
<h3><strong>XGBoost Regressor</strong><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Here will be tested the XGBoost Regressor, for this test the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> and <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameters will be used, the first one to obtain the same training values of the model every time it is runned. The <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> to increase the depth of the tree in the training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgbr_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgbr_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, gamma=0,
             importance_type=&#39;gain&#39;, learning_rate=0.1, max_delta_step=0,
             max_depth=10, min_child_weight=1, missing=None, n_estimators=100,
             n_jobs=1, nthread=None, objective=&#39;reg:linear&#39;, random_state=10,
             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
             silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgbr_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgbr_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, gamma=0,
             importance_type=&#39;gain&#39;, learning_rate=0.1, max_delta_step=0,
             max_depth=10, min_child_weight=1, missing=None, n_estimators=100,
             n_jobs=1, nthread=None, objective=&#39;reg:linear&#39;, random_state=10,
             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
             silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<p>Below we have the metrics for the XGBoost Regressor models, followed by the graph with the most important features for each model.</p>
<p>To calculate the metrics it was created a function, <code class="docutils literal notranslate"><span class="pre">validate_regression</span></code>, that returns some metrics of the model: MAE, MSE, RMSE and R².</p>
<blockquote>
<div><p>Go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a> to see the complete function.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testSP_</span><span class="p">,</span> <span class="n">xgbr_sp</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 686.846
Mean Squared Error: 985000.332
Root Mean Squared Error: 992.472
Score: 0.518
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>400744</th>
      <td>1601</td>
      <td>1172.890869</td>
    </tr>
    <tr>
      <th>369215</th>
      <td>821</td>
      <td>598.177185</td>
    </tr>
    <tr>
      <th>387264</th>
      <td>607</td>
      <td>1902.172974</td>
    </tr>
    <tr>
      <th>296234</th>
      <td>433</td>
      <td>345.109161</td>
    </tr>
    <tr>
      <th>712621</th>
      <td>932</td>
      <td>1261.731323</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>With the XGBoost regressor, a better model for SP data was obtained in relation to the Random Forest model for the same data, but the score value was 0.52, representing a not very good predictor.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgbr_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_105_0.png" src="_images/Cancer_Regressors_105_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testFora_</span><span class="p">,</span> <span class="n">xgbr_fora</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 622.798
Mean Squared Error: 870268.682
Root Mean Squared Error: 932.882
Score: 0.500
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1077</th>
      <td>724</td>
      <td>445.601044</td>
    </tr>
    <tr>
      <th>15361</th>
      <td>936</td>
      <td>969.741333</td>
    </tr>
    <tr>
      <th>3301</th>
      <td>0</td>
      <td>55.943726</td>
    </tr>
    <tr>
      <th>32432</th>
      <td>3365</td>
      <td>2436.193848</td>
    </tr>
    <tr>
      <th>39694</th>
      <td>663</td>
      <td>1578.609497</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>As in the previous model, using the XGBoost regressor, a better model was obtained for data from other states in relation to the Random Forest model, with a score of 0.50, but still a model that does not present good prediction results.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgbr_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_110_0.png" src="_images/Cancer_Regressors_110_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code> and <code class="docutils literal notranslate"><span class="pre">TRATHOSP</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="Regression---Delta-t9">
<h1><strong>Regression - Delta t9</strong><a class="headerlink" href="#Regression---Delta-t9" title="Permalink to this headline">¶</a></h1>
<p>Difference of days between last information and treatment</p>
<p>In this section, two machine learning models will be used to predict the <code class="docutils literal notranslate"><span class="pre">delta_t9</span></code> column, Random Forest Regressor and XGBoost Regressor.</p>
<div class="section" id="id7">
<h2><strong>Reading the data</strong><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states</p>
<p>We can see that we still have some missing values in both datasets, but the column <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code> will be dropped, as well the <code class="docutils literal notranslate"><span class="pre">IDADE</span></code> column, because the column <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code> will be used, both have information about the age of the patients.</p>
<p>The columns <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code>, can be used as a label in a future analysis, so they will not be as features of the created models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(806402, 94)
(62317, 94)
</pre></div></div>
</div>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DTRECIDIVA    717377
delta_t6      717377
delta_t5      717377
delta_t4      717377
IDADE              1
TRATAMENTO         0
dtype: int64
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DTRECIDIVA    57799
delta_t6      57799
delta_t5      57799
delta_t4      57799
NAOTRAT           0
LOCALTNM          0
dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="id8">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>To define the columns that will be used as features and the label, the process will be similar to the one used previously.</p>
<p>For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT,</span> <span class="pre">DTDIAG,</span> <span class="pre">DTTRAT,</span> <span class="pre">DTRECIDIVA,</span> <span class="pre">DTULTINFO</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>. Regarding <code class="docutils literal notranslate"><span class="pre">PERDASEG</span></code>, it has already been discussed in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Classifiers.html#Reading-the-data">classification - ob section</a>.</p>
<p>The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG,</span> <span class="pre">TRATCONS,</span> <span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1,</span> <span class="pre">delta_t2,</span> <span class="pre">delta_t3</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;IDADE&#39;</span><span class="p">,</span> <span class="s1">&#39;PERDASEG&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="s1">&#39;ano_ob&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;delta_t9&#39;</span>
</pre></div>
</div>
</div>
<p>Again we will use the function created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">,</span> <span class="n">y_testSP</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (604801, 70), X_test = (201601, 70)
y_train = (604801,), y_test = (201601,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">,</span> <span class="n">y_testFora</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (46737, 70), X_test = (15580, 70)
y_train = (46737,), y_test = (15580,)
</pre></div></div>
</div>
</div>
<div class="section" id="id9">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to preprocess the training data, for this we will use the function <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h2><strong>Training and evaluation the machine learning models</strong><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>To preprocess the test data we will usa the function <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_testSP_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span><span class="p">)</span>
<span class="n">X_testFora_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id11">
<h3><strong>Random Forest Regressor</strong><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest Regressor, for this test the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> and <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameters will be used, the first one to obtain the same training values of the model every time it is runned. The <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> to increase the depth of the tree in the training models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rfr_sp</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rfr_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestRegressor(bootstrap=True, ccp_alpha=0.0, criterion=&#39;mse&#39;,
                      max_depth=10, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                      max_samples=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      n_estimators=100, n_jobs=None, oob_score=False,
                      random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rfr_fora</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rfr_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestRegressor(bootstrap=True, ccp_alpha=0.0, criterion=&#39;mse&#39;,
                      max_depth=10, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                      max_samples=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      n_estimators=100, n_jobs=None, oob_score=False,
                      random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<p>Below we have the metrics for the Random Forest Regressor models, followed by the graph with the most important features for each model.</p>
<p>To calculate the metrics it was created a function, <code class="docutils literal notranslate"><span class="pre">validate_regression</span></code>, that returns some metrics of the model: MAE, MSE, RMSE and R².</p>
<blockquote>
<div><p>Go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a> to see the complete function.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testSP_</span><span class="p">,</span> <span class="n">rfr_sp</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 786.738
Mean Squared Error: 1202646.875
Root Mean Squared Error: 1096.653
Score: 0.407
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>400744</th>
      <td>1601</td>
      <td>972.655416</td>
    </tr>
    <tr>
      <th>369215</th>
      <td>821</td>
      <td>498.512299</td>
    </tr>
    <tr>
      <th>387264</th>
      <td>607</td>
      <td>1425.012203</td>
    </tr>
    <tr>
      <th>296234</th>
      <td>432</td>
      <td>372.219595</td>
    </tr>
    <tr>
      <th>712621</th>
      <td>932</td>
      <td>1047.650587</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>Using the difference in days between last information and treatment as label, a predictor with R² equal to 0.41 was obtained, representing a bad model to predict the value of delta_t9.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rfr_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_147_0.png" src="_images/Cancer_Regressors_147_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, <code class="docutils literal notranslate"><span class="pre">MORFO</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testFora_</span><span class="p">,</span> <span class="n">rfr_fora</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 661.286
Mean Squared Error: 930053.631
Root Mean Squared Error: 964.393
Score: 0.463
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1077</th>
      <td>722</td>
      <td>597.598551</td>
    </tr>
    <tr>
      <th>15361</th>
      <td>900</td>
      <td>1160.502572</td>
    </tr>
    <tr>
      <th>3301</th>
      <td>0</td>
      <td>149.705062</td>
    </tr>
    <tr>
      <th>32432</th>
      <td>3242</td>
      <td>2078.646844</td>
    </tr>
    <tr>
      <th>39694</th>
      <td>617</td>
      <td>1532.888781</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>As in the model for data from São Paulo, using data from other states, it was also not possible to obtain a good performance predicting delta_t9. The value of R² was 0.46, similar to the other Random Forest models for other states data.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rfr_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_152_0.png" src="_images/Cancer_Regressors_152_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">MORFO</span></code>, <code class="docutils literal notranslate"><span class="pre">EC</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="id12">
<h3><strong>XGBoost Regressor</strong><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Here will be tested the XGBoost Regressor, for this test the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> and <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> hyperparameters will be used, the first one to obtain the same training values of the model every time it is runned. The <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> to increase the depth of the tree in the training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgbr_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgbr_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, gamma=0,
             importance_type=&#39;gain&#39;, learning_rate=0.1, max_delta_step=0,
             max_depth=10, min_child_weight=1, missing=None, n_estimators=100,
             n_jobs=1, nthread=None, objective=&#39;reg:linear&#39;, random_state=10,
             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
             silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgbr_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgbr_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, gamma=0,
             importance_type=&#39;gain&#39;, learning_rate=0.1, max_delta_step=0,
             max_depth=10, min_child_weight=1, missing=None, n_estimators=100,
             n_jobs=1, nthread=None, objective=&#39;reg:linear&#39;, random_state=10,
             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
             silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<p>Below we have the metrics for the XGBoost Regressor models, followed by the graph with the most important features for each model.</p>
<p>To calculate the metrics it was created a function, <code class="docutils literal notranslate"><span class="pre">validate_regression</span></code>, that returns some metrics of the model: MAE, MSE, RMSE and R².</p>
<blockquote>
<div><p>Go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a> to see the complete function.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testSP_</span><span class="p">,</span> <span class="n">xgbr_sp</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 685.819
Mean Squared Error: 983335.065
Root Mean Squared Error: 991.633
Score: 0.515
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>400744</th>
      <td>1601</td>
      <td>1095.191040</td>
    </tr>
    <tr>
      <th>369215</th>
      <td>821</td>
      <td>519.250488</td>
    </tr>
    <tr>
      <th>387264</th>
      <td>607</td>
      <td>2122.545654</td>
    </tr>
    <tr>
      <th>296234</th>
      <td>432</td>
      <td>367.914001</td>
    </tr>
    <tr>
      <th>712621</th>
      <td>932</td>
      <td>1267.061646</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>With the XGBoost regressor, a better model for SP data was obtained in relation to the Random Forest model for the same data, as seen to the other labels, but the score value was 0.51, representing a not very good predictor.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgbr_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_162_0.png" src="_images/Cancer_Regressors_162_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">validate_regression</span><span class="p">(</span><span class="n">X_testFora_</span><span class="p">,</span> <span class="n">xgbr_fora</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean Absolute Error: 622.998
Mean Squared Error: 871323.837
Root Mean Squared Error: 933.447
Score: 0.497
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Real</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1077</th>
      <td>722</td>
      <td>292.516296</td>
    </tr>
    <tr>
      <th>15361</th>
      <td>900</td>
      <td>1164.710449</td>
    </tr>
    <tr>
      <th>3301</th>
      <td>0</td>
      <td>60.525486</td>
    </tr>
    <tr>
      <th>32432</th>
      <td>3242</td>
      <td>2262.347168</td>
    </tr>
    <tr>
      <th>39694</th>
      <td>617</td>
      <td>1506.699829</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<blockquote>
<div><p>As in the previous model, using the XGBoost regressor, a better model was obtained for data from other states in relation to the Random Forest model, with a score of 0.50, but still a model that does not present good prediction results.</p>
</div></blockquote>
<blockquote>
<div><p>None of the tested regressors showed good results, so to obtain good predictions for these cases, other methods should be sought.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgbr_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Cancer_Regressors_167_0.png" src="_images/Cancer_Regressors_167_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Cancer%20Classifiers.html" class="btn btn-neutral float-left" title="Classification - ob" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Lucas Buk Cardoso.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>