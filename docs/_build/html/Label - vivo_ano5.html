

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Classification - vivo_ano5 &mdash; Cancer Project Documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Classification - vivo_ano1" href="Label%20-%20vivo_ano1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cancer Project
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Libraries and functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html"><strong>Libraries</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#Functions"><strong>Functions</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#References"><strong>References</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Data Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models%202.0.html"><strong>Reading the data</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models%202.0.html#Data-analysis"><strong>Data analysis</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models%202.0.html#Creating-new-columns"><strong>Creating new columns</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Classification vivo_ano1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html"><strong>Classification - vivo_ano1</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Third-approach"><strong>Third approach</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Classification vivo_ano5</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Classification - vivo_ano5</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="#First-approach"><strong>First approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Training-and-testing-split"><strong>Training and testing split</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Encoder-and-normalization"><strong>Encoder and normalization</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#PCA"><strong>PCA</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Balancing-the-data"><strong>Balancing the data</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Training-machine-learning-models"><strong>Training machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost"><strong>XGBoost</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Models-evaluation"><strong>Models evaluation</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Preprocessing-of-testing-data"><strong>Preprocessing of testing data</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2"><strong>XGBoost</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Second-approach"><strong>Second approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id3"><strong>Reading the data</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4"><strong>Training and testing split</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5"><strong>Encoder and normalization</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6"><strong>PCA</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7"><strong>Balancing the data</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8"><strong>Training machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10"><strong>XGBoost</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11"><strong>Models evaluation</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12"><strong>Preprocessing of testing data</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14"><strong>XGBoost</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Third-approach"><strong>Third approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id15"><strong>Reading the data</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Grouped-years"><strong>Grouped years</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#SP"><strong>SP</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Other-states"><strong>Other states</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id16"><strong>Training and testing split</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id17"><strong>SP</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18"><strong>Other states</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id19"><strong>Encoder and normalization</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id20"><strong>SP</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21"><strong>Other states</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id22"><strong>Balancing the data</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23"><strong>SP</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24"><strong>Other states</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id25"><strong>Training machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id26"><strong>Preprocessing of testing data</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28"><strong>XGBoost</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cancer Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><strong>Classification - vivo_ano5</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Label - vivo_ano5.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Classification---vivo_ano5">
<h1><strong>Classification - vivo_ano5</strong><a class="headerlink" href="#Classification---vivo_ano5" title="Permalink to this headline">¶</a></h1>
<p>In this section, two machine learning models will be used to classify the <code class="docutils literal notranslate"><span class="pre">vivo_ano5</span></code> column, Random Forest and XGBoost, for both datasets, São Paulo and other states.</p>
<p>The label is 1 if the patient is alive after five years of treatment and 0 if not.</p>
<p>The first approach is using the “raw data”, the second is without the <code class="docutils literal notranslate"><span class="pre">EC</span></code> column and the third is using the grouped years.</p>
</div>
<div class="section" id="First-approach">
<h1><strong>First approach</strong><a class="headerlink" href="#First-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with “raw data”.</p>
<div class="section" id="Reading-the-data">
<h2><strong>Reading the data</strong><a class="headerlink" href="#Reading-the-data" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the columns <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code> will not be used in this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 92)
(32891, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      431715
delta_t6      431715
delta_t5      431715
DTRECIDIVA    431715
HORMONIO           0
QUIMIO             0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      29244
delta_t6      29244
delta_t5      29244
DTRECIDIVA    29244
HORMONIO          0
QUIMIO            0
dtype: int64
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano5&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano5       1.000000
delta_t8        0.829202
delta_t9        0.824152
delta_t7        0.823421
vivo_ano3       0.688613
delta_t5        0.590804
delta_t4        0.582029
delta_t6        0.580154
vivo_ano1       0.379191
ANODIAG         0.324126
ob              0.294475
ob_sem_rec      0.271408
vivo_sem_rec    0.256120
HORMONIO        0.198900
CATEATEND       0.177011
CIRURGIA        0.166085
MORFO           0.150870
ULTINFO         0.145083
G               0.118027
vivo_com_rec    0.105161
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano5&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano5       1.000000
delta_t8        0.818812
delta_t7        0.816039
delta_t9        0.814230
vivo_ano3       0.667262
delta_t4        0.588360
delta_t5        0.585092
delta_t6        0.579412
ANODIAG         0.378213
vivo_ano1       0.365313
ob              0.301465
ob_sem_rec      0.294331
CATEATEND       0.271218
vivo_sem_rec    0.265022
CIRURGIA        0.182209
HORMONIO        0.173752
ULTINFO         0.169878
REGISTRADO      0.149369
MORFO           0.132414
GLEASON         0.119970
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, it is clear that there is an imbalance, similar to the previous classification. We will need to fix this problem in the preprocessing step and in the models training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    350104
1    155933
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    23443
1     9448
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="Training-and-testing-split">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#Training-and-testing-split" title="Permalink to this headline">¶</a></h2>
<p>Before dividing the datasets, it is necessary to select only the patients who have been followed up for at least five years.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_ano5</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_SP_ano5</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(348678, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_ano5</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_fora_ano5</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(20559, 92)
</pre></div></div>
</div>
<p>Now we are going to divide the data into training and testing, to perform the training of the models and then their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">DTTRAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">DTULTINFO</span></code> and <code class="docutils literal notranslate"><span class="pre">DTPREENCH</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>.The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATCONS</span></code>, <code class="docutils literal notranslate"><span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>.</p>
<p>Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;DTPREENCH&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">]</span>

<span class="c1"># &#39;RECNENHUM&#39;, &#39;RECLOCAL&#39;, &#39;RECREGIO&#39;, &#39;REC01&#39;, &#39;REC02&#39;, &#39;REC03&#39;, &#39;RECDIST&#39;</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano5&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">,</span> <span class="n">y_testSP</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_ano5</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (261508, 66), X_test = (87170, 66)
y_train = (261508,), y_test = (87170,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">,</span> <span class="n">y_testFora</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_ano5</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (15419, 66), X_test = (5140, 66)
y_train = (15419,), y_test = (5140,)
</pre></div></div>
</div>
</div>
<div class="section" id="Encoder-and-normalization">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#Encoder-and-normalization" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to preprocess the training data, for this a function was created, <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="PCA">
<h2><strong>PCA</strong><a class="headerlink" href="#PCA" title="Permalink to this headline">¶</a></h2>
<p>Using the PCA, it is possible to reduce the dimensionality of the data, decreasing the number of features. As can be seen from the graphs below, with less features used in the models, smaller will be representativeness of the total data.</p>
<p>The preprocessing function of the training data already contains this possibility of using the PCA, just use the necessary parameters, see the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">principalComponents</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sum of explained variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_35_0.png" src="_images/Label_-_vivo_ano5_35_0.png" />
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">principalComponents</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sum of explained variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_38_0.png" src="_images/Label_-_vivo_ano5_38_0.png" />
</div>
</div>
</div>
<div class="section" id="Balancing-the-data">
<h2><strong>Balancing the data</strong><a class="headerlink" href="#Balancing-the-data" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier, we have unbalanced data, more labels with value 0 than in relation with value 1. Therefore, we will use methods to balance the data.</p>
<p>In both datasets an oversampling will be used, which creates new data for the label with less values (<code class="docutils literal notranslate"><span class="pre">vivo_ano5</span> <span class="pre">=</span> <span class="pre">1</span></code>), after that we have both labels with the same number of examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    144459
1    117049
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_SP</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(288918,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    8298
1    7121
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_fora</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(16596,)
</pre></div></div>
</div>
</div>
<div class="section" id="Training-machine-learning-models">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#Training-machine-learning-models" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder, normalizing and balancing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="Random-Forest">
<h3><strong>Random Forest</strong><a class="headerlink" href="#Random-Forest" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> and <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> hyperparameters will be used, the first one to obtain the same training values of the model every time it is runned. The <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used because even after balancing the data the model still has difficulty to learn the class with fewer examples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                               <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">2_000_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 2000000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">2_500_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 2500000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost">
<h3><strong>XGBoost</strong><a class="headerlink" href="#XGBoost" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A higher weight was also used for the class with fewer examples, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>, for both models.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 15 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Models-evaluation">
<h2><strong>Models evaluation</strong><a class="headerlink" href="#Models-evaluation" title="Permalink to this headline">¶</a></h2>
<p>After training the models, we will use the confusion matrix to verify the performances, the features importances for each model will also be obtained.</p>
<div class="section" id="Preprocessing-of-testing-data">
<h3><strong>Preprocessing of testing data</strong><a class="headerlink" href="#Preprocessing-of-testing-data" title="Permalink to this headline">¶</a></h3>
<p>The preprocessing of the test data was also done using a function, <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">X_testSP_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">X_testFora_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Below we have the confusion matrices for the Random Forest models, followed by the graph with the most important features for each model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_testSP_</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_67_0.png" src="_images/Label_-_vivo_ano5_67_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm with the SP data shows a good performance of the model, because we obtained a balanced main diagonal, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_69_0.png" src="_images/Label_-_vivo_ano5_69_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>. The last three being the difference, in days, between diagnosis and consultation, between treatment and consultation and between treatment and diagnosis, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_testFora_</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_71_0.png" src="_images/Label_-_vivo_ano5_71_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data, also shows a good performance of the model, we have a balanced main diagonal in the confusion matrix, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_73_0.png" src="_images/Label_-_vivo_ano5_73_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">IBGE</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>. <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> is the difference between diagnosis and consultation and <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> is the difference between treatment and consultation.</p>
</div></blockquote>
</div>
<div class="section" id="id2">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Below we have the confusion matrices for the XGBoost models, followed by the graph with the most important features for each model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_testSP_</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_77_0.png" src="_images/Label_-_vivo_ano5_77_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with the SP data shows a good performance of the model, similar to the Random Forest model. The accuracy was 84%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_79_0.png" src="_images/Label_-_vivo_ano5_79_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, then we have <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_testFora_</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_81_0.png" src="_images/Label_-_vivo_ano5_81_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with the data from another states also shows a good performance of the model, with 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_83_0.png" src="_images/Label_-_vivo_ano5_83_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="Second-approach">
<h1><strong>Second approach</strong><a class="headerlink" href="#Second-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach without column <code class="docutils literal notranslate"><span class="pre">EC</span></code> as a feature.</p>
<div class="section" id="id3">
<h2><strong>Reading the data</strong><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the columns <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code> will not be used in this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 92)
(32891, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      431715
delta_t6      431715
delta_t5      431715
DTRECIDIVA    431715
HORMONIO           0
QUIMIO             0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      29244
delta_t6      29244
delta_t5      29244
DTRECIDIVA    29244
HORMONIO          0
QUIMIO            0
dtype: int64
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano5&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano5       1.000000
delta_t8        0.829202
delta_t9        0.824152
delta_t7        0.823421
vivo_ano3       0.688613
delta_t5        0.590804
delta_t4        0.582029
delta_t6        0.580154
vivo_ano1       0.379191
ANODIAG         0.324126
ob              0.294475
ob_sem_rec      0.271408
vivo_sem_rec    0.256120
HORMONIO        0.198900
CATEATEND       0.177011
CIRURGIA        0.166085
MORFO           0.150870
ULTINFO         0.145083
G               0.118027
vivo_com_rec    0.105161
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano5&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano5       1.000000
delta_t8        0.818812
delta_t7        0.816039
delta_t9        0.814230
vivo_ano3       0.667262
delta_t4        0.588360
delta_t5        0.585092
delta_t6        0.579412
ANODIAG         0.378213
vivo_ano1       0.365313
ob              0.301465
ob_sem_rec      0.294331
CATEATEND       0.271218
vivo_sem_rec    0.265022
CIRURGIA        0.182209
HORMONIO        0.173752
ULTINFO         0.169878
REGISTRADO      0.149369
MORFO           0.132414
GLEASON         0.119970
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, it is clear that there is an imbalance, similar to the previous classification. We will need to fix this problem in the preprocessing step and in the models training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    350104
1    155933
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    23443
1     9448
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="id4">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Before dividing the datasets, it is necessary to select only the patients who have been followed up for at least five years.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_ano5</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_SP_ano5</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(348678, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_ano5</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_fora_ano5</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(20559, 92)
</pre></div></div>
</div>
<p>Now we are going to divide the data into training and testing, to perform the training of the models and then their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">DTTRAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">DTULTINFO</span></code> and <code class="docutils literal notranslate"><span class="pre">DTPREENCH</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">EC</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>.The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATCONS</span></code>, <code class="docutils literal notranslate"><span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>.</p>
<p>Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;DTPREENCH&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">]</span>

<span class="c1"># &#39;RECNENHUM&#39;, &#39;RECLOCAL&#39;, &#39;RECREGIO&#39;, &#39;REC01&#39;, &#39;REC02&#39;, &#39;REC03&#39;, &#39;RECDIST&#39;</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano5&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">,</span> <span class="n">y_testSP</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_ano5</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (261508, 65), X_test = (87170, 65)
y_train = (261508,), y_test = (87170,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">,</span> <span class="n">y_testFora</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_ano5</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (15419, 65), X_test = (5140, 65)
y_train = (15419,), y_test = (5140,)
</pre></div></div>
</div>
</div>
<div class="section" id="id5">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to preprocess the training data, for this a function was created, <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><strong>PCA</strong><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Using the PCA, it is possible to reduce the dimensionality of the data, decreasing the number of features. As can be seen from the graphs below, with less features used in the models, smaller will be representativeness of the total data.</p>
<p>The preprocessing function of the training data already contains this possibility of using the PCA, just use the necessary parameters, see the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">principalComponents</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sum of explained variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_119_0.png" src="_images/Label_-_vivo_ano5_119_0.png" />
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">principalComponents</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sum of explained variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_122_0.png" src="_images/Label_-_vivo_ano5_122_0.png" />
</div>
</div>
</div>
<div class="section" id="id7">
<h2><strong>Balancing the data</strong><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier, we have unbalanced data, more labels with value 0 than in relation with value 1. Therefore, we will use methods to balance the data.</p>
<p>In both datasets an oversampling will be used, which creates new data for the label with less values (<code class="docutils literal notranslate"><span class="pre">vivo_ano5</span> <span class="pre">=</span> <span class="pre">1</span></code>), after that we have both labels with the same number of examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    144459
1    117049
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_SP</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(288918,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    8298
1    7121
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_fora</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(16596,)
</pre></div></div>
</div>
</div>
<div class="section" id="id8">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder, normalizing and balancing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id9">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> and <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> hyperparameters will be used, the first one to obtain the same training values of the model every time it is runned. The <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used because even after balancing the data the model still has difficulty to learn the class with fewer examples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                               <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">2_000_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 2000000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">2_500_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 2500000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
</div>
<div class="section" id="id10">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A lower weight was also used for the class with fewer examples, in the other states model, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 15 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.9, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2><strong>Models evaluation</strong><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>After training the models, we will use the confusion matrix to verify the performances, the features importances for each model will also be obtained.</p>
<div class="section" id="id12">
<h3><strong>Preprocessing of testing data</strong><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The preprocessing of the test data was also done using a function, <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">X_testSP_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">X_testFora_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>Below we have the confusion matrices for the Random Forest models, followed by the graph with the most important features for each model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_testSP_</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_151_0.png" src="_images/Label_-_vivo_ano5_151_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm with the SP data shows a good performance of the model, because we obtained a balanced main diagonal, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_153_0.png" src="_images/Label_-_vivo_ano5_153_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>. The last three being the difference, in days, between diagnosis and consultation, between treatment and consultation and between treatment and diagnosis, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_testFora_</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_155_0.png" src="_images/Label_-_vivo_ano5_155_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data, also shows a good performance of the model, we have a balanced main diagonal in the confusion matrix, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_157_0.png" src="_images/Label_-_vivo_ano5_157_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>. <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> is the difference, in days, between diagnosis and consultation and <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> is the difference between treatment and consultation.</p>
</div></blockquote>
</div>
<div class="section" id="id14">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Below we have the confusion matrices for the XGBoost models, followed by the graph with the most important features for each model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_testSP_</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_161_0.png" src="_images/Label_-_vivo_ano5_161_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with the SP data shows a good performance of the model, similar to the Random Forest model. The accuracy was 84%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_163_0.png" src="_images/Label_-_vivo_ano5_163_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_testFora_</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_165_0.png" src="_images/Label_-_vivo_ano5_165_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with the data from another states also shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_167_0.png" src="_images/Label_-_vivo_ano5_167_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="Third-approach">
<h1><strong>Third approach</strong><a class="headerlink" href="#Third-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with grouped years and without the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>.</p>
<div class="section" id="id15">
<h2><strong>Reading the data</strong><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the columns <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code> will not be used in this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 92)
(32891, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      431715
delta_t6      431715
delta_t5      431715
DTRECIDIVA    431715
HORMONIO           0
QUIMIO             0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      29244
delta_t6      29244
delta_t5      29244
DTRECIDIVA    29244
HORMONIO          0
QUIMIO            0
dtype: int64
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano5&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano5       1.000000
delta_t8        0.829202
delta_t9        0.824152
delta_t7        0.823421
vivo_ano3       0.688613
delta_t5        0.590804
delta_t4        0.582029
delta_t6        0.580154
vivo_ano1       0.379191
ANODIAG         0.324126
ob              0.294475
ob_sem_rec      0.271408
vivo_sem_rec    0.256120
HORMONIO        0.198900
CATEATEND       0.177011
CIRURGIA        0.166085
MORFO           0.150870
ULTINFO         0.145083
G               0.118027
vivo_com_rec    0.105161
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;vivo_ano5&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
vivo_ano5       1.000000
delta_t8        0.818812
delta_t7        0.816039
delta_t9        0.814230
vivo_ano3       0.667262
delta_t4        0.588360
delta_t5        0.585092
delta_t6        0.579412
ANODIAG         0.378213
vivo_ano1       0.365313
ob              0.301465
ob_sem_rec      0.294331
CATEATEND       0.271218
vivo_sem_rec    0.265022
CIRURGIA        0.182209
HORMONIO        0.173752
ULTINFO         0.169878
REGISTRADO      0.149369
MORFO           0.132414
GLEASON         0.119970
Name: vivo_ano5, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, it is clear that there is an imbalance. We will need to fix this problem in the preprocessing step and in the models training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    350104
1    155933
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    23443
1     9448
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<p>Years of diagnosis present in the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
22
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
21
</pre></div></div>
</div>
</div>
<div class="section" id="Grouped-years">
<h2><strong>Grouped years</strong><a class="headerlink" href="#Grouped-years" title="Permalink to this headline">¶</a></h2>
<p>The years will be grouped as follows: 2000 to 2003, 2004 to 2007, 2008 to 2011, 2012 to 2015 and 2016 until the end. So we will have 5 datasets for SP and another 5 for other states.</p>
<div class="section" id="SP">
<h3><strong>SP</strong><a class="headerlink" href="#SP" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_00_03</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;</span> <span class="mi">2004</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2003    18407
2002    18059
2001    15456
2000    14576
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    37928
1    28570
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_04_07</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2004</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2007</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2005    21607
2007    21479
2006    20549
2004    19910
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    45639
1    37906
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_08_11</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2008</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2011</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2011    31001
2010    28461
2009    27128
2008    24381
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    59529
1    51442
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_12_15</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2012</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2015</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2014    36345
2015    35480
2013    34551
2012    32144
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    100521
1     37999
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_16_21</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;</span> <span class="mi">2015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2016    34137
2017    30927
2018    20888
2019    16054
2020     4495
2021        2
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    106487
1        16
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="Other-states">
<h3><strong>Other states</strong><a class="headerlink" href="#Other-states" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_00_03</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;</span> <span class="mi">2004</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2003    1086
2002     984
2001     865
2000     802
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    1961
1    1776
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_04_07</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2004</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2007</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2007    1483
2006    1352
2005    1276
2004    1146
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    2838
1    2419
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_08_11</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2008</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2011</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2011    1731
2009    1612
2008    1567
2010    1546
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    3635
1    2821
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_12_15</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2012</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2015</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2013    2333
2015    2280
2014    2028
2012    1968
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    6177
1    2432
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_16_20</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;</span> <span class="mi">2015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2016    2517
2017    2360
2018    1963
2019    1797
2020     195
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">vivo_ano5</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    8832
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id16">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<p>Before dividing the datasets, it is necessary to select only the patients who have been followed up for at least five years.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_00_03</span> <span class="o">=</span> <span class="n">df_SP_00_03</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(59719, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_04_07</span> <span class="o">=</span> <span class="n">df_SP_04_07</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(74406, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_08_11</span> <span class="o">=</span> <span class="n">df_SP_08_11</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(98161, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_12_15</span> <span class="o">=</span> <span class="n">df_SP_12_15</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(87862, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_16_21</span> <span class="o">=</span> <span class="n">df_SP_16_21</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(28530, 92)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_00_03</span> <span class="o">=</span> <span class="n">df_fora_00_03</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3451, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_04_07</span> <span class="o">=</span> <span class="n">df_fora_04_07</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4529, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_08_11</span> <span class="o">=</span> <span class="n">df_fora_08_11</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(5235, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_12_15</span> <span class="o">=</span> <span class="n">df_fora_12_15</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(5086, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_16_20</span> <span class="o">=</span> <span class="n">df_fora_16_20</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">ob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">vivo_ano5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))]</span>
<span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(2258, 92)
</pre></div></div>
</div>
<p>Now we are going to divide the data into training and testing, to perform the training of the models and then their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">DTTRAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">DTULTINFO</span></code> and <code class="docutils literal notranslate"><span class="pre">DTPREENCH</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">EC</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>. The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATCONS</span></code>, <code class="docutils literal notranslate"><span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>.</p>
<p>Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;DTPREENCH&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">]</span>

<span class="c1"># &#39;RECNENHUM&#39;, &#39;RECLOCAL&#39;, &#39;RECREGIO&#39;, &#39;REC01&#39;, &#39;REC02&#39;, &#39;REC03&#39;, &#39;RECDIST&#39;</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;vivo_ano5&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<p>The process will be done 5 times for SP and other states, using the datasets with grouped years.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="id17">
<h3><strong>SP</strong><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_00_03</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (44789, 65), X_test = (14930, 65)
y_train = (44789,), y_test = (14930,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_04_07</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (55804, 65), X_test = (18602, 65)
y_train = (55804,), y_test = (18602,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_08_11</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (73620, 65), X_test = (24541, 65)
y_train = (73620,), y_test = (24541,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_12_15</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (65896, 65), X_test = (21966, 65)
y_train = (65896,), y_test = (21966,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_16_21</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (21397, 65), X_test = (7133, 65)
y_train = (21397,), y_test = (7133,)
</pre></div></div>
</div>
</div>
<div class="section" id="id18">
<h3><strong>Other states</strong><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">,</span> <span class="n">y_trainFora_00_03</span><span class="p">,</span> <span class="n">y_testFora_00_03</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_00_03</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2588, 65), X_test = (863, 65)
y_train = (2588,), y_test = (863,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">,</span> <span class="n">y_trainFora_04_07</span><span class="p">,</span> <span class="n">y_testFora_04_07</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_04_07</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3396, 65), X_test = (1133, 65)
y_train = (3396,), y_test = (1133,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">,</span> <span class="n">y_trainFora_08_11</span><span class="p">,</span> <span class="n">y_testFora_08_11</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_08_11</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3926, 65), X_test = (1309, 65)
y_train = (3926,), y_test = (1309,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">,</span> <span class="n">y_trainFora_12_15</span><span class="p">,</span> <span class="n">y_testFora_12_15</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_12_15</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3814, 65), X_test = (1272, 65)
y_train = (3814,), y_test = (1272,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20</span><span class="p">,</span> <span class="n">y_trainFora_16_20</span><span class="p">,</span> <span class="n">y_testFora_16_20</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_16_20</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (1693, 65), X_test = (565, 65)
y_train = (1693,), y_test = (565,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id19">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to perform the preprocessing in the training data, for this a function was created, <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<p>This process also will be done for the ten datasets that we have.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="id20">
<h3><strong>SP</strong><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">enc_SP_00_03</span><span class="p">,</span> <span class="n">norm_SP_00_03</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">enc_SP_04_07</span><span class="p">,</span> <span class="n">norm_SP_04_07</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">enc_SP_08_11</span><span class="p">,</span> <span class="n">norm_SP_08_11</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">enc_SP_12_15</span><span class="p">,</span> <span class="n">norm_SP_12_15</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">enc_SP_16_21</span><span class="p">,</span> <span class="n">norm_SP_16_21</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id21">
<h3><strong>Other states</strong><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">enc_fora_00_03</span><span class="p">,</span> <span class="n">norm_fora_00_03</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">enc_fora_04_07</span><span class="p">,</span> <span class="n">norm_fora_04_07</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">enc_fora_08_11</span><span class="p">,</span> <span class="n">norm_fora_08_11</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">enc_fora_12_15</span><span class="p">,</span> <span class="n">norm_fora_12_15</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">enc_fora_16_20</span><span class="p">,</span> <span class="n">norm_fora_16_20</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id22">
<h2><strong>Balancing the data</strong><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier, we have unbalanced data, more labels with value 0 than with value 1, and some cases with more value 1 than with value 0. For unbalanced data, we will use methods to balance the data.</p>
<p>The oversampling method will be used, which creates new data for the label with less values, after that we have both labels with the same number of examples.</p>
<p>In the case of 2016 to 2020, we do not have the data after 5 years of monitoring, so no models will be created for this data.</p>
<div class="section" id="id23">
<h3><strong>SP</strong><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_00_03</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    23289
1    21500
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
<span class="n">y_SP_00_03</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(46578,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_04_07</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    28420
0    27384
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
<span class="n">y_SP_04_07</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(56840,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_08_11</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    38590
0    35030
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
<span class="n">y_SP_08_11</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(77180,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_12_15</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    37361
1    28535
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
<span class="n">y_SP_12_15</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(74722,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_16_21</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    21388
1        9
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
<span class="n">y_SP_16_21</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(42776,)
</pre></div></div>
</div>
</div>
<div class="section" id="id24">
<h3><strong>Other states</strong><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_00_03</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    1301
0    1287
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">y_trainFora_00_03</span><span class="p">)</span>
<span class="n">y_fora_00_03</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(2602,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_04_07</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    1808
0    1588
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">y_trainFora_04_07</span><span class="p">)</span>
<span class="n">y_fora_04_07</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3616,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_08_11</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    2132
0    1794
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">y_trainFora_08_11</span><span class="p">)</span>
<span class="n">y_fora_08_11</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4264,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_12_15</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    1964
1    1850
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">y_trainFora_12_15</span><span class="p">)</span>
<span class="n">y_fora_12_15</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3928,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_16_20</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    1693
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id25">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder, normalizing and balancing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id26">
<h3><strong>Preprocessing of testing data</strong><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>The preprocessing of the test data was also done using a function, <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters, and applied for all datasets that we have.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">X_testSP_00_03_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">enc_SP_00_03</span><span class="p">,</span> <span class="n">norm_SP_00_03</span><span class="p">)</span>
<span class="n">X_testSP_04_07_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">enc_SP_04_07</span><span class="p">,</span> <span class="n">norm_SP_04_07</span><span class="p">)</span>
<span class="n">X_testSP_08_11_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">enc_SP_08_11</span><span class="p">,</span> <span class="n">norm_SP_08_11</span><span class="p">)</span>
<span class="n">X_testSP_12_15_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">enc_SP_12_15</span><span class="p">,</span> <span class="n">norm_SP_12_15</span><span class="p">)</span>
<span class="n">X_testSP_16_21_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">enc_SP_16_21</span><span class="p">,</span> <span class="n">norm_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">X_testFora_00_03_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_00_03</span><span class="p">,</span> <span class="n">enc_fora_00_03</span><span class="p">,</span> <span class="n">norm_fora_00_03</span><span class="p">)</span>
<span class="n">X_testFora_04_07_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_04_07</span><span class="p">,</span> <span class="n">enc_fora_04_07</span><span class="p">,</span> <span class="n">norm_fora_04_07</span><span class="p">)</span>
<span class="n">X_testFora_08_11_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_08_11</span><span class="p">,</span> <span class="n">enc_fora_08_11</span><span class="p">,</span> <span class="n">norm_fora_08_11</span><span class="p">)</span>
<span class="n">X_testFora_12_15_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_12_15</span><span class="p">,</span> <span class="n">enc_fora_12_15</span><span class="p">,</span> <span class="n">norm_fora_12_15</span><span class="p">)</span>
<span class="n">X_testFora_16_20_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_16_20</span><span class="p">,</span> <span class="n">enc_fora_16_20</span><span class="p">,</span> <span class="n">norm_fora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id27">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>The first model is the Random Forest, the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used because even after balancing the data the models still have difficulty to learn the class with fewer examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">rf_sp_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">3_000_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 3000000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03_</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_287_0.png" src="_images/Label_-_vivo_ano5_287_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2000 to 2003, shows a good performance, with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_289_0.png" src="_images/Label_-_vivo_ano5_289_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> and <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">rf_sp_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">3_000_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 3000000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07_</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_292_0.png" src="_images/Label_-_vivo_ano5_292_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2004 to 2007, shows a so good performance of the model, with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_294_0.png" src="_images/Label_-_vivo_ano5_294_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">rf_sp_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">3_500_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 3500000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11_</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_297_0.png" src="_images/Label_-_vivo_ano5_297_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2008 to 2011, shows a good performance of the model, with 81% of accuray.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_299_0.png" src="_images/Label_-_vivo_ano5_299_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">rf_sp_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1_500_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 1500000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15_</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_302_0.png" src="_images/Label_-_vivo_ano5_302_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2012 to 2015, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_304_0.png" src="_images/Label_-_vivo_ano5_304_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">rf_sp_16_21</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3_500_000</span><span class="p">})</span>
<span class="n">rf_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 1, 1: 3500000}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_testSP_16_21</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    7126
1       7
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21_</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_308_0.png" src="_images/Label_-_vivo_ano5_308_0.png" />
</div>
</div>
<blockquote>
<div><p>This model has few examples so the result ends up being distorted.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_310_0.png" src="_images/Label_-_vivo_ano5_310_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">REGISTRADO</span></code>, <code class="docutils literal notranslate"><span class="pre">DRS</span></code> and <code class="docutils literal notranslate"><span class="pre">RRAS</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">rf_fora_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">3_500_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 3500000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03_</span><span class="p">,</span> <span class="n">y_testFora_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_314_0.png" src="_images/Label_-_vivo_ano5_314_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the other states data from 2000 to 2003, shows a good performance of the model, and we have a balanced main diagonal in the confusion matrix. The accuracy was 76%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_316_0.png" src="_images/Label_-_vivo_ano5_316_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">rf_fora_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">3_800_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 3800000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07_</span><span class="p">,</span> <span class="n">y_testFora_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_319_0.png" src="_images/Label_-_vivo_ano5_319_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2004 to 2007, also shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_321_0.png" src="_images/Label_-_vivo_ano5_321_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> and <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">rf_fora_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">4_000_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 4000000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11_</span><span class="p">,</span> <span class="n">y_testFora_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_324_0.png" src="_images/Label_-_vivo_ano5_324_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2008 to 2011, also shows a very good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_326_0.png" src="_images/Label_-_vivo_ano5_326_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">IBGE</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">rf_fora_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">3_500_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 3500000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15_</span><span class="p">,</span> <span class="n">y_testFora_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_329_0.png" src="_images/Label_-_vivo_ano5_329_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2012 to 2015, also shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_331_0.png" src="_images/Label_-_vivo_ano5_331_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code> and <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="id28">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost models follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. The hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> was also used in the trainings, in order to obtain a balanced main diagonal in the confusion matrix.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 15 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">xgb_sp_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03_</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_337_0.png" src="_images/Label_-_vivo_ano5_337_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2000 to 2003, shows a very good performance of the model, as well as the Random Forest model, here with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_339_0.png" src="_images/Label_-_vivo_ano5_339_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">xgb_sp_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">xgb_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.9, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07_</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_342_0.png" src="_images/Label_-_vivo_ano5_342_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2004 to 2007, shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_344_0.png" src="_images/Label_-_vivo_ano5_344_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">xgb_sp_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">xgb_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.8, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11_</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_347_0.png" src="_images/Label_-_vivo_ano5_347_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2008 to 2011, shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_349_0.png" src="_images/Label_-_vivo_ano5_349_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code> and <code class="docutils literal notranslate"><span class="pre">RECDIST</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">xgb_sp_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">xgb_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1.5, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15_</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_352_0.png" src="_images/Label_-_vivo_ano5_352_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2012 to 2015, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_354_0.png" src="_images/Label_-_vivo_ano5_354_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, then we have <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">xgb_sp_16_21</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">100_000_000_000_000</span><span class="p">)</span>
<span class="n">xgb_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=100000000000000,
              seed=None, silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_testSP_16_21</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    7126
1       7
Name: vivo_ano5, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21_</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_358_0.png" src="_images/Label_-_vivo_ano5_358_0.png" />
</div>
</div>
<blockquote>
<div><p>This model has few examples so the result ends up being distorted.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_360_0.png" src="_images/Label_-_vivo_ano5_360_0.png" />
</div>
</div>
<blockquote>
<div><p>The two most important features in the model were <code class="docutils literal notranslate"><span class="pre">SEXO</span></code> and <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">xgb_fora_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">xgb_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.7, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03_</span><span class="p">,</span> <span class="n">y_testFora_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_364_0.png" src="_images/Label_-_vivo_ano5_364_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2000 to 2003, also shows a good performance of the model.</p>
</div></blockquote>
<blockquote>
<div><p>We also obtained a confusion matrix with the main diagonal a little unbalanced, with 77% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_366_0.png" src="_images/Label_-_vivo_ano5_366_0.png" />
</div>
</div>
<blockquote>
<div><p>The two most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">REC01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">xgb_fora_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.7, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07_</span><span class="p">,</span> <span class="n">y_testFora_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_369_0.png" src="_images/Label_-_vivo_ano5_369_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2004 to 2007, also shows a very good performance of the model with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_371_0.png" src="_images/Label_-_vivo_ano5_371_0.png" />
</div>
</div>
<blockquote>
<div><p>The two most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">xgb_fora_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.8, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11_</span><span class="p">,</span> <span class="n">y_testFora_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_374_0.png" src="_images/Label_-_vivo_ano5_374_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states from 2008 to 2011, presented 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_376_0.png" src="_images/Label_-_vivo_ano5_376_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code> and <code class="docutils literal notranslate"><span class="pre">REC01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">xgb_fora_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.8, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15_</span><span class="p">,</span> <span class="n">y_testFora_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_379_0.png" src="_images/Label_-_vivo_ano5_379_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2012 to 2015, presented 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_vivo_ano5_381_0.png" src="_images/Label_-_vivo_ano5_381_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">TRATHOSP</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Label%20-%20vivo_ano1.html" class="btn btn-neutral float-left" title="Classification - vivo_ano1" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Lucas Buk Cardoso.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>