

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Introduction &mdash; Cancer Project Documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introduction" href="Label%20-%20vivo_ano1.html" />
    <link rel="prev" title="Introduction" href="Label%20-%20obito_geral.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cancer Project
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Libraries and functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html"><strong>Data Dictionary</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#Libraries"><strong>Libraries</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#Functions"><strong>Functions</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#References"><strong>References</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models.html"><strong>Reading the data</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models.html#Data-analysis"><strong>Data analysis</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models.html#Creating-new-columns"><strong>Creating new columns</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification obito_geral</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html#Third-approach"><strong>Third approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20obito_geral.html#Fourth-approach"><strong>Fourth approach</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification obito_cancer</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="#First-approach"><strong>First approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Preprocessing"><strong>Preprocessing</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Training-machine-learning-models"><strong>Training machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost"><strong>XGBoost</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Second-approach"><strong>Second approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1"><strong>Preprocessing</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2"><strong>Training machine learning models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4"><strong>XGBoost</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Third-approach"><strong>Third approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id5"><strong>Preprocessing</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#SP"><strong>SP</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Other-states"><strong>Other states</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Training-and-evaluation-of-the-models"><strong>Training and evaluation of the models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7"><strong>XGBoost</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Testing-models-with-data-from-other-years"><strong>Testing models with data from other years</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-SP-for-years-2000-to-2003"><strong>Random Forest SP for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-SP-for-years-2000-to-2003"><strong>XGBoost SP for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-SP-for-years-2004-to-2007"><strong>Random Forest SP for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-SP-for-years-2004-to-2007"><strong>XGBoost SP for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-SP-for-years-2008-to-2011"><strong>Random Forest SP for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-SP-for-years-2008-to-2011"><strong>XGBoost SP for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-SP-for-years-2012-to-2015"><strong>Random Forest SP for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-SP-for-years-2012-to-2015"><strong>XGBoost SP for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Other-states-for-years-2000-to-2003"><strong>Random Forest Other states for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Other-states-for-years-2000-to-2003"><strong>XGBoost Other states for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Other-states-for-years-2004-to-2007"><strong>Random Forest Other states for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Other-states-for-years-2004-to-2007"><strong>XGBoost Other states for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Other-states-for-years-2008-to-2011"><strong>Random Forest Other states for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Other-states-for-years-2008-to-2011"><strong>XGBoost Other states for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Random-Forest-Other-states-for-years-2012-to-2015"><strong>Random Forest Other states for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost-Other-states-for-years-2012-to-2015"><strong>XGBoost Other states for years 2012 to 2015</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Fourth-approach"><strong>Fourth approach</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id8"><strong>Preprocessing</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9"><strong>SP</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10"><strong>Other states</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11"><strong>Training and evaluation of the models</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12"><strong>Random Forest</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13"><strong>XGBoost</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id14"><strong>Testing models with data from other years</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id15"><strong>Random Forest SP for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16"><strong>XGBoost SP for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17"><strong>Random Forest SP for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18"><strong>XGBoost SP for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19"><strong>Random Forest SP for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20"><strong>XGBoost SP for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21"><strong>Random Forest SP for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22"><strong>XGBoost SP for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23"><strong>Random Forest Other states for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24"><strong>XGBoost Other states for years 2000 to 2003</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25"><strong>Random Forest Other states for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26"><strong>XGBoost Other states for years 2004 to 2007</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27"><strong>Random Forest Other states for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28"><strong>XGBoost Other states for years 2008 to 2011</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29"><strong>Random Forest Other states for years 2012 to 2015</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id30"><strong>XGBoost Other states for years 2012 to 2015</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification vivo_ano1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Third-approach"><strong>Third approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Fourth-approach"><strong>Fourth approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Fifth-approach"><strong>Fifth approach</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification vivo_ano3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano3.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano3.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano3.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano3.html#Third-approach"><strong>Third approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano3.html#Fourth-approach"><strong>Fourth approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano3.html#Fifth-approach"><strong>Fifth approach</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Classification vivo_ano5</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Third-approach"><strong>Third approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Fourth-approach"><strong>Fourth approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Fifth-approach"><strong>Fifth approach</strong></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cancer Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><strong>Introduction</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Label - obito_cancer.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Introduction">
<h1><strong>Introduction</strong><a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h1>
<p>In this section, two machine learning models will be used to classify the <code class="docutils literal notranslate"><span class="pre">obito_cancer</span></code> column, Random Forest and XGBoost, for both datasets, São Paulo and other states.</p>
<p>The label is 0 if the person is alive and 1 if he / she died by cancer.</p>
<p>Four scenarios will be created using the column <code class="docutils literal notranslate"><span class="pre">obito_cancer</span></code> as label. The first is the raw data for São Paulo and other states, as was generated in the previous section. The second scenario considers only patients with morphology with the last digit being 3, in addition, the <code class="docutils literal notranslate"><span class="pre">EC</span></code> column was removed.</p>
<p>The third and fourth scenarios use the years of diagnosis grouped, the last one also considering only morphologies with the final digit 3. The years will be grouped as follows: 2000 to 2003, 2004 to 2007, 2008 to 2011, 2012 to 2015 and 2016 until the end. So we will have 5 datasets for SP and another 5 for other states.</p>
<p>Reading the data from SP and other states.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 77)
(32891, 77)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SEXO         0
IMUNOAPOS    0
FAIXAETAR    0
ANODIAG      0
DIAGTRAT     0
TRATCONS     0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SEXO         0
IMUNOAPOS    0
FAIXAETAR    0
ANODIAG      0
DIAGTRAT     0
TRATCONS     0
dtype: int64
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;obito_cancer&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
obito_cancer    1.000000
obito_geral     0.778975
ULTINFO         0.456566
vivo_ano3       0.403906
ULTIDIAG        0.377902
ULTICONS        0.375342
ULTITRAT        0.370999
vivo_ano1       0.334877
vivo_ano5       0.332117
QUIMIO          0.283284
CIRURGIA        0.267225
RECNENHUM       0.254474
MORFO           0.190021
RECREGIO        0.179450
ANODIAG         0.167594
RECDIST         0.163555
CATEATEND       0.155688
HORMONIO        0.142165
GLEASON         0.130975
PSA             0.129883
Name: obito_cancer, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;obito_cancer&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
obito_cancer    1.000000
obito_geral     0.847824
ULTINFO         0.564266
vivo_ano3       0.399038
ULTIDIAG        0.371161
ULTICONS        0.366288
ULTITRAT        0.360228
vivo_ano5       0.314455
vivo_ano1       0.313149
CIRURGIA        0.307777
QUIMIO          0.285630
MORFO           0.176119
CATEATEND       0.161740
RECNENHUM       0.151496
ANODIAG         0.145834
HORMONIO        0.138524
GLEASON         0.137212
PSA             0.135158
RECDIST         0.122614
ESCOLARI        0.121089
Name: obito_cancer, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, it is possible to notice that there is an imbalance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">obito_cancer</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    336921
1    169116
Name: obito_cancer, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">obito_cancer</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    22802
1    10089
Name: obito_cancer, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="First-approach">
<h1><strong>First approach</strong><a class="headerlink" href="#First-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with “raw data”.</p>
<div class="section" id="Preprocessing">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#Preprocessing" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_geral&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;obito_cancer&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (379527, 66), X_test = (126510, 66)
y_train = (379527,), y_test = (126510,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (24668, 66), X_test = (8223, 66)
y_train = (24668,), y_test = (8223,)
</pre></div></div>
</div>
</div>
<div class="section" id="Training-machine-learning-models">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#Training-machine-learning-models" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="Random-Forest">
<h3><strong>Random Forest</strong><a class="headerlink" href="#Random-Forest" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test the parameter <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was also used, because the model has difficulty learning the class with fewer examples, so using this parameter this class will have a higher weight in the training of the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.775</span><span class="p">},</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                               <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                               <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.775}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_26_0.png" src="_images/Label_-_obito_cancer_26_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.91      0.83      0.86     84077
           1       0.71      0.83      0.76     42433

    accuracy                           0.83    126510
   macro avg       0.81      0.83      0.81    126510
weighted avg       0.84      0.83      0.83    126510

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data, also shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_28_0.png" src="_images/Label_-_obito_cancer_28_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_29_0.png" src="_images/Label_-_obito_cancer_29_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_30_0.png" src="_images/Label_-_obito_cancer_30_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_32_0.png" src="_images/Label_-_obito_cancer_32_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">EC</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">2.034</span><span class="p">},</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                 <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 2.034}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_35_0.png" src="_images/Label_-_obito_cancer_35_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.91      0.82      0.86      5706
           1       0.67      0.82      0.74      2517

    accuracy                           0.82      8223
   macro avg       0.79      0.82      0.80      8223
weighted avg       0.84      0.82      0.82      8223

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm with the other states data shows a good performance of the model, because the model achieves a 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_37_0.png" src="_images/Label_-_obito_cancer_37_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_38_0.png" src="_images/Label_-_obito_cancer_38_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_39_0.png" src="_images/Label_-_obito_cancer_39_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_41_0.png" src="_images/Label_-_obito_cancer_41_0.png" />
</div>
</div>
<p>Again larger values of the <code class="docutils literal notranslate"><span class="pre">EC</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="XGBoost">
<h3><strong>XGBoost</strong><a class="headerlink" href="#XGBoost" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A higher weight was also used for the class with fewer examples, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                               <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.89</span><span class="p">,</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.89)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_46_0.png" src="_images/Label_-_obito_cancer_46_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.85      0.88     84077
           1       0.74      0.85      0.79     42433

    accuracy                           0.85    126510
   macro avg       0.83      0.85      0.84    126510
weighted avg       0.86      0.85      0.85    126510

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data, also shows a good performance of the model, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_48_0.png" src="_images/Label_-_obito_cancer_48_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_49_0.png" src="_images/Label_-_obito_cancer_49_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot advantage over the others, <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code> and <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_51_0.png" src="_images/Label_-_obito_cancer_51_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">EC</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=8, random_state=10, scale_pos_weight=2.6)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_54_0.png" src="_images/Label_-_obito_cancer_54_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.83      0.87      5706
           1       0.68      0.83      0.75      2517

    accuracy                           0.83      8223
   macro avg       0.80      0.83      0.81      8223
weighted avg       0.85      0.83      0.83      8223

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with SP data shows a good performance of the model, because the model achieves a 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_56_0.png" src="_images/Label_-_obito_cancer_56_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_57_0.png" src="_images/Label_-_obito_cancer_57_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage, <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_59_0.png" src="_images/Label_-_obito_cancer_59_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">EC</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
</div>
<div class="section" id="Second-approach">
<h1><strong>Second approach</strong><a class="headerlink" href="#Second-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach using only morphologies with final digit equal to 3 and without <code class="docutils literal notranslate"><span class="pre">EC</span></code> column as a feature.</p>
<div class="section" id="id1">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_geral&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;obito_cancer&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (351486, 65), X_test = (117163, 65)
y_train = (351486,), y_test = (117163,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                           <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                           <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                           <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                           <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (23079, 65), X_test = (7693, 65)
y_train = (23079,), y_test = (7693,)
</pre></div></div>
</div>
</div>
<div class="section" id="id2">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id3">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test the parameter <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was also used because the model has difficulty learning the class with fewer examples, so using this parameter this class will have a higher weight in the training of the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                               <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.67</span><span class="p">},</span>
                               <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                               <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.67}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_76_0.png" src="_images/Label_-_obito_cancer_76_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.82      0.85     74785
           1       0.72      0.82      0.77     42378

    accuracy                           0.82    117163
   macro avg       0.81      0.82      0.81    117163
weighted avg       0.83      0.82      0.82    117163

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data, also shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_78_0.png" src="_images/Label_-_obito_cancer_78_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_79_0.png" src="_images/Label_-_obito_cancer_79_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_80_0.png" src="_images/Label_-_obito_cancer_80_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_82_0.png" src="_images/Label_-_obito_cancer_82_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.72</span><span class="p">},</span>
                                 <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                 <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.72}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_85_0.png" src="_images/Label_-_obito_cancer_85_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.82      0.86      5162
           1       0.68      0.82      0.74      2531

    accuracy                           0.82      7693
   macro avg       0.79      0.82      0.80      7693
weighted avg       0.83      0.82      0.82      7693

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm with other states data shows a good performance of the model, because the model achieves a 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_87_0.png" src="_images/Label_-_obito_cancer_87_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_88_0.png" src="_images/Label_-_obito_cancer_88_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_89_0.png" src="_images/Label_-_obito_cancer_89_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_91_0.png" src="_images/Label_-_obito_cancer_91_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="id4">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A higher weight was also used for the class with fewer examples, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                               <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.7</span><span class="p">,</span>
                               <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.7)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_96_0.png" src="_images/Label_-_obito_cancer_96_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.84      0.87     74785
           1       0.75      0.84      0.79     42378

    accuracy                           0.84    117163
   macro avg       0.83      0.84      0.83    117163
weighted avg       0.85      0.84      0.84    117163

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data, also shows a good performance of the model, with 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_train_SP</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">y_train_SP</span><span class="p">,</span> <span class="n">y_test_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_98_0.png" src="_images/Label_-_obito_cancer_98_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_99_0.png" src="_images/Label_-_obito_cancer_99_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_test_SP</span><span class="p">,</span> <span class="n">feat_cols_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_101_0.png" src="_images/Label_-_obito_cancer_101_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">2.03</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=8, random_state=10, scale_pos_weight=2.03)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_104_0.png" src="_images/Label_-_obito_cancer_104_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.91      0.83      0.86      5162
           1       0.70      0.83      0.76      2531

    accuracy                           0.83      7693
   macro avg       0.80      0.83      0.81      7693
weighted avg       0.84      0.83      0.83      7693

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with SP data shows a good performance of the model, because the model achieves a 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_train_OS</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">y_train_OS</span><span class="p">,</span> <span class="n">y_test_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_106_0.png" src="_images/Label_-_obito_cancer_106_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_107_0.png" src="_images/Label_-_obito_cancer_107_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">CATEATEND</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_test_OS</span><span class="p">,</span> <span class="n">feat_cols_OS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_109_0.png" src="_images/Label_-_obito_cancer_109_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
</div>
<div class="section" id="Third-approach">
<h1><strong>Third approach</strong><a class="headerlink" href="#Third-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with grouped years and without the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>.</p>
<div class="section" id="id5">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation. We will use the years grouped too, resulting in 5 datasets for SP and more 5 for other states.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_geral&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;obito_cancer&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<p>The process will be done 5 times for SP and other states, using the datasets with grouped years.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="SP">
<h3><strong>SP</strong><a class="headerlink" href="#SP" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (49873, 65), X_test = (16625, 65)
y_train = (49873,), y_test = (16625,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (62658, 65), X_test = (20887, 65)
y_train = (62658,), y_test = (20887,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2011</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (83228, 65), X_test = (27743, 65)
y_train = (83228,), y_test = (27743,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (103890, 65), X_test = (34630, 65)
y_train = (103890,), y_test = (34630,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2016</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2021</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (79877, 65), X_test = (26626, 65)
y_train = (79877,), y_test = (26626,)
</pre></div></div>
</div>
</div>
<div class="section" id="Other-states">
<h3><strong>Other states</strong><a class="headerlink" href="#Other-states" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2802, 65), X_test = (935, 65)
y_train = (2802,), y_test = (935,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3942, 65), X_test = (1315, 65)
y_train = (3942,), y_test = (1315,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2011</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (4842, 65), X_test = (1614, 65)
y_train = (4842,), y_test = (1614,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (6456, 65), X_test = (2153, 65)
y_train = (6456,), y_test = (2153,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">first_year</span><span class="o">=</span><span class="mi">2016</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (6624, 65), X_test = (2208, 65)
y_train = (6624,), y_test = (2208,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Training-and-evaluation-of-the-models">
<h2><strong>Training and evaluation of the models</strong><a class="headerlink" href="#Training-and-evaluation-of-the-models" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id6">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The first model is the Random Forest, the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used because the models still have difficulty to learn the class with fewer examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">rf_sp_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.183</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.183}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_135_0.png" src="_images/Label_-_obito_cancer_135_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.80      0.82      9240
           1       0.76      0.80      0.78      7385

    accuracy                           0.80     16625
   macro avg       0.80      0.80      0.80     16625
weighted avg       0.80      0.80      0.80     16625

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2000 to 2003, shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_137_0.png" src="_images/Label_-_obito_cancer_137_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_138_0.png" src="_images/Label_-_obito_cancer_138_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_139_0.png" src="_images/Label_-_obito_cancer_139_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>, and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_141_0.png" src="_images/Label_-_obito_cancer_141_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">rf_sp_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.33</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.33}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_144_0.png" src="_images/Label_-_obito_cancer_144_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.82      0.84     12254
           1       0.76      0.82      0.79      8633

    accuracy                           0.82     20887
   macro avg       0.81      0.82      0.81     20887
weighted avg       0.82      0.82      0.82     20887

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2004 to 2007, shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_146_0.png" src="_images/Label_-_obito_cancer_146_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_147_0.png" src="_images/Label_-_obito_cancer_147_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_148_0.png" src="_images/Label_-_obito_cancer_148_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_150_0.png" src="_images/Label_-_obito_cancer_150_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">rf_sp_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.605</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.605}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_153_0.png" src="_images/Label_-_obito_cancer_153_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.83      0.86     17545
           1       0.74      0.83      0.79     10198

    accuracy                           0.83     27743
   macro avg       0.82      0.83      0.82     27743
weighted avg       0.84      0.83      0.83     27743

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2008 to 2011, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_155_0.png" src="_images/Label_-_obito_cancer_155_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_156_0.png" src="_images/Label_-_obito_cancer_156_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_157_0.png" src="_images/Label_-_obito_cancer_157_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_159_0.png" src="_images/Label_-_obito_cancer_159_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">rf_sp_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">2.2</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 2.2}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_162_0.png" src="_images/Label_-_obito_cancer_162_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.84      0.88     24288
           1       0.69      0.84      0.76     10342

    accuracy                           0.84     34630
   macro avg       0.81      0.84      0.82     34630
weighted avg       0.86      0.84      0.84     34630

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2012 to 2015, shows a good performance of the model with 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_164_0.png" src="_images/Label_-_obito_cancer_164_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_165_0.png" src="_images/Label_-_obito_cancer_165_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_166_0.png" src="_images/Label_-_obito_cancer_166_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_168_0.png" src="_images/Label_-_obito_cancer_168_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">rf_sp_16_21</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">3.1</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 3.1}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_171_0.png" src="_images/Label_-_obito_cancer_171_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.84      0.89     20945
           1       0.58      0.84      0.69      5681

    accuracy                           0.84     26626
   macro avg       0.77      0.84      0.79     26626
weighted avg       0.87      0.84      0.85     26626

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2016 to 2021, shows a good performance of the model, with 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_173_0.png" src="_images/Label_-_obito_cancer_173_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_174_0.png" src="_images/Label_-_obito_cancer_174_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_175_0.png" src="_images/Label_-_obito_cancer_175_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_177_0.png" src="_images/Label_-_obito_cancer_177_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">rf_fora_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.8505</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.8505}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_181_0.png" src="_images/Label_-_obito_cancer_181_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.76      0.79       563
           1       0.68      0.76      0.72       372

    accuracy                           0.76       935
   macro avg       0.75      0.76      0.76       935
weighted avg       0.77      0.76      0.76       935

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2000 to 2003, also shows a good performance of the model, and we have a balanced main diagonal with 76% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_183_0.png" src="_images/Label_-_obito_cancer_183_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_184_0.png" src="_images/Label_-_obito_cancer_184_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_185_0.png" src="_images/Label_-_obito_cancer_185_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_187_0.png" src="_images/Label_-_obito_cancer_187_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">rf_fora_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.5</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.5}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_190_0.png" src="_images/Label_-_obito_cancer_190_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.82      0.85       818
           1       0.73      0.82      0.77       497

    accuracy                           0.82      1315
   macro avg       0.81      0.82      0.81      1315
weighted avg       0.83      0.82      0.82      1315

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2004 to 2007, also shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_192_0.png" src="_images/Label_-_obito_cancer_192_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_193_0.png" src="_images/Label_-_obito_cancer_193_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_194_0.png" src="_images/Label_-_obito_cancer_194_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_196_0.png" src="_images/Label_-_obito_cancer_196_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">rf_fora_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">2.19</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 2.19}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_199_0.png" src="_images/Label_-_obito_cancer_199_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.80      0.84      1054
           1       0.69      0.81      0.74       560

    accuracy                           0.81      1614
   macro avg       0.79      0.81      0.79      1614
weighted avg       0.82      0.81      0.81      1614

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2008 to 2011, also shows a good performance of the model, presenting 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_201_0.png" src="_images/Label_-_obito_cancer_201_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_202_0.png" src="_images/Label_-_obito_cancer_202_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_203_0.png" src="_images/Label_-_obito_cancer_203_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_205_0.png" src="_images/Label_-_obito_cancer_205_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">rf_fora_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">3.1</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 3.1}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_208_0.png" src="_images/Label_-_obito_cancer_208_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.83      0.88      1565
           1       0.65      0.83      0.73       588

    accuracy                           0.83      2153
   macro avg       0.79      0.83      0.80      2153
weighted avg       0.85      0.83      0.84      2153

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2012 to 2015, also shows a good performance of the model, presenting 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_210_0.png" src="_images/Label_-_obito_cancer_210_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_211_0.png" src="_images/Label_-_obito_cancer_211_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_212_0.png" src="_images/Label_-_obito_cancer_212_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_214_0.png" src="_images/Label_-_obito_cancer_214_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">rf_fora_16_20</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">3.55</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">rf_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 3.55}, criterion=&#39;entropy&#39;,
                       max_depth=8, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_217_0.png" src="_images/Label_-_obito_cancer_217_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.94      0.84      0.89      1690
           1       0.62      0.84      0.71       518

    accuracy                           0.84      2208
   macro avg       0.78      0.84      0.80      2208
weighted avg       0.87      0.84      0.85      2208

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2016 to 2020, also shows a good performance of the model, presenting 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_219_0.png" src="_images/Label_-_obito_cancer_219_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_220_0.png" src="_images/Label_-_obito_cancer_220_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_221_0.png" src="_images/Label_-_obito_cancer_221_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_223_0.png" src="_images/Label_-_obito_cancer_223_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="id7">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost models follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. The hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> was also used in the trainings, in order to obtain a balanced main diagonal in the confusion matrix.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">xgb_sp_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.25</span><span class="p">)</span>

<span class="n">xgb_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.25)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_229_0.png" src="_images/Label_-_obito_cancer_229_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.84      0.81      0.83      9240
           1       0.78      0.81      0.79      7385

    accuracy                           0.81     16625
   macro avg       0.81      0.81      0.81     16625
weighted avg       0.81      0.81      0.81     16625

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2000 to 2003, shows a good performance of the model, here with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_231_0.png" src="_images/Label_-_obito_cancer_231_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_232_0.png" src="_images/Label_-_obito_cancer_232_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_234_0.png" src="_images/Label_-_obito_cancer_234_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">xgb_sp_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.55</span><span class="p">)</span>

<span class="n">xgb_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.55)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_237_0.png" src="_images/Label_-_obito_cancer_237_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.83      0.85     12254
           1       0.78      0.83      0.80      8633

    accuracy                           0.83     20887
   macro avg       0.83      0.83      0.83     20887
weighted avg       0.84      0.83      0.83     20887

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2004 to 2007, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_239_0.png" src="_images/Label_-_obito_cancer_239_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_240_0.png" src="_images/Label_-_obito_cancer_240_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_242_0.png" src="_images/Label_-_obito_cancer_242_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">xgb_sp_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.85)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_245_0.png" src="_images/Label_-_obito_cancer_245_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.91      0.85      0.88     17545
           1       0.76      0.85      0.80     10198

    accuracy                           0.85     27743
   macro avg       0.83      0.85      0.84     27743
weighted avg       0.85      0.85      0.85     27743

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2008 to 2011, shows a good performance of the model, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_247_0.png" src="_images/Label_-_obito_cancer_247_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_248_0.png" src="_images/Label_-_obito_cancer_248_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_250_0.png" src="_images/Label_-_obito_cancer_250_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">xgb_sp_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">2.55</span><span class="p">)</span>

<span class="n">xgb_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=2.55)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_253_0.png" src="_images/Label_-_obito_cancer_253_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.86      0.89     24288
           1       0.72      0.86      0.78     10342

    accuracy                           0.86     34630
   macro avg       0.82      0.86      0.84     34630
weighted avg       0.87      0.86      0.86     34630

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2012 to 2015, shows a good performance of the model, with 86% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_255_0.png" src="_images/Label_-_obito_cancer_255_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_256_0.png" src="_images/Label_-_obito_cancer_256_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. Following we have <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_258_0.png" src="_images/Label_-_obito_cancer_258_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">xgb_sp_16_21</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">4.9</span><span class="p">)</span>

<span class="n">xgb_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=4.9)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_261_0.png" src="_images/Label_-_obito_cancer_261_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.85      0.90     20945
           1       0.61      0.85      0.71      5681

    accuracy                           0.85     26626
   macro avg       0.78      0.85      0.80     26626
weighted avg       0.88      0.85      0.86     26626

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2016 to 2021, shows a good performance of the model, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_263_0.png" src="_images/Label_-_obito_cancer_263_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_264_0.png" src="_images/Label_-_obito_cancer_264_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">RECDIST</span></code> and <code class="docutils literal notranslate"><span class="pre">GLEASON</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_266_0.png" src="_images/Label_-_obito_cancer_266_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">xgb_fora_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.885</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=1.885)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_270_0.png" src="_images/Label_-_obito_cancer_270_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.76      0.79       563
           1       0.68      0.76      0.72       372

    accuracy                           0.76       935
   macro avg       0.75      0.76      0.76       935
weighted avg       0.77      0.76      0.76       935

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2000 to 2003, also shows a good performance of the model, with 76% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_272_0.png" src="_images/Label_-_obito_cancer_272_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_273_0.png" src="_images/Label_-_obito_cancer_273_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_275_0.png" src="_images/Label_-_obito_cancer_275_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">xgb_fora_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.86</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=1.86)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_278_0.png" src="_images/Label_-_obito_cancer_278_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.83      0.86       818
           1       0.75      0.83      0.79       497

    accuracy                           0.83      1315
   macro avg       0.82      0.83      0.82      1315
weighted avg       0.84      0.83      0.83      1315

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2004 to 2007, also shows a good performance of the model with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_280_0.png" src="_images/Label_-_obito_cancer_280_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_281_0.png" src="_images/Label_-_obito_cancer_281_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_283_0.png" src="_images/Label_-_obito_cancer_283_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">xgb_fora_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=2.5)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_286_0.png" src="_images/Label_-_obito_cancer_286_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.83      0.86      1054
           1       0.71      0.82      0.77       560

    accuracy                           0.82      1614
   macro avg       0.81      0.82      0.81      1614
weighted avg       0.83      0.82      0.83      1614

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2008 to 2011, also shows a good performance of the model with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_288_0.png" src="_images/Label_-_obito_cancer_288_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_289_0.png" src="_images/Label_-_obito_cancer_289_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, but not with a lot of advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMONIO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_291_0.png" src="_images/Label_-_obito_cancer_291_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">xgb_fora_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">3.41</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=3.41)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_294_0.png" src="_images/Label_-_obito_cancer_294_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.83      0.88      1565
           1       0.65      0.83      0.73       588

    accuracy                           0.83      2153
   macro avg       0.79      0.83      0.80      2153
weighted avg       0.85      0.83      0.84      2153

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2012 to 2015, also shows a good performance of the model with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_296_0.png" src="_images/Label_-_obito_cancer_296_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_297_0.png" src="_images/Label_-_obito_cancer_297_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_299_0.png" src="_images/Label_-_obito_cancer_299_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">xgb_fora_16_20</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=4.5)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_302_0.png" src="_images/Label_-_obito_cancer_302_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.94      0.84      0.89      1690
           1       0.62      0.84      0.71       518

    accuracy                           0.84      2208
   macro avg       0.78      0.84      0.80      2208
weighted avg       0.87      0.84      0.85      2208

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2016 to 2020, shows the best performance comparing with the other models, with 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_304_0.png" src="_images/Label_-_obito_cancer_304_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_305_0.png" src="_images/Label_-_obito_cancer_305_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_307_0.png" src="_images/Label_-_obito_cancer_307_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
<div class="section" id="Testing-models-with-data-from-other-years">
<h2><strong>Testing models with data from other years</strong><a class="headerlink" href="#Testing-models-with-data-from-other-years" title="Permalink to this headline">¶</a></h2>
<p>We will use test data from the following years in the trained models for each set of years grouped together.</p>
<div class="section" id="Random-Forest-SP-for-years-2000-to-2003">
<h3><strong>Random Forest SP for years 2000 to 2003</strong><a class="headerlink" href="#Random-Forest-SP-for-years-2000-to-2003" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_312_0.png" src="_images/Label_-_obito_cancer_312_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.87      0.81      0.84     12254
           1       0.75      0.82      0.79      8633

    accuracy                           0.81     20887
   macro avg       0.81      0.82      0.81     20887
weighted avg       0.82      0.81      0.82     20887

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_313_0.png" src="_images/Label_-_obito_cancer_313_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.81      0.85     17545
           1       0.72      0.84      0.78     10198

    accuracy                           0.82     27743
   macro avg       0.81      0.83      0.81     27743
weighted avg       0.83      0.82      0.82     27743

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_314_0.png" src="_images/Label_-_obito_cancer_314_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.80      0.86     24288
           1       0.64      0.86      0.74     10342

    accuracy                           0.82     34630
   macro avg       0.79      0.83      0.80     34630
weighted avg       0.85      0.82      0.82     34630

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_315_0.png" src="_images/Label_-_obito_cancer_315_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.97      0.67      0.79     20945
           1       0.43      0.93      0.59      5681

    accuracy                           0.72     26626
   macro avg       0.70      0.80      0.69     26626
weighted avg       0.86      0.72      0.75     26626

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-SP-for-years-2000-to-2003">
<h3><strong>XGBoost SP for years 2000 to 2003</strong><a class="headerlink" href="#XGBoost-SP-for-years-2000-to-2003" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_317_0.png" src="_images/Label_-_obito_cancer_317_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.85      0.84      0.84     12254
           1       0.78      0.79      0.78      8633

    accuracy                           0.82     20887
   macro avg       0.81      0.81      0.81     20887
weighted avg       0.82      0.82      0.82     20887

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_318_0.png" src="_images/Label_-_obito_cancer_318_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.84      0.86     17545
           1       0.75      0.80      0.77     10198

    accuracy                           0.83     27743
   macro avg       0.81      0.82      0.82     27743
weighted avg       0.83      0.83      0.83     27743

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_319_0.png" src="_images/Label_-_obito_cancer_319_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.91      0.83      0.87     24288
           1       0.67      0.82      0.74     10342

    accuracy                           0.83     34630
   macro avg       0.79      0.82      0.80     34630
weighted avg       0.84      0.83      0.83     34630

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_320_0.png" src="_images/Label_-_obito_cancer_320_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.41      0.58     20945
           1       0.30      0.92      0.45      5681

    accuracy                           0.52     26626
   macro avg       0.63      0.67      0.51     26626
weighted avg       0.81      0.52      0.55     26626

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-SP-for-years-2004-to-2007">
<h3><strong>Random Forest SP for years 2004 to 2007</strong><a class="headerlink" href="#Random-Forest-SP-for-years-2004-to-2007" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_322_0.png" src="_images/Label_-_obito_cancer_322_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.82      0.86     17545
           1       0.73      0.83      0.78     10198

    accuracy                           0.83     27743
   macro avg       0.81      0.83      0.82     27743
weighted avg       0.83      0.83      0.83     27743

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_323_0.png" src="_images/Label_-_obito_cancer_323_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.80      0.86     24288
           1       0.65      0.86      0.74     10342

    accuracy                           0.82     34630
   macro avg       0.79      0.83      0.80     34630
weighted avg       0.85      0.82      0.83     34630

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_324_0.png" src="_images/Label_-_obito_cancer_324_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.71      0.82     20945
           1       0.46      0.90      0.61      5681

    accuracy                           0.75     26626
   macro avg       0.71      0.81      0.71     26626
weighted avg       0.86      0.75      0.77     26626

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-SP-for-years-2004-to-2007">
<h3><strong>XGBoost SP for years 2004 to 2007</strong><a class="headerlink" href="#XGBoost-SP-for-years-2004-to-2007" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_326_0.png" src="_images/Label_-_obito_cancer_326_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.83      0.86     17545
           1       0.74      0.84      0.79     10198

    accuracy                           0.83     27743
   macro avg       0.82      0.83      0.83     27743
weighted avg       0.84      0.83      0.84     27743

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_327_0.png" src="_images/Label_-_obito_cancer_327_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.48      0.62     24288
           1       0.41      0.85      0.55     10342

    accuracy                           0.59     34630
   macro avg       0.65      0.66      0.59     34630
weighted avg       0.74      0.59      0.60     34630

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_328_0.png" src="_images/Label_-_obito_cancer_328_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.40      0.56     20945
           1       0.28      0.88      0.43      5681

    accuracy                           0.50     26626
   macro avg       0.60      0.64      0.49     26626
weighted avg       0.79      0.50      0.53     26626

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-SP-for-years-2008-to-2011">
<h3><strong>Random Forest SP for years 2008 to 2011</strong><a class="headerlink" href="#Random-Forest-SP-for-years-2008-to-2011" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_330_0.png" src="_images/Label_-_obito_cancer_330_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.82      0.87     24288
           1       0.67      0.86      0.75     10342

    accuracy                           0.83     34630
   macro avg       0.80      0.84      0.81     34630
weighted avg       0.85      0.83      0.84     34630

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_331_0.png" src="_images/Label_-_obito_cancer_331_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.97      0.69      0.80     20945
           1       0.44      0.92      0.60      5681

    accuracy                           0.74     26626
   macro avg       0.71      0.80      0.70     26626
weighted avg       0.86      0.74      0.76     26626

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-SP-for-years-2008-to-2011">
<h3><strong>XGBoost SP for years 2008 to 2011</strong><a class="headerlink" href="#XGBoost-SP-for-years-2008-to-2011" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_333_0.png" src="_images/Label_-_obito_cancer_333_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.83      0.87     24288
           1       0.67      0.83      0.74     10342

    accuracy                           0.83     34630
   macro avg       0.80      0.83      0.81     34630
weighted avg       0.85      0.83      0.83     34630

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_334_0.png" src="_images/Label_-_obito_cancer_334_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.38      0.54     20945
           1       0.29      0.94      0.44      5681

    accuracy                           0.50     26626
   macro avg       0.62      0.66      0.49     26626
weighted avg       0.82      0.50      0.52     26626

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-SP-for-years-2012-to-2015">
<h3><strong>Random Forest SP for years 2012 to 2015</strong><a class="headerlink" href="#Random-Forest-SP-for-years-2012-to-2015" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_336_0.png" src="_images/Label_-_obito_cancer_336_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.78      0.86     20945
           1       0.52      0.87      0.65      5681

    accuracy                           0.80     26626
   macro avg       0.74      0.83      0.76     26626
weighted avg       0.86      0.80      0.82     26626

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-SP-for-years-2012-to-2015">
<h3><strong>XGBoost SP for years 2012 to 2015</strong><a class="headerlink" href="#XGBoost-SP-for-years-2012-to-2015" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_338_0.png" src="_images/Label_-_obito_cancer_338_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.81      0.87     20945
           1       0.55      0.86      0.67      5681

    accuracy                           0.82     26626
   macro avg       0.75      0.83      0.77     26626
weighted avg       0.87      0.82      0.83     26626

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-Other-states-for-years-2000-to-2003">
<h3><strong>Random Forest Other states for years 2000 to 2003</strong><a class="headerlink" href="#Random-Forest-Other-states-for-years-2000-to-2003" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_340_0.png" src="_images/Label_-_obito_cancer_340_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.87      0.80      0.83       818
           1       0.71      0.80      0.75       497

    accuracy                           0.80      1315
   macro avg       0.79      0.80      0.79      1315
weighted avg       0.81      0.80      0.80      1315

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_341_0.png" src="_images/Label_-_obito_cancer_341_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.77      0.83      1054
           1       0.66      0.81      0.73       560

    accuracy                           0.79      1614
   macro avg       0.77      0.79      0.78      1614
weighted avg       0.81      0.79      0.79      1614

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_342_0.png" src="_images/Label_-_obito_cancer_342_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.94      0.76      0.84      1565
           1       0.57      0.87      0.69       588

    accuracy                           0.79      2153
   macro avg       0.76      0.81      0.76      2153
weighted avg       0.84      0.79      0.80      2153

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_343_0.png" src="_images/Label_-_obito_cancer_343_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.71      0.82      1690
           1       0.49      0.91      0.64       518

    accuracy                           0.76      2208
   macro avg       0.73      0.81      0.73      2208
weighted avg       0.85      0.76      0.77      2208

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-Other-states-for-years-2000-to-2003">
<h3><strong>XGBoost Other states for years 2000 to 2003</strong><a class="headerlink" href="#XGBoost-Other-states-for-years-2000-to-2003" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_345_0.png" src="_images/Label_-_obito_cancer_345_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.78      0.83       818
           1       0.69      0.82      0.75       497

    accuracy                           0.80      1315
   macro avg       0.79      0.80      0.79      1315
weighted avg       0.81      0.80      0.80      1315

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_346_0.png" src="_images/Label_-_obito_cancer_346_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.75      0.81      1054
           1       0.64      0.82      0.72       560

    accuracy                           0.78      1614
   macro avg       0.76      0.79      0.77      1614
weighted avg       0.80      0.78      0.78      1614

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_347_0.png" src="_images/Label_-_obito_cancer_347_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.94      0.75      0.83      1565
           1       0.57      0.88      0.69       588

    accuracy                           0.78      2153
   macro avg       0.75      0.81      0.76      2153
weighted avg       0.84      0.78      0.79      2153

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_348_0.png" src="_images/Label_-_obito_cancer_348_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.97      0.69      0.81      1690
           1       0.48      0.93      0.63       518

    accuracy                           0.75      2208
   macro avg       0.72      0.81      0.72      2208
weighted avg       0.85      0.75      0.76      2208

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-Other-states-for-years-2004-to-2007">
<h3><strong>Random Forest Other states for years 2004 to 2007</strong><a class="headerlink" href="#Random-Forest-Other-states-for-years-2004-to-2007" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_350_0.png" src="_images/Label_-_obito_cancer_350_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.80      0.84      1054
           1       0.68      0.80      0.73       560

    accuracy                           0.80      1614
   macro avg       0.78      0.80      0.79      1614
weighted avg       0.81      0.80      0.80      1614

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_351_0.png" src="_images/Label_-_obito_cancer_351_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.94      0.77      0.85      1565
           1       0.59      0.86      0.70       588

    accuracy                           0.80      2153
   macro avg       0.76      0.82      0.77      2153
weighted avg       0.84      0.80      0.81      2153

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_352_0.png" src="_images/Label_-_obito_cancer_352_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.71      0.82      1690
           1       0.49      0.92      0.64       518

    accuracy                           0.76      2208
   macro avg       0.73      0.81      0.73      2208
weighted avg       0.85      0.76      0.78      2208

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-Other-states-for-years-2004-to-2007">
<h3><strong>XGBoost Other states for years 2004 to 2007</strong><a class="headerlink" href="#XGBoost-Other-states-for-years-2004-to-2007" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_354_0.png" src="_images/Label_-_obito_cancer_354_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.80      0.84      1054
           1       0.68      0.81      0.74       560

    accuracy                           0.80      1614
   macro avg       0.79      0.81      0.79      1614
weighted avg       0.82      0.80      0.81      1614

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_355_0.png" src="_images/Label_-_obito_cancer_355_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.94      0.77      0.85      1565
           1       0.59      0.87      0.70       588

    accuracy                           0.80      2153
   macro avg       0.77      0.82      0.78      2153
weighted avg       0.85      0.80      0.81      2153

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_356_0.png" src="_images/Label_-_obito_cancer_356_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.72      0.82      1690
           1       0.50      0.91      0.64       518

    accuracy                           0.76      2208
   macro avg       0.73      0.81      0.73      2208
weighted avg       0.85      0.76      0.78      2208

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-Other-states-for-years-2008-to-2011">
<h3><strong>Random Forest Other states for years 2008 to 2011</strong><a class="headerlink" href="#Random-Forest-Other-states-for-years-2008-to-2011" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_358_0.png" src="_images/Label_-_obito_cancer_358_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.78      0.86      1565
           1       0.60      0.88      0.72       588

    accuracy                           0.81      2153
   macro avg       0.78      0.83      0.79      2153
weighted avg       0.85      0.81      0.82      2153

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_359_0.png" src="_images/Label_-_obito_cancer_359_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.74      0.84      1690
           1       0.52      0.91      0.66       518

    accuracy                           0.78      2208
   macro avg       0.74      0.83      0.75      2208
weighted avg       0.86      0.78      0.80      2208

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-Other-states-for-years-2008-to-2011">
<h3><strong>XGBoost Other states for years 2008 to 2011</strong><a class="headerlink" href="#XGBoost-Other-states-for-years-2008-to-2011" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_361_0.png" src="_images/Label_-_obito_cancer_361_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.80      0.86      1565
           1       0.61      0.85      0.71       588

    accuracy                           0.81      2153
   macro avg       0.77      0.82      0.79      2153
weighted avg       0.85      0.81      0.82      2153

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_362_0.png" src="_images/Label_-_obito_cancer_362_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.76      0.85      1690
           1       0.53      0.90      0.67       518

    accuracy                           0.79      2208
   macro avg       0.75      0.83      0.76      2208
weighted avg       0.86      0.79      0.81      2208

</pre></div></div>
</div>
</div>
<div class="section" id="Random-Forest-Other-states-for-years-2012-to-2015">
<h3><strong>Random Forest Other states for years 2012 to 2015</strong><a class="headerlink" href="#Random-Forest-Other-states-for-years-2012-to-2015" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_364_0.png" src="_images/Label_-_obito_cancer_364_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.77      0.85      1690
           1       0.54      0.90      0.68       518

    accuracy                           0.80      2208
   macro avg       0.75      0.83      0.77      2208
weighted avg       0.86      0.80      0.81      2208

</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost-Other-states-for-years-2012-to-2015">
<h3><strong>XGBoost Other states for years 2012 to 2015</strong><a class="headerlink" href="#XGBoost-Other-states-for-years-2012-to-2015" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_366_0.png" src="_images/Label_-_obito_cancer_366_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.79      0.87      1690
           1       0.56      0.88      0.69       518

    accuracy                           0.81      2208
   macro avg       0.76      0.83      0.78      2208
weighted avg       0.86      0.81      0.82      2208

</pre></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="Fourth-approach">
<h1><strong>Fourth approach</strong><a class="headerlink" href="#Fourth-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with grouped years, using only morphologies with final digit equal to 3 and without the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>.</p>
<div class="section" id="id8">
<h2><strong>Preprocessing</strong><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, and then do the preprocessing in both datasets to perform the training of the models and their evaluation. We will use the years grouped too, resulting in 5 datasets for SP and more 5 for other states.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. We will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>. Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTICONS&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTITRAT&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;obito_geral&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;obito_cancer&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the preprocessing, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, that uses the other functions created, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code> (divides the dataset into train and test sets), <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code> (do the preprocessing of the train set) and <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code> (do the preprocessing of the test set).</p>
<p>The process will be done 5 times for SP and other states, using the datasets with grouped years.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="id9">
<h3><strong>SP</strong><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (46098, 65), X_test = (15367, 65)
y_train = (46098,), y_test = (15367,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (58169, 65), X_test = (19390, 65)
y_train = (58169,), y_test = (19390,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2011</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (77412, 65), X_test = (25804, 65)
y_train = (77412,), y_test = (25804,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (96124, 65), X_test = (32042, 65)
y_train = (96124,), y_test = (32042,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2016</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2021</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (73682, 65), X_test = (24561, 65)
y_train = (73682,), y_test = (24561,)
</pre></div></div>
</div>
</div>
<div class="section" id="id10">
<h3><strong>Other states</strong><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2592, 65), X_test = (865, 65)
y_train = (2592,), y_test = (865,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3694, 65), X_test = (1232, 65)
y_train = (3694,), y_test = (1232,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2011</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (4536, 65), X_test = (1513, 65)
y_train = (4536,), y_test = (1513,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2012</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2015</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (6069, 65), X_test = (2024, 65)
y_train = (6069,), y_test = (2024,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span>
                                                                                                <span class="n">group_years</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_year</span><span class="o">=</span><span class="mi">2016</span><span class="p">,</span>
                                                                                                <span class="n">last_year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span> <span class="n">morpho3</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                                <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                                                                <span class="n">balance_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">encoder_type</span><span class="o">=</span><span class="s1">&#39;LabelEncoder&#39;</span><span class="p">,</span>
                                                                                                <span class="n">norm_name</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (6185, 65), X_test = (2062, 65)
y_train = (6185,), y_test = (2062,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2><strong>Training and evaluation of the models</strong><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder and normalizing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id12">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The first model is the Random Forest, the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used because the models have difficulty to learn the class with fewer examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">rf_sp_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.06</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.06}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_391_0.png" src="_images/Label_-_obito_cancer_391_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.81      0.79      0.80      8010
           1       0.78      0.79      0.79      7357

    accuracy                           0.79     15367
   macro avg       0.79      0.79      0.79     15367
weighted avg       0.79      0.79      0.79     15367

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2000 to 2003, shows a good performance of the model, with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_393_0.png" src="_images/Label_-_obito_cancer_393_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_394_0.png" src="_images/Label_-_obito_cancer_394_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_395_0.png" src="_images/Label_-_obito_cancer_395_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, and <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_397_0.png" src="_images/Label_-_obito_cancer_397_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">rf_sp_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.28</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.28}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_400_0.png" src="_images/Label_-_obito_cancer_400_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.85      0.81      0.83     10867
           1       0.77      0.81      0.79      8523

    accuracy                           0.81     19390
   macro avg       0.81      0.81      0.81     19390
weighted avg       0.81      0.81      0.81     19390

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2004 to 2007, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_402_0.png" src="_images/Label_-_obito_cancer_402_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_403_0.png" src="_images/Label_-_obito_cancer_403_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_404_0.png" src="_images/Label_-_obito_cancer_404_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_406_0.png" src="_images/Label_-_obito_cancer_406_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">rf_sp_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.475</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.475}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_409_0.png" src="_images/Label_-_obito_cancer_409_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.83      0.85     15787
           1       0.75      0.83      0.79     10017

    accuracy                           0.83     25804
   macro avg       0.82      0.83      0.82     25804
weighted avg       0.83      0.83      0.83     25804

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2008 to 2011, shows a good performance of the model, with 83% of accuray.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_411_0.png" src="_images/Label_-_obito_cancer_411_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_412_0.png" src="_images/Label_-_obito_cancer_412_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_413_0.png" src="_images/Label_-_obito_cancer_413_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_415_0.png" src="_images/Label_-_obito_cancer_415_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">rf_sp_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">2.035</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 2.035}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_418_0.png" src="_images/Label_-_obito_cancer_418_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.84      0.87     21958
           1       0.70      0.84      0.76     10084

    accuracy                           0.84     32042
   macro avg       0.81      0.84      0.82     32042
weighted avg       0.85      0.84      0.84     32042

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2012 to 2015, shows a good performance of the model with 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_420_0.png" src="_images/Label_-_obito_cancer_420_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_421_0.png" src="_images/Label_-_obito_cancer_421_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_422_0.png" src="_images/Label_-_obito_cancer_422_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_424_0.png" src="_images/Label_-_obito_cancer_424_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">rf_sp_16_21</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">2.95</span><span class="p">},</span>
                                     <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">rf_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 2.95}, criterion=&#39;entropy&#39;,
                       max_depth=10, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_427_0.png" src="_images/Label_-_obito_cancer_427_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.94      0.83      0.88     18785
           1       0.60      0.83      0.70      5776

    accuracy                           0.83     24561
   macro avg       0.77      0.83      0.79     24561
weighted avg       0.86      0.83      0.84     24561

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with SP data from 2016 to 2021, shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_429_0.png" src="_images/Label_-_obito_cancer_429_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_430_0.png" src="_images/Label_-_obito_cancer_430_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_431_0.png" src="_images/Label_-_obito_cancer_431_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, and <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_433_0.png" src="_images/Label_-_obito_cancer_433_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">rf_fora_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.49</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">rf_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.49}, criterion=&#39;entropy&#39;,
                       max_depth=6, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_437_0.png" src="_images/Label_-_obito_cancer_437_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.78      0.80       492
           1       0.72      0.78      0.75       373

    accuracy                           0.78       865
   macro avg       0.77      0.78      0.77       865
weighted avg       0.78      0.78      0.78       865

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2000 to 2003, also shows a good performance of the model, and we have a balanced main diagonal with 78% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_439_0.png" src="_images/Label_-_obito_cancer_439_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_440_0.png" src="_images/Label_-_obito_cancer_440_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_441_0.png" src="_images/Label_-_obito_cancer_441_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_443_0.png" src="_images/Label_-_obito_cancer_443_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">rf_fora_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.52</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">rf_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.52}, criterion=&#39;entropy&#39;,
                       max_depth=6, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_446_0.png" src="_images/Label_-_obito_cancer_446_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.85      0.79      0.82       741
           1       0.72      0.80      0.76       491

    accuracy                           0.80      1232
   macro avg       0.79      0.80      0.79      1232
weighted avg       0.80      0.80      0.80      1232

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2004 to 2007, also shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_448_0.png" src="_images/Label_-_obito_cancer_448_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_449_0.png" src="_images/Label_-_obito_cancer_449_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_450_0.png" src="_images/Label_-_obito_cancer_450_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_452_0.png" src="_images/Label_-_obito_cancer_452_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">rf_fora_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">1.7</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">rf_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 1.7}, criterion=&#39;entropy&#39;,
                       max_depth=6, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_455_0.png" src="_images/Label_-_obito_cancer_455_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.81      0.84       973
           1       0.70      0.81      0.75       540

    accuracy                           0.81      1513
   macro avg       0.79      0.81      0.80      1513
weighted avg       0.82      0.81      0.81      1513

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2008 to 2011, also shows a good performance of the model, presenting 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_457_0.png" src="_images/Label_-_obito_cancer_457_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_458_0.png" src="_images/Label_-_obito_cancer_458_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_459_0.png" src="_images/Label_-_obito_cancer_459_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_461_0.png" src="_images/Label_-_obito_cancer_461_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">rf_fora_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">2.55</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">rf_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 2.55}, criterion=&#39;entropy&#39;,
                       max_depth=6, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_464_0.png" src="_images/Label_-_obito_cancer_464_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.83      0.87      1421
           1       0.67      0.83      0.74       603

    accuracy                           0.83      2024
   macro avg       0.80      0.83      0.81      2024
weighted avg       0.85      0.83      0.83      2024

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2012 to 2015, also shows a good performance of the model, presenting 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_466_0.png" src="_images/Label_-_obito_cancer_466_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_467_0.png" src="_images/Label_-_obito_cancer_467_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_468_0.png" src="_images/Label_-_obito_cancer_468_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_470_0.png" src="_images/Label_-_obito_cancer_470_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">rf_fora_16_20</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                       <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mf">2.435</span><span class="p">},</span>
                                       <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
                                       <span class="n">max_depth</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">rf_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(class_weight={0: 1, 1: 2.435}, criterion=&#39;entropy&#39;,
                       max_depth=7, random_state=10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_473_0.png" src="_images/Label_-_obito_cancer_473_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.84      0.89      1601
           1       0.59      0.84      0.69       461

    accuracy                           0.84      2062
   macro avg       0.77      0.84      0.79      2062
weighted avg       0.87      0.84      0.84      2062

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2016 to 2020, also shows a good performance of the model, presenting 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_tree</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_475_0.png" src="_images/Label_-_obito_cancer_475_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_476_0.png" src="_images/Label_-_obito_cancer_476_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_477_0.png" src="_images/Label_-_obito_cancer_477_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_479_0.png" src="_images/Label_-_obito_cancer_479_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">M</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0.</p>
<p>The other columns shown follow the same logic.</p>
</div>
<div class="section" id="id13">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost models follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. The hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> was also used in the trainings, in order to obtain a balanced main diagonal in the confusion matrix.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 10 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">xgb_sp_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.0245</span><span class="p">)</span>

<span class="n">xgb_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.0245)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_485_0.png" src="_images/Label_-_obito_cancer_485_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.82      0.80      0.81      8010
           1       0.79      0.80      0.80      7357

    accuracy                           0.80     15367
   macro avg       0.80      0.80      0.80     15367
weighted avg       0.80      0.80      0.80     15367

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2000 to 2003, shows a good performance of the model, here with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_487_0.png" src="_images/Label_-_obito_cancer_487_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_488_0.png" src="_images/Label_-_obito_cancer_488_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">feat_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_490_0.png" src="_images/Label_-_obito_cancer_490_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">xgb_sp_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>

<span class="n">xgb_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.4)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_493_0.png" src="_images/Label_-_obito_cancer_493_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.82      0.84     10867
           1       0.78      0.82      0.80      8523

    accuracy                           0.82     19390
   macro avg       0.82      0.82      0.82     19390
weighted avg       0.82      0.82      0.82     19390

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2004 to 2007, shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_495_0.png" src="_images/Label_-_obito_cancer_495_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_496_0.png" src="_images/Label_-_obito_cancer_496_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">feat_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_498_0.png" src="_images/Label_-_obito_cancer_498_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">xgb_sp_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.66</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=1.66)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_501_0.png" src="_images/Label_-_obito_cancer_501_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.84      0.87     15787
           1       0.77      0.84      0.80     10017

    accuracy                           0.84     25804
   macro avg       0.83      0.84      0.83     25804
weighted avg       0.84      0.84      0.84     25804

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2008 to 2011, shows a good performance of the model, with 84% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_503_0.png" src="_images/Label_-_obito_cancer_503_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_504_0.png" src="_images/Label_-_obito_cancer_504_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">feat_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_506_0.png" src="_images/Label_-_obito_cancer_506_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">xgb_sp_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">2.25</span><span class="p">)</span>

<span class="n">xgb_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=2.25)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_509_0.png" src="_images/Label_-_obito_cancer_509_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.85      0.89     21958
           1       0.72      0.85      0.78     10084

    accuracy                           0.85     32042
   macro avg       0.82      0.85      0.83     32042
weighted avg       0.86      0.85      0.85     32042

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2012 to 2015, shows a good performance of the model, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_511_0.png" src="_images/Label_-_obito_cancer_511_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_512_0.png" src="_images/Label_-_obito_cancer_512_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with some advantage. Following we have <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">feat_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_514_0.png" src="_images/Label_-_obito_cancer_514_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">xgb_sp_16_21</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">xgb_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=10, random_state=10, scale_pos_weight=4)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_517_0.png" src="_images/Label_-_obito_cancer_517_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.85      0.90     18785
           1       0.63      0.85      0.72      5776

    accuracy                           0.85     24561
   macro avg       0.79      0.85      0.81     24561
weighted avg       0.87      0.85      0.86     24561

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with SP data from 2016 to 2021, shows a good performance of the model, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_519_0.png" src="_images/Label_-_obito_cancer_519_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_520_0.png" src="_images/Label_-_obito_cancer_520_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">GLEASON</span></code> and <code class="docutils literal notranslate"><span class="pre">RECDIST</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">feat_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_522_0.png" src="_images/Label_-_obito_cancer_522_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">xgb_fora_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.552</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=1.552)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_526_0.png" src="_images/Label_-_obito_cancer_526_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.81      0.76      0.78       492
           1       0.71      0.76      0.73       373

    accuracy                           0.76       865
   macro avg       0.76      0.76      0.76       865
weighted avg       0.76      0.76      0.76       865

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2000 to 2003, also shows a good performance of the model, with 76% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_trainOS_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">y_trainOS_00_03</span><span class="p">,</span> <span class="n">y_testOS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_528_0.png" src="_images/Label_-_obito_cancer_528_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_529_0.png" src="_images/Label_-_obito_cancer_529_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_00_03</span><span class="p">,</span> <span class="n">feat_OS_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_531_0.png" src="_images/Label_-_obito_cancer_531_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">xgb_fora_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.9695</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=1.9695)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_534_0.png" src="_images/Label_-_obito_cancer_534_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.80      0.83       741
           1       0.73      0.80      0.76       491

    accuracy                           0.80      1232
   macro avg       0.79      0.80      0.80      1232
weighted avg       0.81      0.80      0.80      1232

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2004 to 2007, also shows a good performance of the model with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_trainOS_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_trainOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_536_0.png" src="_images/Label_-_obito_cancer_536_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_537_0.png" src="_images/Label_-_obito_cancer_537_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a good advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">G</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">feat_OS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_539_0.png" src="_images/Label_-_obito_cancer_539_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">xgb_fora_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">1.88</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=1.88)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_542_0.png" src="_images/Label_-_obito_cancer_542_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.82      0.85       973
           1       0.71      0.82      0.76       540

    accuracy                           0.82      1513
   macro avg       0.80      0.82      0.81      1513
weighted avg       0.83      0.82      0.82      1513

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states from 2008 to 2011, also shows a good performance of the model with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_trainOS_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_trainOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_544_0.png" src="_images/Label_-_obito_cancer_544_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_545_0.png" src="_images/Label_-_obito_cancer_545_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, but not with a lot of advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">feat_OS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_547_0.png" src="_images/Label_-_obito_cancer_547_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">xgb_fora_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">3.35</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=3.35)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_550_0.png" src="_images/Label_-_obito_cancer_550_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.84      0.88      1421
           1       0.68      0.83      0.75       603

    accuracy                           0.83      2024
   macro avg       0.80      0.83      0.81      2024
weighted avg       0.85      0.83      0.84      2024

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2012 to 2015, also shows a good performance of the model with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_trainOS_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_trainOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_552_0.png" src="_images/Label_-_obito_cancer_552_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_553_0.png" src="_images/Label_-_obito_cancer_553_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">PN</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">feat_OS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_555_0.png" src="_images/Label_-_obito_cancer_555_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">xgb_fora_16_20</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">2.878</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgb_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(max_depth=6, random_state=10, scale_pos_weight=2.878)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_558_0.png" src="_images/Label_-_obito_cancer_558_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.85      0.90      1601
           1       0.62      0.85      0.72       461

    accuracy                           0.85      2062
   macro avg       0.79      0.85      0.81      2062
weighted avg       0.88      0.85      0.86      2062

</pre></div></div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states from 2016 to 2020, shows the best performance comparing with the other models, with 85% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_trainOS_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_trainOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_560_0.png" src="_images/Label_-_obito_cancer_560_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_561_0.png" src="_images/Label_-_obito_cancer_561_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">META01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_shap_values</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">feat_OS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_563_0.png" src="_images/Label_-_obito_cancer_563_0.png" />
</div>
</div>
<p>Note that larger values of the <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> column, shown in pink, have more influence for the model’s prediction to be class 1, smaller values have greater weight for the prediction to be class 0. This behavior was expected, because the higher the clinical stage, worse is the stage of cancer.</p>
<p>The other columns shown follow the same logic.</p>
</div>
</div>
<div class="section" id="id14">
<h2><strong>Testing models with data from other years</strong><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>We will use test data from the following years in the trained models for each set of years grouped together.</p>
<div class="section" id="id15">
<h3><strong>Random Forest SP for years 2000 to 2003</strong><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_568_0.png" src="_images/Label_-_obito_cancer_568_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.84      0.81      0.83     10867
           1       0.77      0.81      0.79      8523

    accuracy                           0.81     19390
   macro avg       0.81      0.81      0.81     19390
weighted avg       0.81      0.81      0.81     19390

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_569_0.png" src="_images/Label_-_obito_cancer_569_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.81      0.84     15787
           1       0.73      0.83      0.78     10017

    accuracy                           0.82     25804
   macro avg       0.81      0.82      0.81     25804
weighted avg       0.82      0.82      0.82     25804

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_570_0.png" src="_images/Label_-_obito_cancer_570_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.80      0.85     21958
           1       0.66      0.85      0.74     10084

    accuracy                           0.81     32042
   macro avg       0.79      0.82      0.80     32042
weighted avg       0.84      0.81      0.82     32042

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_571_0.png" src="_images/Label_-_obito_cancer_571_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.65      0.78     18785
           1       0.45      0.92      0.60      5776

    accuracy                           0.72     24561
   macro avg       0.71      0.79      0.69     24561
weighted avg       0.84      0.72      0.74     24561

</pre></div></div>
</div>
</div>
<div class="section" id="id16">
<h3><strong>XGBoost SP for years 2000 to 2003</strong><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_573_0.png" src="_images/Label_-_obito_cancer_573_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.83      0.83      0.83     10867
           1       0.78      0.78      0.78      8523

    accuracy                           0.81     19390
   macro avg       0.80      0.80      0.80     19390
weighted avg       0.81      0.81      0.81     19390

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_574_0.png" src="_images/Label_-_obito_cancer_574_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.84      0.85     15787
           1       0.75      0.79      0.77     10017

    accuracy                           0.82     25804
   macro avg       0.81      0.81      0.81     25804
weighted avg       0.82      0.82      0.82     25804

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_575_0.png" src="_images/Label_-_obito_cancer_575_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.83      0.87     21958
           1       0.69      0.80      0.74     10084

    accuracy                           0.82     32042
   macro avg       0.79      0.82      0.80     32042
weighted avg       0.83      0.82      0.83     32042

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_576_0.png" src="_images/Label_-_obito_cancer_576_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.48      0.63     18785
           1       0.35      0.91      0.51      5776

    accuracy                           0.58     24561
   macro avg       0.65      0.70      0.57     24561
weighted avg       0.81      0.58      0.60     24561

</pre></div></div>
</div>
</div>
<div class="section" id="id17">
<h3><strong>Random Forest SP for years 2004 to 2007</strong><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_578_0.png" src="_images/Label_-_obito_cancer_578_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.81      0.85     15787
           1       0.74      0.83      0.78     10017

    accuracy                           0.82     25804
   macro avg       0.81      0.82      0.82     25804
weighted avg       0.83      0.82      0.82     25804

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_579_0.png" src="_images/Label_-_obito_cancer_579_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.79      0.85     21958
           1       0.65      0.86      0.74     10084

    accuracy                           0.81     32042
   macro avg       0.79      0.82      0.80     32042
weighted avg       0.84      0.81      0.82     32042

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_580_0.png" src="_images/Label_-_obito_cancer_580_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.68      0.79     18785
           1       0.47      0.91      0.62      5776

    accuracy                           0.73     24561
   macro avg       0.71      0.80      0.71     24561
weighted avg       0.85      0.73      0.75     24561

</pre></div></div>
</div>
</div>
<div class="section" id="id18">
<h3><strong>XGBoost SP for years 2004 to 2007</strong><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_582_0.png" src="_images/Label_-_obito_cancer_582_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.88      0.83      0.86     15787
           1       0.75      0.83      0.79     10017

    accuracy                           0.83     25804
   macro avg       0.82      0.83      0.82     25804
weighted avg       0.83      0.83      0.83     25804

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_583_0.png" src="_images/Label_-_obito_cancer_583_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.86      0.42      0.56     21958
           1       0.40      0.86      0.55     10084

    accuracy                           0.55     32042
   macro avg       0.63      0.64      0.55     32042
weighted avg       0.72      0.55      0.56     32042

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_584_0.png" src="_images/Label_-_obito_cancer_584_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.36      0.52     18785
           1       0.30      0.89      0.45      5776

    accuracy                           0.49     24561
   macro avg       0.61      0.63      0.49     24561
weighted avg       0.77      0.49      0.51     24561

</pre></div></div>
</div>
</div>
<div class="section" id="id19">
<h3><strong>Random Forest SP for years 2008 to 2011</strong><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_586_0.png" src="_images/Label_-_obito_cancer_586_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.81      0.86     21958
           1       0.68      0.85      0.75     10084

    accuracy                           0.83     32042
   macro avg       0.80      0.83      0.81     32042
weighted avg       0.84      0.83      0.83     32042

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_587_0.png" src="_images/Label_-_obito_cancer_587_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.97      0.66      0.78     18785
           1       0.45      0.92      0.61      5776

    accuracy                           0.72     24561
   macro avg       0.71      0.79      0.70     24561
weighted avg       0.85      0.72      0.74     24561

</pre></div></div>
</div>
</div>
<div class="section" id="id20">
<h3><strong>XGBoost SP for years 2008 to 2011</strong><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_589_0.png" src="_images/Label_-_obito_cancer_589_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.91      0.81      0.86     21958
           1       0.66      0.82      0.73     10084

    accuracy                           0.81     32042
   macro avg       0.79      0.82      0.79     32042
weighted avg       0.83      0.81      0.82     32042

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_590_0.png" src="_images/Label_-_obito_cancer_590_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.25      0.40     18785
           1       0.28      0.96      0.44      5776

    accuracy                           0.42     24561
   macro avg       0.62      0.61      0.42     24561
weighted avg       0.80      0.42      0.41     24561

</pre></div></div>
</div>
</div>
<div class="section" id="id21">
<h3><strong>Random Forest SP for years 2012 to 2015</strong><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_592_0.png" src="_images/Label_-_obito_cancer_592_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.77      0.85     18785
           1       0.54      0.86      0.66      5776

    accuracy                           0.79     24561
   macro avg       0.74      0.82      0.76     24561
weighted avg       0.85      0.79      0.81     24561

</pre></div></div>
</div>
</div>
<div class="section" id="id22">
<h3><strong>XGBoost SP for years 2012 to 2015</strong><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_594_0.png" src="_images/Label_-_obito_cancer_594_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.95      0.79      0.86     18785
           1       0.56      0.86      0.68      5776

    accuracy                           0.81     24561
   macro avg       0.76      0.83      0.77     24561
weighted avg       0.86      0.81      0.82     24561

</pre></div></div>
</div>
</div>
<div class="section" id="id23">
<h3><strong>Random Forest Other states for years 2000 to 2003</strong><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_596_0.png" src="_images/Label_-_obito_cancer_596_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.84      0.81      0.82       741
           1       0.72      0.77      0.75       491

    accuracy                           0.79      1232
   macro avg       0.78      0.79      0.78      1232
weighted avg       0.79      0.79      0.79      1232

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_597_0.png" src="_images/Label_-_obito_cancer_597_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.75      0.82       973
           1       0.66      0.85      0.74       540

    accuracy                           0.79      1513
   macro avg       0.78      0.80      0.78      1513
weighted avg       0.81      0.79      0.79      1513

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_598_0.png" src="_images/Label_-_obito_cancer_598_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.76      0.84      1421
           1       0.60      0.87      0.71       603

    accuracy                           0.79      2024
   macro avg       0.77      0.81      0.77      2024
weighted avg       0.83      0.79      0.80      2024

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_599_0.png" src="_images/Label_-_obito_cancer_599_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.97      0.68      0.80      1601
           1       0.46      0.93      0.61       461

    accuracy                           0.74      2062
   macro avg       0.71      0.81      0.71      2062
weighted avg       0.86      0.74      0.76      2062

</pre></div></div>
</div>
</div>
<div class="section" id="id24">
<h3><strong>XGBoost Other states for years 2000 to 2003</strong><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_04_07</span><span class="p">,</span> <span class="n">y_testOS_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_601_0.png" src="_images/Label_-_obito_cancer_601_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.85      0.80      0.82       741
           1       0.72      0.78      0.75       491

    accuracy                           0.79      1232
   macro avg       0.79      0.79      0.79      1232
weighted avg       0.80      0.79      0.80      1232

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_602_0.png" src="_images/Label_-_obito_cancer_602_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.90      0.76      0.82       973
           1       0.66      0.85      0.74       540

    accuracy                           0.79      1513
   macro avg       0.78      0.80      0.78      1513
weighted avg       0.81      0.79      0.79      1513

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_603_0.png" src="_images/Label_-_obito_cancer_603_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.77      0.84      1421
           1       0.62      0.85      0.72       603

    accuracy                           0.80      2024
   macro avg       0.77      0.81      0.78      2024
weighted avg       0.83      0.80      0.81      2024

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_604_0.png" src="_images/Label_-_obito_cancer_604_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.71      0.81      1601
           1       0.47      0.89      0.61       461

    accuracy                           0.75      2062
   macro avg       0.71      0.80      0.71      2062
weighted avg       0.85      0.75      0.77      2062

</pre></div></div>
</div>
</div>
<div class="section" id="id25">
<h3><strong>Random Forest Other states for years 2004 to 2007</strong><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_606_0.png" src="_images/Label_-_obito_cancer_606_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.75      0.81       973
           1       0.65      0.84      0.73       540

    accuracy                           0.78      1513
   macro avg       0.77      0.79      0.77      1513
weighted avg       0.81      0.78      0.78      1513

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_607_0.png" src="_images/Label_-_obito_cancer_607_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.93      0.74      0.83      1421
           1       0.59      0.88      0.71       603

    accuracy                           0.78      2024
   macro avg       0.76      0.81      0.77      2024
weighted avg       0.83      0.78      0.79      2024

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_608_0.png" src="_images/Label_-_obito_cancer_608_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.98      0.65      0.78      1601
           1       0.44      0.95      0.60       461

    accuracy                           0.72      2062
   macro avg       0.71      0.80      0.69      2062
weighted avg       0.86      0.72      0.74      2062

</pre></div></div>
</div>
</div>
<div class="section" id="id26">
<h3><strong>XGBoost Other states for years 2004 to 2007</strong><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_08_11</span><span class="p">,</span> <span class="n">y_testOS_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_610_0.png" src="_images/Label_-_obito_cancer_610_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.89      0.77      0.83       973
           1       0.67      0.83      0.74       540

    accuracy                           0.79      1513
   macro avg       0.78      0.80      0.78      1513
weighted avg       0.81      0.79      0.80      1513

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_611_0.png" src="_images/Label_-_obito_cancer_611_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.94      0.77      0.85      1421
           1       0.62      0.89      0.73       603

    accuracy                           0.80      2024
   macro avg       0.78      0.83      0.79      2024
weighted avg       0.84      0.80      0.81      2024

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_612_0.png" src="_images/Label_-_obito_cancer_612_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.70      0.81      1601
           1       0.47      0.91      0.62       461

    accuracy                           0.75      2062
   macro avg       0.72      0.81      0.72      2062
weighted avg       0.85      0.75      0.77      2062

</pre></div></div>
</div>
</div>
<div class="section" id="id27">
<h3><strong>Random Forest Other states for years 2008 to 2011</strong><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_614_0.png" src="_images/Label_-_obito_cancer_614_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.81      0.86      1421
           1       0.65      0.84      0.73       603

    accuracy                           0.82      2024
   macro avg       0.79      0.82      0.80      2024
weighted avg       0.84      0.82      0.82      2024

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_615_0.png" src="_images/Label_-_obito_cancer_615_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.75      0.84      1601
           1       0.50      0.90      0.65       461

    accuracy                           0.78      2062
   macro avg       0.73      0.82      0.74      2062
weighted avg       0.86      0.78      0.80      2062

</pre></div></div>
</div>
</div>
<div class="section" id="id28">
<h3><strong>XGBoost Other states for years 2008 to 2011</strong><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_12_15</span><span class="p">,</span> <span class="n">y_testOS_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_617_0.png" src="_images/Label_-_obito_cancer_617_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.92      0.82      0.87      1421
           1       0.66      0.82      0.73       603

    accuracy                           0.82      2024
   macro avg       0.79      0.82      0.80      2024
weighted avg       0.84      0.82      0.83      2024

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_618_0.png" src="_images/Label_-_obito_cancer_618_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.76      0.85      1601
           1       0.52      0.89      0.65       461

    accuracy                           0.79      2062
   macro avg       0.74      0.82      0.75      2062
weighted avg       0.86      0.79      0.80      2062

</pre></div></div>
</div>
</div>
<div class="section" id="id29">
<h3><strong>Random Forest Other states for years 2012 to 2015</strong><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_620_0.png" src="_images/Label_-_obito_cancer_620_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.97      0.75      0.84      1601
           1       0.51      0.92      0.66       461

    accuracy                           0.78      2062
   macro avg       0.74      0.83      0.75      2062
weighted avg       0.87      0.78      0.80      2062

</pre></div></div>
</div>
</div>
<div class="section" id="id30">
<h3><strong>XGBoost Other states for years 2012 to 2015</strong><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">display_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testOS_16_20</span><span class="p">,</span> <span class="n">y_testOS_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_obito_cancer_622_0.png" src="_images/Label_-_obito_cancer_622_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

              precision    recall  f1-score   support

           0       0.96      0.74      0.84      1601
           1       0.50      0.90      0.64       461

    accuracy                           0.77      2062
   macro avg       0.73      0.82      0.74      2062
weighted avg       0.86      0.77      0.79      2062

</pre></div></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Label%20-%20vivo_ano1.html" class="btn btn-neutral float-right" title="Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Label%20-%20obito_geral.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Lucas Buk Cardoso.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>