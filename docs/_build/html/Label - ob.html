

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Classification - ob &mdash; Cancer Project Documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cancer Project
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Libraries and functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html"><strong>Libraries</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#Functions"><strong>Functions</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Libraries%20and%20functions.html#References"><strong>References</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Data Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models%202.0.html"><strong>Reading the data</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models%202.0.html#Data-analysis"><strong>Data analysis</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cancer%20Models%202.0.html#Creating-new-columns"><strong>Creating new columns</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Classification vivo_ano1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html"><strong>Classification - vivo_ano1</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano1.html#Third-approach"><strong>Third approach</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Classification vivo_ano5</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html"><strong>Classification - vivo_ano5</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#First-approach"><strong>First approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Second-approach"><strong>Second approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Label%20-%20vivo_ano5.html#Third-approach"><strong>Third approach</strong></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cancer Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><strong>Classification - ob</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Label - ob.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Classification---ob">
<h1><strong>Classification - ob</strong><a class="headerlink" href="#Classification---ob" title="Permalink to this headline">¶</a></h1>
<p>In this section, two machine learning models will be used to classify the <code class="docutils literal notranslate"><span class="pre">ob</span></code> column, Random Forest and XGBoost, for both datasets, São Paulo and other states.</p>
<p>The label is 0 if the person is alive and 1 if he / she died.</p>
<p>Four scenarios will be created using the column <code class="docutils literal notranslate"><span class="pre">ob</span></code> as label. The first is the raw data for São Paulo and other states, as was generated in the previous section. The second scenario considers only patients with morphology with the last digit being 3, in addition, the <code class="docutils literal notranslate"><span class="pre">EC</span></code> column was removed.</p>
<p>The third and fourth scenarios use the years of diagnosis grouped, the last one also considering only morphologies with the final digit 3.</p>
</div>
<div class="section" id="First-approach">
<h1><strong>First approach</strong><a class="headerlink" href="#First-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with “raw data”.</p>
<div class="section" id="Reading-the-data">
<h2><strong>Reading the data</strong><a class="headerlink" href="#Reading-the-data" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the columns <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code> will not be used in this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 92)
(32891, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      431715
delta_t6      431715
delta_t5      431715
DTRECIDIVA    431715
HORMONIO           0
QUIMIO             0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      29244
delta_t6      29244
delta_t5      29244
DTRECIDIVA    29244
HORMONIO          0
QUIMIO            0
dtype: int64
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ob              1.000000
vivo_sem_rec    0.937293
ULTINFO         0.866060
ob_sem_rec      0.832140
vivo_ano3       0.365068
ob_com_rec      0.342650
delta_t8        0.340122
delta_t7        0.336685
delta_t9        0.332492
vivo_ano5       0.294475
vivo_ano1       0.288888
ANODIAG         0.264297
CIRURGIA        0.260995
QUIMIO          0.226548
CATEATEND       0.220804
RECNENHUM       0.208701
MORFO           0.195059
IDADE           0.190838
delta_t5        0.178853
delta_t4        0.175931
Name: ob, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ob              1.000000
vivo_sem_rec    0.939117
ob_sem_rec      0.906038
ULTINFO         0.866780
vivo_ano3       0.385518
delta_t8        0.350399
delta_t7        0.343164
delta_t9        0.338123
CIRURGIA        0.301963
vivo_ano5       0.301465
vivo_ano1       0.281608
ob_com_rec      0.277742
QUIMIO          0.252260
ANODIAG         0.228325
CATEATEND       0.222303
delta_t5        0.212966
delta_t4        0.210724
delta_t6        0.205317
MORFO           0.182062
GLEASON         0.151939
Name: ob, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, it is clear that there is an imbalance. We will need to fix this problem in the preprocessing step and in the models training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    276947
1    229090
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    20359
1    12532
Name: ob, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="Training-and-testing-split">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#Training-and-testing-split" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, to perform the training of the models and then their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">DTTRAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">DTULTINFO</span></code> and <code class="docutils literal notranslate"><span class="pre">DTPREENCH</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>. The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATCONS</span></code>, <code class="docutils literal notranslate"><span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>.</p>
<p>Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;DTPREENCH&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;ob&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">,</span> <span class="n">y_testSP</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (379527, 66), X_test = (126510, 66)
y_train = (379527,), y_test = (126510,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">,</span> <span class="n">y_testFora</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (24668, 66), X_test = (8223, 66)
y_train = (24668,), y_test = (8223,)
</pre></div></div>
</div>
</div>
<div class="section" id="Encoder-and-normalization">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#Encoder-and-normalization" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to perform the preprocessing in the training data, for this a function was created, <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="PCA">
<h2><strong>PCA</strong><a class="headerlink" href="#PCA" title="Permalink to this headline">¶</a></h2>
<p>Using the PCA, it is possible to reduce the dimensionality of the data, decreasing the number of features. As can be seen from the graphs below, with less features used in the models, smaller will be the representativeness of the total data.</p>
<p>The preprocessing function of the training data already contains this possibility of using the PCA, just use the necessary parameters, see the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">principalComponents</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sum of explained variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_32_0.png" src="_images/Label_-_ob_32_0.png" />
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">principalComponents</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sum of explained variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_35_0.png" src="_images/Label_-_ob_35_0.png" />
</div>
</div>
</div>
<div class="section" id="Balancing-the-data">
<h2><strong>Balancing the data</strong><a class="headerlink" href="#Balancing-the-data" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier, we have unbalanced data, more labels with value 0 than with value 1. Therefore, we will use methods to balance the data.</p>
<p>In both cases the oversampling method will be used, which creates new data for the label with less values (<code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">1</span></code>), after that we have both labels with the same number of examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    207815
1    171712
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_SP</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(415630,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    15267
1     9401
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_fora</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(30534,)
</pre></div></div>
</div>
</div>
<div class="section" id="Training-machine-learning-models">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#Training-machine-learning-models" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder, normalizing and balancing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="Random-Forest">
<h3><strong>Random Forest</strong><a class="headerlink" href="#Random-Forest" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test only the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>In the model for other states data, the hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was also used, because even after balancing the data the model still has difficulty learning the class with fewer examples, so using this parameter this class will have a greater weight in the training of the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0, class_weight=None,
                       criterion=&#39;gini&#39;, max_depth=None, max_features=&#39;auto&#39;,
                       max_leaf_nodes=None, max_samples=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=100,
                       n_jobs=None, oob_score=False, random_state=10, verbose=0,
                       warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 10, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
</div>
<div class="section" id="XGBoost">
<h3><strong>XGBoost</strong><a class="headerlink" href="#XGBoost" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A higher weight was also used for the class with fewer examples, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>, for the model with data from outside SP.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 15 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=5, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Salvando-modelos">
<h2><strong>Salvando modelos</strong><a class="headerlink" href="#Salvando-modelos" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#with open(&#39;/content/drive/MyDrive/Trabalho/Cancer/Modelos/models_SP.pkl&#39;, &#39;wb&#39;) as arq:</span>
    <span class="c1">#pickle.dump(</span>
        <span class="c1">#{&#39;X_train&#39;: X_SP, &#39;y_train&#39;: y_SP, &#39;Encoders&#39;: enc_SP,</span>
         <span class="c1">#&#39;Normalizer&#39;: norm_SP, &#39;Random Forest&#39;: rf_sp, &#39;XGB&#39;: xgboost_sp}, arq)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#with open(&#39;/content/drive/MyDrive/Trabalho/Cancer/Modelos/models_foraSP.pkl&#39;, &#39;wb&#39;) as arq:</span>
    <span class="c1">#pickle.dump(</span>
        <span class="c1">#{&#39;X_train&#39;: X_fora, &#39;y_train&#39;: y_fora, &#39;Encoders&#39;: enc_fora,</span>
         <span class="c1">#&#39;Normalizer&#39;: norm_fora, &#39;Random Forest&#39;: rf_fora, &#39;XGB&#39;: xgboost_fora}, arq)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Models-evaluation">
<h2><strong>Models evaluation</strong><a class="headerlink" href="#Models-evaluation" title="Permalink to this headline">¶</a></h2>
<p>After training the models, we will use the confusion matrix to verify the performances, the features importances for each model will also be obtained.</p>
<div class="section" id="Preprocessing-of-testing-data">
<h3><strong>Preprocessing of testing data</strong><a class="headerlink" href="#Preprocessing-of-testing-data" title="Permalink to this headline">¶</a></h3>
<p>The preprocessing of the test data was also done using a function, <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">X_testSP_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">X_testFora_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Below we have the confusion matrices for the Random Forest models, followed by the graph with the most important features for each model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_testSP_</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_67_0.png" src="_images/Label_-_ob_67_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm with the SP data shows a good performance of the model, because the model achieves a 83% of accuracy for both classes, <code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">1</span></code>.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that the balance of the data worked, because it was not necessary to use a higher weight for the class with fewer examples in the training of the model and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_69_0.png" src="_images/Label_-_ob_69_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">EC</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code> and <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_testFora_</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_71_0.png" src="_images/Label_-_ob_71_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm with the data from other states also shows a good performance of the model, but we have a little unbalanced main diagonal in the confusion matrix, it means that we have to adjust the class weights in the model training, in order to obtain a balanced diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_73_0.png" src="_images/Label_-_ob_73_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">EC</span></code> and <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="id2">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Below we have the confusion matrices for the XGBoost models, followed by the graph with the most important features for each model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_testSP_</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_77_0.png" src="_images/Label_-_ob_77_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with the SP data shows a good performance of the model, as well as the Random Forest model.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked here too, because we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_79_0.png" src="_images/Label_-_ob_79_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_testFora_</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_81_0.png" src="_images/Label_-_ob_81_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with the data from other states also shows a good performance of the model, as well as the Random Forest model.</p>
</div></blockquote>
<blockquote>
<div><p>We also obtained a confusion matrix with the balanced main diagonal, with 82% and 81%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_83_0.png" src="_images/Label_-_ob_83_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, but not with a lot of advantage as seen in the previous analysis. The following most important features were <code class="docutils literal notranslate"><span class="pre">GLEASON</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="Second-approach">
<h1><strong>Second approach</strong><a class="headerlink" href="#Second-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach using only morphologies with final digit equal to 3 and without <code class="docutils literal notranslate"><span class="pre">EC</span></code> column as a feature.</p>
<div class="section" id="id3">
<h2><strong>Reading the data</strong><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the columns <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code> will not be used in this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 92)
(32891, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      431715
delta_t6      431715
delta_t5      431715
DTRECIDIVA    431715
HORMONIO           0
QUIMIO             0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      29244
delta_t6      29244
delta_t5      29244
DTRECIDIVA    29244
HORMONIO          0
QUIMIO            0
dtype: int64
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ob              1.000000
vivo_sem_rec    0.937293
ULTINFO         0.866060
ob_sem_rec      0.832140
vivo_ano3       0.365068
ob_com_rec      0.342650
delta_t8        0.340122
delta_t7        0.336685
delta_t9        0.332492
vivo_ano5       0.294475
vivo_ano1       0.288888
ANODIAG         0.264297
CIRURGIA        0.260995
QUIMIO          0.226548
CATEATEND       0.220804
RECNENHUM       0.208701
MORFO           0.195059
IDADE           0.190838
delta_t5        0.178853
delta_t4        0.175931
Name: ob, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ob              1.000000
vivo_sem_rec    0.939117
ob_sem_rec      0.906038
ULTINFO         0.866780
vivo_ano3       0.385518
delta_t8        0.350399
delta_t7        0.343164
delta_t9        0.338123
CIRURGIA        0.301963
vivo_ano5       0.301465
vivo_ano1       0.281608
ob_com_rec      0.277742
QUIMIO          0.252260
ANODIAG         0.228325
CATEATEND       0.222303
delta_t5        0.212966
delta_t4        0.210724
delta_t6        0.205317
MORFO           0.182062
GLEASON         0.151939
Name: ob, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, as we noticed in the last section, there is an imbalance. We will need to fix this problem in the preprocessing step and in the models training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    276947
1    229090
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    20359
1    12532
Name: ob, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="Behavior-column">
<h2><strong>Behavior column</strong><a class="headerlink" href="#Behavior-column" title="Permalink to this headline">¶</a></h2>
<p>A column will be created, in both datasets, with the final digit of the <code class="docutils literal notranslate"><span class="pre">MORFO</span></code> column, then only those with behavior equal to 3 will be selected to continue the analysis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP</span><span class="p">[</span><span class="s1">&#39;comportamento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">MORFO</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">comportamento</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3    468649
2     36682
1       706
Name: comportamento, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_comp</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="n">df_SP</span><span class="o">.</span><span class="n">comportamento</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_comp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;comportamento&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_SP_comp</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(468649, 92)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">df_fora</span><span class="p">[</span><span class="s1">&#39;comportamento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">MORFO</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">comportamento</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3    30772
2     2112
1        7
Name: comportamento, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_comp</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="n">df_fora</span><span class="o">.</span><span class="n">comportamento</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_comp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;comportamento&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_fora_comp</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(30772, 92)
</pre></div></div>
</div>
</div>
<div class="section" id="id4">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, to perform the training of the models and then their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">DTTRAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">DTULTINFO</span></code> and <code class="docutils literal notranslate"><span class="pre">DTPREENCH</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">EC</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>. The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATCONS</span></code>, <code class="docutils literal notranslate"><span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>.</p>
<p>Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;DTPREENCH&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;ob&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">,</span> <span class="n">y_trainSP</span><span class="p">,</span> <span class="n">y_testSP</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_comp</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (351486, 65), X_test = (117163, 65)
y_train = (351486,), y_test = (117163,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">,</span> <span class="n">y_testFora</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_comp</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (23079, 65), X_test = (7693, 65)
y_train = (23079,), y_test = (7693,)
</pre></div></div>
</div>
</div>
<div class="section" id="id5">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to perform the preprocessing in the training data, for this a function was created, <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><strong>PCA</strong><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Using the PCA, it is possible to reduce the dimensionality of the data, decreasing the number of features. As can be seen from the graphs below, with less features used in the models, smaller will be the representativeness of the total data.</p>
<p>The preprocessing function of the training data already contains this possibility of using the PCA, just use the necessary parameters, see the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
<p><strong>SP</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">principalComponents</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainSP_enc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sum of explained variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_124_0.png" src="_images/Label_-_ob_124_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span>
        <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;hv&#39;</span><span class="p">,</span>

    <span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainSP_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
    <span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Variância que pode ser &quot;explicada&quot;&#39;</span><span class="p">,</span> <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Número de componentes principais&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<html>
<head><meta charset="utf-8" /></head>
<body>
    <div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>
                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
            <div id="ba6de813-f391-4997-8451-f86674636a83" class="plotly-graph-div" style="height:525px; width:100%;"></div>
            <script type="text/javascript">

                    window.PLOTLYENV=window.PLOTLYENV || {};

                if (document.getElementById("ba6de813-f391-4997-8451-f86674636a83")) {
                    Plotly.newPlot(
                        'ba6de813-f391-4997-8451-f86674636a83',
                        [{"line": {"shape": "hv"}, "type": "scatter", "x": [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0, 20.0, 21.0, 22.0, 23.0, 24.0, 25.0, 26.0, 27.0, 28.0, 29.0, 30.0, 31.0, 32.0, 33.0, 34.0, 35.0, 36.0, 37.0, 38.0, 39.0, 40.0, 41.0, 42.0, 43.0, 44.0, 45.0, 46.0, 47.0, 48.0, 49.0, 50.0, 51.0, 52.0, 53.0, 54.0, 55.0, 56.0, 57.0, 58.0, 59.0, 60.0, 61.0, 62.0, 63.0, 64.0, 65.0], "y": [0.06680775000754019, 0.12316811672824077, 0.17467133593573994, 0.220887271899372, 0.2640564616493375, 0.3015687350358277, 0.3382786467255855, 0.3695538409299635, 0.39844739165542536, 0.4255181198728161, 0.4512257102091497, 0.4737927858020608, 0.49474758500013366, 0.5143083100199952, 0.5337928207794822, 0.5522143557436924, 0.5700236272273196, 0.5872232066995907, 0.6035365387368359, 0.61938657696221, 0.6350998066037385, 0.6507215485005459, 0.6661545013510325, 0.6815449487183176, 0.6969295953963756, 0.7123037821711866, 0.7276197823174974, 0.7426401755061597, 0.7576052876202904, 0.7724160633489128, 0.7868749773011338, 0.8004057095323825, 0.813570040809052, 0.8266317787296524, 0.8395884081323913, 0.8523148300372563, 0.8649267394431936, 0.8770904800820921, 0.8887450160463373, 0.8998229576227481, 0.9102198660407529, 0.9196795499492977, 0.9282842196768841, 0.936747566051753, 0.9449400732403048, 0.9527342210733334, 0.9604254140775752, 0.9673247755358018, 0.972886590061066, 0.9779615383325662, 0.9824229074687382, 0.9865883542071167, 0.9899540906662466, 0.9927100569862397, 0.9947415019085325, 0.9962954584998294, 0.9975035274936106, 0.99862737594247, 0.9992508241484458, 0.9996594841510904, 0.9998762193761619, 0.9999615698786546, 0.9999999999999997, 0.9999999999999997, 0.9999999999999997]}, {"type": "bar", "x": [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0, 20.0, 21.0, 22.0, 23.0, 24.0, 25.0, 26.0, 27.0, 28.0, 29.0, 30.0, 31.0, 32.0, 33.0, 34.0, 35.0, 36.0, 37.0, 38.0, 39.0, 40.0, 41.0, 42.0, 43.0, 44.0, 45.0, 46.0, 47.0, 48.0, 49.0, 50.0, 51.0, 52.0, 53.0, 54.0, 55.0, 56.0, 57.0, 58.0, 59.0, 60.0, 61.0, 62.0, 63.0, 64.0, 65.0], "y": [0.06680775000754019, 0.05636036672070057, 0.051503219207499173, 0.04621593596363205, 0.04316918974996548, 0.037512273386490186, 0.03670991168975778, 0.03127519420437804, 0.028893550725461823, 0.02707072821739077, 0.025707590336333557, 0.02256707559291109, 0.020954799198072874, 0.019560725019861596, 0.019484510759487032, 0.018421534964210173, 0.017809271483627216, 0.017199579472271163, 0.016313332037245203, 0.015850038225374063, 0.015713229641528503, 0.015621741896807335, 0.015432952850486636, 0.015390447367285084, 0.015384646678057966, 0.015374186774811099, 0.015316000146310729, 0.015020393188662294, 0.014965112114130721, 0.014810775728622343, 0.014458913952220988, 0.013530732231248805, 0.013164331276669444, 0.013061737920600362, 0.012956629402738923, 0.012726421904865004, 0.012611909405937325, 0.012163740638898505, 0.011654535964245176, 0.011077941576410818, 0.01039690841800473, 0.009459683908544783, 0.008604669727586473, 0.008463346374868942, 0.008192507188551783, 0.007794147833028589, 0.00769119300424187, 0.0068993614582266004, 0.005561814525264253, 0.005074948271500171, 0.004461369136172058, 0.004165446738378478, 0.0033657364591299947, 0.0027559663199931317, 0.0020314449222927963, 0.0015539565912968609, 0.0012080689937812728, 0.0011238484488594223, 0.0006234482059757937, 0.0004086600026446264, 0.00021673522507152288, 8.53505024926733e-05, 3.8430121345036134e-05, 1.3175505536681803e-32, 1.396325265522059e-33]}],
                        {"template": {"data": {"bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}, "xaxis": {"title": {"text": "N\u00famero de componentes principais"}}, "yaxis": {"title": {"text": "Vari\u00e2ncia que pode ser \"explicada\""}}},
                        {"responsive": true}
                    ).then(function(){

var gd = document.getElementById('ba6de813-f391-4997-8451-f86674636a83');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })
                };

            </script>
        </div>
</body>
</html></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">principalComponents</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sum of explained variance ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_128_0.png" src="_images/Label_-_ob_128_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">),</span>
        <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;hv&#39;</span><span class="p">,</span>

    <span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_trainFora_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
    <span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Variância que pode ser &quot;explicada&quot;&#39;</span><span class="p">,</span> <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Número de componentes principais&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<html>
<head><meta charset="utf-8" /></head>
<body>
    <div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>
                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
            <div id="646e1618-0f78-4833-af3e-47ef350b0024" class="plotly-graph-div" style="height:525px; width:100%;"></div>
            <script type="text/javascript">

                    window.PLOTLYENV=window.PLOTLYENV || {};

                if (document.getElementById("646e1618-0f78-4833-af3e-47ef350b0024")) {
                    Plotly.newPlot(
                        '646e1618-0f78-4833-af3e-47ef350b0024',
                        [{"line": {"shape": "hv"}, "type": "scatter", "x": [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0, 20.0, 21.0, 22.0, 23.0, 24.0, 25.0, 26.0, 27.0, 28.0, 29.0, 30.0, 31.0, 32.0, 33.0, 34.0, 35.0, 36.0, 37.0, 38.0, 39.0, 40.0, 41.0, 42.0, 43.0, 44.0, 45.0, 46.0, 47.0, 48.0, 49.0, 50.0, 51.0, 52.0, 53.0, 54.0, 55.0, 56.0, 57.0, 58.0, 59.0, 60.0, 61.0, 62.0, 63.0, 64.0, 65.0], "y": [0.08144674019661836, 0.15435279158296855, 0.21366004346658132, 0.2687037036392341, 0.3196198442914039, 0.3607980642583005, 0.3997123494648273, 0.43408901004862277, 0.46215098943037103, 0.4865478350070483, 0.5104713719289153, 0.5325587230182767, 0.554334068989356, 0.5747080858734622, 0.5948489111339216, 0.6139826627408289, 0.632125584064838, 0.6499860083612135, 0.667596622983655, 0.6847200205570858, 0.7017490614559956, 0.7185784438205972, 0.7352231819541062, 0.7513283162750218, 0.7671474298988962, 0.7826121317632269, 0.7974861898250343, 0.8119133818277079, 0.8262176962031469, 0.8400882380402397, 0.8531458987163466, 0.8659418742728088, 0.8778568588203532, 0.8891351388903878, 0.8998249317286615, 0.9102017125904706, 0.9199727195383554, 0.9296632111366168, 0.9392575061994588, 0.9481572979298125, 0.9568692175907962, 0.9645095703330796, 0.9715081057415945, 0.977753813935042, 0.9835299123951168, 0.9875138291794303, 0.9903923192023818, 0.9931611470694239, 0.9949771665386551, 0.9967168864610398, 0.9980005077950564, 0.998837596952357, 0.9993130593384247, 0.9997569737611005, 0.9998703646535221, 0.9999528550405241, 1.0000000000000002, 1.0000000000000002, 1.0000000000000002, 1.0000000000000002, 1.0000000000000002, 1.0000000000000002, 1.0000000000000002, 1.0000000000000002, 1.0000000000000002]}, {"type": "bar", "x": [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0, 20.0, 21.0, 22.0, 23.0, 24.0, 25.0, 26.0, 27.0, 28.0, 29.0, 30.0, 31.0, 32.0, 33.0, 34.0, 35.0, 36.0, 37.0, 38.0, 39.0, 40.0, 41.0, 42.0, 43.0, 44.0, 45.0, 46.0, 47.0, 48.0, 49.0, 50.0, 51.0, 52.0, 53.0, 54.0, 55.0, 56.0, 57.0, 58.0, 59.0, 60.0, 61.0, 62.0, 63.0, 64.0, 65.0], "y": [0.08144674019661836, 0.0729060513863502, 0.05930725188361277, 0.055043660172652824, 0.050916140652169754, 0.04117821996689662, 0.0389142852065268, 0.03437666058379546, 0.028061979381748273, 0.024396845576677286, 0.02392353692186703, 0.022087351089361273, 0.021775345971079278, 0.020374016884106217, 0.02014082526045936, 0.019133751606907303, 0.018142921324009083, 0.017860424296375483, 0.017610614622441487, 0.017123397573430787, 0.017029040898909734, 0.016829382364601655, 0.016644738133508977, 0.01610513432091566, 0.015819113623874323, 0.015464701864330736, 0.014874058061807409, 0.01442719200267357, 0.014304314375439022, 0.013870541837092777, 0.013057660676106933, 0.0127959755564622, 0.011914984547544432, 0.011278280070034497, 0.010689792838273723, 0.010376780861809013, 0.009771006947884828, 0.009690491598261368, 0.009594295062842092, 0.008899791730353766, 0.008711919660983673, 0.007640352742283364, 0.006998535408514934, 0.006245708193447532, 0.005776098460074729, 0.003983916784313494, 0.002878490022951498, 0.0027688278670421284, 0.0018160194692311395, 0.0017397199223847528, 0.0012836213340166568, 0.0008370891573004837, 0.0004754623860677512, 0.00044391442267574104, 0.00011339089242161866, 8.249038700202535e-05, 4.714495947612673e-05, 1.6062537299701233e-32, 3.1599843789135625e-33, 1.4100121441748728e-33, 3.4060652896997636e-34, 3.4060652896997636e-34, 3.4060652896997636e-34, 3.4060652896997636e-34, 1.7334172119076309e-34]}],
                        {"template": {"data": {"bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}, "xaxis": {"title": {"text": "N\u00famero de componentes principais"}}, "yaxis": {"title": {"text": "Vari\u00e2ncia que pode ser \"explicada\""}}},
                        {"responsive": true}
                    ).then(function(){

var gd = document.getElementById('646e1618-0f78-4833-af3e-47ef350b0024');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })
                };

            </script>
        </div>
</body>
</html></div>
</div>
</div>
<div class="section" id="id7">
<h2><strong>Balancing the data</strong><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier, we have unbalanced data, more labels with value 0 than with value 1. Therefore, we will use methods to balance the data in the other states dataset, for the São Paulo dataset we have almost the same number of examples for the classes.</p>
<p>The oversampling method will be used for other states data, which creates new data for the label with less values (<code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">1</span></code>), after that we have both labels with the same number of examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    182839
1    168647
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span> <span class="o">=</span> <span class="n">X_trainSP_enc</span><span class="p">,</span> <span class="n">y_trainSP</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_SP</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(351486,)
</pre></div></div>
</div>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    13774
1     9305
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_enc</span><span class="p">,</span> <span class="n">y_trainFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_fora</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(27548,)
</pre></div></div>
</div>
</div>
<div class="section" id="id8">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder, normalizing and balancing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id9">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>The first model that will be tested is the Random Forest, for this test only the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>In the model for other states data, the hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was also used, because even after balancing the data the model still has difficulty learning the class with fewer examples, so using this parameter this class will have a greater weight in the training of the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">rf_sp</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">rf_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0, class_weight=None,
                       criterion=&#39;gini&#39;, max_depth=None, max_features=&#39;auto&#39;,
                       max_leaf_nodes=None, max_samples=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=100,
                       n_jobs=None, oob_score=False, random_state=10, verbose=0,
                       warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">rf_fora</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 10, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
</div>
<div class="section" id="id10">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost model follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. A higher weight was also used for the class with fewer examples, using the hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code>, for the model with data from outside SP.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 15 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">xgboost_sp</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_sp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP</span><span class="p">,</span> <span class="n">y_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">xgboost_fora</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                 <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">xgboost_fora</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora</span><span class="p">,</span> <span class="n">y_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=2, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2><strong>Models evaluation</strong><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>After training the models, we will use the confusion matrix to verify the performances, the features importances for each model will also be obtained.</p>
<div class="section" id="id12">
<h3><strong>Preprocessing of testing data</strong><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The preprocessing of the test data was also done using a function, <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">X_testSP_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP</span><span class="p">,</span> <span class="n">enc_SP</span><span class="p">,</span> <span class="n">norm_SP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">X_testFora_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora</span><span class="p">,</span> <span class="n">enc_fora</span><span class="p">,</span> <span class="n">norm_fora</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>Below we have the confusion matrices for the Random Forest models, followed by the graph with the most important features for each model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_testSP_</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_158_0.png" src="_images/Label_-_ob_158_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm with the SP data shows a good performance of the model, because the model achieves a 82% accuracy for both classes, <code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">1</span></code>.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that the balance of the data worked, because it was not necessary to use a higher weight for the class with fewer examples in the training of the model and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_160_0.png" src="_images/Label_-_ob_160_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_testFora_</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_162_0.png" src="_images/Label_-_ob_162_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest algorithm with the data from other states also shows a good performance of the model, with the main diagonal balanced in the confusion matrix.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_164_0.png" src="_images/Label_-_ob_164_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, the last one being the difference, in days, between treatment and diagnosis.</p>
</div></blockquote>
</div>
<div class="section" id="id14">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Below we have the confusion matrices for the XGBoost models, followed by the graph with the most important features for each model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_testSP_</span><span class="p">,</span> <span class="n">y_testSP</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_168_0.png" src="_images/Label_-_ob_168_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with the SP data shows a good performance of the model, as well as the Random Forest model.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, because it was not necessary to use a higher weight for the class with fewer examples and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_sp</span><span class="p">,</span> <span class="n">X_testSP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_170_0.png" src="_images/Label_-_ob_170_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others features. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_testFora_</span><span class="p">,</span> <span class="n">y_testFora</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_172_0.png" src="_images/Label_-_ob_172_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost algorithm with the data from other states also shows a good performance of the model, as well as the Random Forest model.</p>
</div></blockquote>
<blockquote>
<div><p>We also obtained a confusion matrix with the balanced main diagonal, with 81% and 80%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgboost_fora</span><span class="p">,</span> <span class="n">X_testFora</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_174_0.png" src="_images/Label_-_ob_174_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, but not with a lot of advantage as seen in the previous analysis. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">CATEATEND</span></code> and <code class="docutils literal notranslate"><span class="pre">IMUNO</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="Third-approach">
<h1><strong>Third approach</strong><a class="headerlink" href="#Third-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with grouped years and without the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>.</p>
<div class="section" id="id15">
<h2><strong>Reading the data</strong><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the columns <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code> will not be used in this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 92)
(32891, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      431715
delta_t6      431715
delta_t5      431715
DTRECIDIVA    431715
HORMONIO           0
QUIMIO             0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      29244
delta_t6      29244
delta_t5      29244
DTRECIDIVA    29244
HORMONIO          0
QUIMIO            0
dtype: int64
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ob              1.000000
vivo_sem_rec    0.937293
ULTINFO         0.866060
ob_sem_rec      0.832140
vivo_ano3       0.365068
ob_com_rec      0.342650
delta_t8        0.340122
delta_t7        0.336685
delta_t9        0.332492
vivo_ano5       0.294475
vivo_ano1       0.288888
ANODIAG         0.264297
CIRURGIA        0.260995
QUIMIO          0.226548
CATEATEND       0.220804
RECNENHUM       0.208701
MORFO           0.195059
IDADE           0.190838
delta_t5        0.178853
delta_t4        0.175931
Name: ob, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ob              1.000000
vivo_sem_rec    0.939117
ob_sem_rec      0.906038
ULTINFO         0.866780
vivo_ano3       0.385518
delta_t8        0.350399
delta_t7        0.343164
delta_t9        0.338123
CIRURGIA        0.301963
vivo_ano5       0.301465
vivo_ano1       0.281608
ob_com_rec      0.277742
QUIMIO          0.252260
ANODIAG         0.228325
CATEATEND       0.222303
delta_t5        0.212966
delta_t4        0.210724
delta_t6        0.205317
MORFO           0.182062
GLEASON         0.151939
Name: ob, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, it is clear that there is an imbalance. We will need to fix this problem in the preprocessing step and in the models training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    276947
1    229090
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    20359
1    12532
Name: ob, dtype: int64
</pre></div></div>
</div>
<p>Years of diagnosis present in the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
22
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
21
</pre></div></div>
</div>
</div>
<div class="section" id="Grouped-years">
<h2><strong>Grouped years</strong><a class="headerlink" href="#Grouped-years" title="Permalink to this headline">¶</a></h2>
<p>The years will be grouped as follows: 2000 to 2003, 2004 to 2007, 2008 to 2011, 2012 to 2015 and 2016 until the end. So we will have 5 datasets for SP and another 5 for other states.</p>
<div class="section" id="SP">
<h3><strong>SP</strong><a class="headerlink" href="#SP" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_00_03</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;</span> <span class="mi">2004</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2003    18407
2002    18059
2001    15456
2000    14576
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    43094
0    23404
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_04_07</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2004</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2007</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2005    21607
2007    21479
2006    20549
2004    19910
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    48142
0    35403
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_08_11</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2008</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2011</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2011    31001
2010    28461
2009    27128
2008    24381
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    56246
0    54725
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_12_15</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2012</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2015</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2014    36345
2015    35480
2013    34551
2012    32144
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    85426
1    53094
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_16_21</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;</span> <span class="mi">2015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2016    34137
2017    30927
2018    20888
2019    16054
2020     4495
2021        2
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    77989
1    28514
Name: ob, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="Other-states">
<h3><strong>Other states</strong><a class="headerlink" href="#Other-states" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_00_03</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;</span> <span class="mi">2004</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2003    1086
2002     984
2001     865
2000     802
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    2155
0    1582
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_04_07</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2004</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2007</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2007    1483
2006    1352
2005    1276
2004    1146
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    2711
1    2546
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_08_11</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2008</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2011</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2011    1731
2009    1612
2008    1567
2010    1546
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    3685
1    2771
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_12_15</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2012</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2015</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2013    2333
2015    2280
2014    2028
2012    1968
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    5807
1    2802
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_16_20</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;</span> <span class="mi">2015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2016    2517
2017    2360
2018    1963
2019    1797
2020     195
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    6574
1    2258
Name: ob, dtype: int64
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id16">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, to perform the training of the models and then their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">DTTRAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">DTULTINFO</span></code> and <code class="docutils literal notranslate"><span class="pre">DTPREENCH</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">EC</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>. The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATCONS</span></code>, <code class="docutils literal notranslate"><span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>.</p>
<p>Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;DTPREENCH&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;ob&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<p>The process will be done 5 times for SP and other states, using the datasets with grouped years.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="id17">
<h3><strong>SP</strong><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_00_03</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (49873, 65), X_test = (16625, 65)
y_train = (49873,), y_test = (16625,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_04_07</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (62658, 65), X_test = (20887, 65)
y_train = (62658,), y_test = (20887,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_08_11</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (83228, 65), X_test = (27743, 65)
y_train = (83228,), y_test = (27743,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_12_15</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (103890, 65), X_test = (34630, 65)
y_train = (103890,), y_test = (34630,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_16_21</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (79877, 65), X_test = (26626, 65)
y_train = (79877,), y_test = (26626,)
</pre></div></div>
</div>
</div>
<div class="section" id="id18">
<h3><strong>Other states</strong><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">,</span> <span class="n">y_trainFora_00_03</span><span class="p">,</span> <span class="n">y_testFora_00_03</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_00_03</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2802, 65), X_test = (935, 65)
y_train = (2802,), y_test = (935,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">,</span> <span class="n">y_trainFora_04_07</span><span class="p">,</span> <span class="n">y_testFora_04_07</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_04_07</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3942, 65), X_test = (1315, 65)
y_train = (3942,), y_test = (1315,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">,</span> <span class="n">y_trainFora_08_11</span><span class="p">,</span> <span class="n">y_testFora_08_11</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_08_11</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (4842, 65), X_test = (1614, 65)
y_train = (4842,), y_test = (1614,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">,</span> <span class="n">y_trainFora_12_15</span><span class="p">,</span> <span class="n">y_testFora_12_15</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_12_15</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (6456, 65), X_test = (2153, 65)
y_train = (6456,), y_test = (2153,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20</span><span class="p">,</span> <span class="n">y_trainFora_16_20</span><span class="p">,</span> <span class="n">y_testFora_16_20</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_16_20</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (6624, 65), X_test = (2208, 65)
y_train = (6624,), y_test = (2208,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id19">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to perform the preprocessing in the training data, for this a function was created, <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<p>This process also will be done for the ten datasets that we have.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="id20">
<h3><strong>SP</strong><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">enc_SP_00_03</span><span class="p">,</span> <span class="n">norm_SP_00_03</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">enc_SP_04_07</span><span class="p">,</span> <span class="n">norm_SP_04_07</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">enc_SP_08_11</span><span class="p">,</span> <span class="n">norm_SP_08_11</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">enc_SP_12_15</span><span class="p">,</span> <span class="n">norm_SP_12_15</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">enc_SP_16_21</span><span class="p">,</span> <span class="n">norm_SP_16_21</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id21">
<h3><strong>Other states</strong><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">enc_fora_00_03</span><span class="p">,</span> <span class="n">norm_fora_00_03</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">enc_fora_04_07</span><span class="p">,</span> <span class="n">norm_fora_04_07</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">enc_fora_08_11</span><span class="p">,</span> <span class="n">norm_fora_08_11</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">enc_fora_12_15</span><span class="p">,</span> <span class="n">norm_fora_12_15</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">enc_fora_16_20</span><span class="p">,</span> <span class="n">norm_fora_16_20</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id22">
<h2><strong>Balancing the data</strong><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier, we have unbalanced data, more labels with value 0 than with value 1, more labels with value 1 and almost the same for each class. For unbalanced data, we will use methods to balance the data.</p>
<p>In both cases the oversampling method will be used, which creates new data for the label with less values (<code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">0</span></code>), after that we have both labels with the same number of examples.</p>
<p>In the cases with almost same number of examples for both classes we will not use the oversampling.</p>
<div class="section" id="id23">
<h3><strong>SP</strong><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_00_03</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    32402
0    17471
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
<span class="n">y_SP_00_03</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(64804,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_04_07</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    36090
0    26568
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
<span class="n">y_SP_04_07</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(72180,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_08_11</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    42203
0    41025
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span> <span class="o">=</span> <span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span>
<span class="n">y_SP_08_11</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(83228,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_12_15</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    64148
1    39742
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
<span class="n">y_SP_12_15</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(128296,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_16_21</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    58394
1    21483
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
<span class="n">y_SP_16_21</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(116788,)
</pre></div></div>
</div>
</div>
<div class="section" id="id24">
<h3><strong>Other states</strong><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_00_03</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    1603
0    1199
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">y_trainFora_00_03</span><span class="p">)</span>
<span class="n">y_fora_00_03</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3206,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_04_07</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    2039
1    1903
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">y_trainFora_04_07</span><span class="p">)</span>
<span class="n">y_fora_04_07</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4078,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_08_11</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    2772
1    2070
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">y_trainFora_08_11</span><span class="p">)</span>
<span class="n">y_fora_08_11</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(5544,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_12_15</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    4360
1    2096
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">y_trainFora_12_15</span><span class="p">)</span>
<span class="n">y_fora_12_15</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(8720,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_16_20</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    4942
1    1682
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_16_20</span><span class="p">,</span> <span class="n">y_fora_16_20</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">y_trainFora_16_20</span><span class="p">)</span>
<span class="n">y_fora_16_20</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(9884,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id25">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder, normalizing and balancing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id26">
<h3><strong>Preprocessing of testing data</strong><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>The preprocessing of the test data was also done using a function, <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters, and applied for all datasets that we have.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">X_testSP_00_03_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">enc_SP_00_03</span><span class="p">,</span> <span class="n">norm_SP_00_03</span><span class="p">)</span>
<span class="n">X_testSP_04_07_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">enc_SP_04_07</span><span class="p">,</span> <span class="n">norm_SP_04_07</span><span class="p">)</span>
<span class="n">X_testSP_08_11_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">enc_SP_08_11</span><span class="p">,</span> <span class="n">norm_SP_08_11</span><span class="p">)</span>
<span class="n">X_testSP_12_15_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">enc_SP_12_15</span><span class="p">,</span> <span class="n">norm_SP_12_15</span><span class="p">)</span>
<span class="n">X_testSP_16_21_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">enc_SP_16_21</span><span class="p">,</span> <span class="n">norm_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">X_testFora_00_03_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_00_03</span><span class="p">,</span> <span class="n">enc_fora_00_03</span><span class="p">,</span> <span class="n">norm_fora_00_03</span><span class="p">)</span>
<span class="n">X_testFora_04_07_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_04_07</span><span class="p">,</span> <span class="n">enc_fora_04_07</span><span class="p">,</span> <span class="n">norm_fora_04_07</span><span class="p">)</span>
<span class="n">X_testFora_08_11_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_08_11</span><span class="p">,</span> <span class="n">enc_fora_08_11</span><span class="p">,</span> <span class="n">norm_fora_08_11</span><span class="p">)</span>
<span class="n">X_testFora_12_15_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_12_15</span><span class="p">,</span> <span class="n">enc_fora_12_15</span><span class="p">,</span> <span class="n">norm_fora_12_15</span><span class="p">)</span>
<span class="n">X_testFora_16_20_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_16_20</span><span class="p">,</span> <span class="n">enc_fora_16_20</span><span class="p">,</span> <span class="n">norm_fora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id27">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>The first model is the Random Forest, the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used, except in the 2008 to 2011 dataset for SP, because even after balancing the data the models still have difficulty to learn the class with fewer examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">rf_sp_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">rf_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 1, 1: 100}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03_</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_282_0.png" src="_images/Label_-_ob_282_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2000 to 2003, shows a good performance of the model.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that we obtained a confusion matrix with the main diagonal unbalanced, so it is necessary to adjust the weights of the classes for a better performance.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_284_0.png" src="_images/Label_-_ob_284_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>. <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> being the difference, in days, between treatment and consultation and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code> between treatment and diagnosis.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">rf_sp_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">rf_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 1, 1: 100}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07_</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_287_0.png" src="_images/Label_-_ob_287_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2004 to 2007, shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_289_0.png" src="_images/Label_-_ob_289_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, the last three being the difference, in days, between diagnosis and consultation, between treatment and consultation and between treatmnet and diagnosis, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">rf_sp_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">rf_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0, class_weight=None,
                       criterion=&#39;gini&#39;, max_depth=None, max_features=&#39;auto&#39;,
                       max_leaf_nodes=None, max_samples=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=100,
                       n_jobs=None, oob_score=False, random_state=10, verbose=0,
                       warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11_</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_292_0.png" src="_images/Label_-_ob_292_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2008 to 2011, shows a good performance of the model, with 81% of accuray.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that the balance of the data worked, because it was not necessary to use a higher weight for the class with fewer examples in the training of the model and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_294_0.png" src="_images/Label_-_ob_294_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">rf_sp_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 100, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15_</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_297_0.png" src="_images/Label_-_ob_297_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2012 to 2015, shows a good performance of the model.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that we obtained a confusion matrix with the main diagonal a little unbalanced, so it is necessary to adjust the weights of the classes for a better performance.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_299_0.png" src="_images/Label_-_ob_299_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, the last three being the difference, in days, between diagnosis and consultation, treatment and consultation and between treatmnet and diagnosis, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">rf_sp_16_21</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 1000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21_</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_302_0.png" src="_images/Label_-_ob_302_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2016 to 2021, shows a good performance of the model.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that we obtained a confusion matrix with the main diagonal a little unbalanced, so it is necessary to adjust the weights of the classes for a better performance.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_304_0.png" src="_images/Label_-_ob_304_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">N</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, and <code class="docutils literal notranslate"><span class="pre">ESCOLARI</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">rf_fora_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">3_000_000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 3000000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03_</span><span class="p">,</span> <span class="n">y_testFora_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_308_0.png" src="_images/Label_-_ob_308_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the other states data from 2000 to 2003, also shows a good performance of the model, and we have a balanced main diagonal in the confusion matrix.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_310_0.png" src="_images/Label_-_ob_310_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> and <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>. <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> is the difference, in days, between treatment and diagnosis and <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> is the difference between diagnosis and consultation.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">rf_fora_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 10, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07_</span><span class="p">,</span> <span class="n">y_testFora_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_313_0.png" src="_images/Label_-_ob_313_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2004 to 2007, also shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_315_0.png" src="_images/Label_-_ob_315_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, the last one being the difference, in days, between diagnosis and consultation.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">rf_fora_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 100, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11_</span><span class="p">,</span> <span class="n">y_testFora_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_318_0.png" src="_images/Label_-_ob_318_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2008 to 2011, also shows a good performance of the model, but we have a little unbalanced main diagonal in the confusion matrix, it means that we have to adjust the class weights in the model training, in order to obtain a balanced diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_320_0.png" src="_images/Label_-_ob_320_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">IBGE</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>, the first one being the difference, in days, between diagnosis and consultation, and the last one being the difference between treatment and consultation.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">rf_fora_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 100, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15_</span><span class="p">,</span> <span class="n">y_testFora_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_323_0.png" src="_images/Label_-_ob_323_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2012 to 2015, also shows a good performance of the model, but we have a unbalanced main diagonal in the confusion matrix, it means that we have to adjust the class weights in the model training, in order to obtain a balanced diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_325_0.png" src="_images/Label_-_ob_325_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>, <code class="docutils literal notranslate"><span class="pre">IBGE</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>. <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> is the difference, in days, between treatment and diagnosis and <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> is the difference between diagnosis and consultation.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">rf_fora_16_20</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_16_20</span><span class="p">,</span> <span class="n">y_fora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 100, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20_</span><span class="p">,</span> <span class="n">y_testFora_16_20</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_328_0.png" src="_images/Label_-_ob_328_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2016 to 2020, also shows a good performance of the model, but we have a unbalanced main diagonal in the confusion matrix, it means that we have to adjust the class weights in the model training, in order to obtain a balanced diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_330_0.png" src="_images/Label_-_ob_330_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> and <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>. <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> is the difference, in days, between diagnosis and consultation.</p>
</div></blockquote>
</div>
<div class="section" id="id28">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost models follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. The hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> was also used in some trainings, in order to obtain a balanced main diagonal in the confusion matrix.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 15 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">xgb_sp_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>
<span class="n">xgb_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.35, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03_</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_336_0.png" src="_images/Label_-_ob_336_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2000 to 2003, shows a good performance of the model, as well as the Random Forest model, here with 80% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that was necessary to use a lower weight for the class with more examples and the confusion matrix have the main diagonal balanced.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_338_0.png" src="_images/Label_-_ob_338_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">RECDIST</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">xgb_sp_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">xgb_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.6, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07_</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_341_0.png" src="_images/Label_-_ob_341_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2004 to 2007, shows a good performance of the model, with 80% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, it was not necessary to use a lower weight for the class with more examples and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_343_0.png" src="_images/Label_-_ob_343_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">xgb_sp_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11_</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_346_0.png" src="_images/Label_-_ob_346_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2008 to 2011, shows a good performance of the model, as well as the Random Forest model.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, because it was not necessary to use the <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> parameter and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_348_0.png" src="_images/Label_-_ob_348_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">xgb_sp_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">xgb_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=3, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15_</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_351_0.png" src="_images/Label_-_ob_351_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2012 to 2015, shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, it was necessary to use a higher weight for the class with fewer examples and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_353_0.png" src="_images/Label_-_ob_353_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">xgb_sp_16_21</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">xgb_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=15, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21_</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_356_0.png" src="_images/Label_-_ob_356_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2016 to 2021, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, it was necessary to use a higher weight for the class with fewer examples and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_358_0.png" src="_images/Label_-_ob_358_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">HORMOAPOS</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">xgb_fora_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03_</span><span class="p">,</span> <span class="n">y_testFora_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_362_0.png" src="_images/Label_-_ob_362_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2000 to 2003, also shows a good performance of the model.</p>
</div></blockquote>
<blockquote>
<div><p>We also obtained a confusion matrix with the balanced main diagonal, with 72% and 75%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_364_0.png" src="_images/Label_-_ob_364_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code> and <code class="docutils literal notranslate"><span class="pre">RECDIST</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">xgb_fora_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=2, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07_</span><span class="p">,</span> <span class="n">y_testFora_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_367_0.png" src="_images/Label_-_ob_367_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2004 to 2007, also shows a good performance of the model with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_369_0.png" src="_images/Label_-_ob_369_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage as seen in the previous analysis. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECLOCAL</span></code> and <code class="docutils literal notranslate"><span class="pre">META01</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">xgb_fora_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=4, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11_</span><span class="p">,</span> <span class="n">y_testFora_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_372_0.png" src="_images/Label_-_ob_372_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states from 2008 to 2011, also shows a good performance of the model with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_374_0.png" src="_images/Label_-_ob_374_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, but not with a lot of advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">TOPGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">REC01</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">xgb_fora_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=30, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15_</span><span class="p">,</span> <span class="n">y_testFora_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_377_0.png" src="_images/Label_-_ob_377_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2012 to 2015, also shows a good performance of the model with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_379_0.png" src="_images/Label_-_ob_379_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">RADIOAPOS</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">CATEATEND</span></code> and <code class="docutils literal notranslate"><span class="pre">QUIMIOAPOS</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">xgb_fora_16_20</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
                                  <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_16_20</span><span class="p">,</span> <span class="n">y_fora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=35, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20_</span><span class="p">,</span> <span class="n">y_testFora_16_20</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_382_0.png" src="_images/Label_-_ob_382_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states from 2016 to 2020, shows the best performance comparing with the other models, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_384_0.png" src="_images/Label_-_ob_384_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">CIRURAPOS</span></code>, with a lot of advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">PSA</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">TRATFAPOS</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="Fourth-approach">
<h1><strong>Fourth approach</strong><a class="headerlink" href="#Fourth-approach" title="Permalink to this headline">¶</a></h1>
<p>Approach with grouped years, using only morphologies with final digit equal to 3 and without the column <code class="docutils literal notranslate"><span class="pre">EC</span></code>.</p>
<div class="section" id="id29">
<h2><strong>Reading the data</strong><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<p>Reading the data from SP and other states.</p>
<p>We can see that we still have some missing values in both datasets, but the columns <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t4</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t5</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t6</span></code> will not be used in this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_SP_labels.csv&#39;</span><span class="p">)</span>
<span class="n">df_fora</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Trabalho/Cancer/Datasets/cancer_foraSP_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(506037, 92)
(32891, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      431715
delta_t6      431715
delta_t5      431715
DTRECIDIVA    431715
HORMONIO           0
QUIMIO             0
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">df_fora</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
delta_t4      29244
delta_t6      29244
delta_t5      29244
DTRECIDIVA    29244
HORMONIO          0
QUIMIO            0
dtype: int64
</pre></div></div>
</div>
<p>Here we have the correlations between the label and the other columns, the columns with higher correlations will not be used as features of the models, because they may have been used to create the label, such as the <code class="docutils literal notranslate"><span class="pre">ULTINFO</span></code> column, or they can be used as label for other machine learning models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ob              1.000000
vivo_sem_rec    0.937293
ULTINFO         0.866060
ob_sem_rec      0.832140
vivo_ano3       0.365068
ob_com_rec      0.342650
delta_t8        0.340122
delta_t7        0.336685
delta_t9        0.332492
vivo_ano5       0.294475
vivo_ano1       0.288888
ANODIAG         0.264297
CIRURGIA        0.260995
QUIMIO          0.226548
CATEATEND       0.220804
RECNENHUM       0.208701
MORFO           0.195059
IDADE           0.190838
delta_t5        0.178853
delta_t4        0.175931
Name: ob, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ob              1.000000
vivo_sem_rec    0.939117
ob_sem_rec      0.906038
ULTINFO         0.866780
vivo_ano3       0.385518
delta_t8        0.350399
delta_t7        0.343164
delta_t9        0.338123
CIRURGIA        0.301963
vivo_ano5       0.301465
vivo_ano1       0.281608
ob_com_rec      0.277742
QUIMIO          0.252260
ANODIAG         0.228325
CATEATEND       0.222303
delta_t5        0.212966
delta_t4        0.210724
delta_t6        0.205317
MORFO           0.182062
GLEASON         0.151939
Name: ob, dtype: float64
</pre></div></div>
</div>
<p>Here we have the number of examples for each category of the label, it is clear that there is an imbalance. We will need to fix this problem in the preprocessing step and in the models training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    276947
1    229090
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    20359
1    12532
Name: ob, dtype: int64
</pre></div></div>
</div>
<p>Years of diagnosis present in the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
22
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
21
</pre></div></div>
</div>
</div>
<div class="section" id="id30">
<h2><strong>Behavior column</strong><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h2>
<p>A column will be created, in both datasets, with the final digit of the <code class="docutils literal notranslate"><span class="pre">MORFO</span></code> column, then only those with behavior equal to 3 will be selected to continue the analysis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">df_SP</span><span class="p">[</span><span class="s1">&#39;comportamento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_SP</span><span class="o">.</span><span class="n">MORFO</span><span class="p">]</span>
<span class="n">df_SP</span><span class="o">.</span><span class="n">comportamento</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3    468649
2     36682
1       706
Name: comportamento, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_comp</span> <span class="o">=</span> <span class="n">df_SP</span><span class="p">[</span><span class="n">df_SP</span><span class="o">.</span><span class="n">comportamento</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_comp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;comportamento&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_SP_comp</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(468649, 92)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">df_fora</span><span class="p">[</span><span class="s1">&#39;comportamento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_fora</span><span class="o">.</span><span class="n">MORFO</span><span class="p">]</span>
<span class="n">df_fora</span><span class="o">.</span><span class="n">comportamento</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3    30772
2     2112
1        7
Name: comportamento, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_comp</span> <span class="o">=</span> <span class="n">df_fora</span><span class="p">[</span><span class="n">df_fora</span><span class="o">.</span><span class="n">comportamento</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_comp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;comportamento&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_fora_comp</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(30772, 92)
</pre></div></div>
</div>
</div>
<div class="section" id="id31">
<h2><strong>Grouped years</strong><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
<p>The years will be grouped as follows: 2000 to 2003, 2004 to 2007, 2008 to 2011, 2012 to 2015 and 2016 until the end. So we will have 5 datasets for SP and another 5 for other states.</p>
<div class="section" id="id32">
<h3><strong>SP</strong><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_00_03</span> <span class="o">=</span> <span class="n">df_SP_comp</span><span class="p">[</span><span class="n">df_SP_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;</span> <span class="mi">2004</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2003    17022
2002    16557
2001    14255
2000    13631
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_00_03</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    42313
0    19152
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_04_07</span> <span class="o">=</span> <span class="n">df_SP_comp</span><span class="p">[(</span><span class="n">df_SP_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2004</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2007</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2005    20100
2007    19864
2006    19130
2004    18465
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_04_07</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    47232
0    30327
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_08_11</span> <span class="o">=</span> <span class="n">df_SP_comp</span><span class="p">[(</span><span class="n">df_SP_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2008</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2011</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2011    28876
2010    26589
2009    25124
2008    22627
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_08_11</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    55158
0    48058
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_12_15</span> <span class="o">=</span> <span class="n">df_SP_comp</span><span class="p">[(</span><span class="n">df_SP_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2012</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_SP_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2015</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2014    33611
2015    32728
2013    32037
2012    29790
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_12_15</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    75774
1    52392
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_16_21</span> <span class="o">=</span> <span class="n">df_SP_comp</span><span class="p">[</span><span class="n">df_SP_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;</span> <span class="mi">2015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2016    31471
2017    28510
2018    19288
2019    14833
2020     4140
2021        1
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_SP_16_21</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    70030
1    28213
Name: ob, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="id33">
<h3><strong>Other states</strong><a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_00_03</span> <span class="o">=</span> <span class="n">df_fora_comp</span><span class="p">[</span><span class="n">df_fora_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;</span> <span class="mi">2004</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2003    1007
2002     890
2001     810
2000     750
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_00_03</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    2122
0    1335
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_04_07</span> <span class="o">=</span> <span class="n">df_fora_comp</span><span class="p">[(</span><span class="n">df_fora_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2004</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2007</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2007    1379
2006    1268
2005    1191
2004    1088
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_04_07</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    2526
0    2400
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_08_11</span> <span class="o">=</span> <span class="n">df_fora_comp</span><span class="p">[(</span><span class="n">df_fora_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2008</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2011</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2011    1602
2009    1517
2008    1476
2010    1454
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_08_11</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    3307
1    2742
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_12_15</span> <span class="o">=</span> <span class="n">df_fora_comp</span><span class="p">[(</span><span class="n">df_fora_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;=</span> <span class="mi">2012</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fora_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&lt;=</span> <span class="mi">2015</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2013    2203
2015    2130
2014    1905
2012    1855
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_12_15</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    5308
1    2785
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_16_20</span> <span class="o">=</span> <span class="n">df_fora_comp</span><span class="p">[</span><span class="n">df_fora_comp</span><span class="o">.</span><span class="n">ANODIAG</span> <span class="o">&gt;</span> <span class="mi">2015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">ANODIAG</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2016    2354
2017    2211
2018    1854
2019    1657
2020     171
Name: ANODIAG, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fora_16_20</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    6002
1    2245
Name: ob, dtype: int64
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id34">
<h2><strong>Training and testing split</strong><a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to divide the data into training and testing, to perform the training of the models and then their evaluation.</p>
<p>First, it is necessary to define the columns that will be used as features and the label. For the features we will not use some columns of the data: <code class="docutils literal notranslate"><span class="pre">UFRESID</span></code>, because we already have the division between SP and other states in the two datasets. The date columns will also be removed, <code class="docutils literal notranslate"><span class="pre">DTCONSULT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">DTTRAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DTRECIDIVA</span></code>, <code class="docutils literal notranslate"><span class="pre">DTULTINFO</span></code> and <code class="docutils literal notranslate"><span class="pre">DTPREENCH</span></code>, because we already have the difference in days in other columns.</p>
<p>It was chosen to keep the column <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, so we will not use the <code class="docutils literal notranslate"><span class="pre">FAIXAETAR</span></code>, as well as the column <code class="docutils literal notranslate"><span class="pre">EC</span></code> and not the column <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>. The columns <code class="docutils literal notranslate"><span class="pre">CONSDIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">TRATCONS</span></code>, <code class="docutils literal notranslate"><span class="pre">DIAGTRAT</span></code> contain the same information as the <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>.</p>
<p>Finally, the other columns contained in the list <code class="docutils literal notranslate"><span class="pre">list_drop</span></code> are possible labels, so they will not be used as features for machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">list_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UFRESID&#39;</span><span class="p">,</span> <span class="s1">&#39;DTCONSULT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;DTTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;DTRECIDIVA&#39;</span><span class="p">,</span> <span class="s1">&#39;DTULTINFO&#39;</span><span class="p">,</span>
             <span class="s1">&#39;DTPREENCH&#39;</span><span class="p">,</span> <span class="s1">&#39;FAIXAETAR&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSDIAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRATCONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIAGTRAT&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t4&#39;</span><span class="p">,</span>
             <span class="s1">&#39;delta_t5&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t6&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t7&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t8&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_t9&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_ano3&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_ano5&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_com_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;vivo_com_rec&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vivo_sem_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTINFO&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">]</span>

<span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;ob&#39;</span>
</pre></div>
</div>
</div>
<p>A function was created to perform the division of the data in training and testing, <code class="docutils literal notranslate"><span class="pre">get_train_test</span></code>. It is only necessary to pass the dataframe that will be used, a list with the columns that will not be used and a string with the name of the column that will be the label.</p>
<p>The process will be done 5 times for SP and other states, using the datasets with grouped years.</p>
<blockquote>
<div><p>To see the complete function go to the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="id35">
<h3><strong>SP</strong><a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">,</span> <span class="n">y_testSP_00_03</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_00_03</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (46098, 65), X_test = (15367, 65)
y_train = (46098,), y_test = (15367,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">,</span> <span class="n">y_testSP_04_07</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_04_07</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (58169, 65), X_test = (19390, 65)
y_train = (58169,), y_test = (19390,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">,</span> <span class="n">y_testSP_08_11</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_08_11</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (77412, 65), X_test = (25804, 65)
y_train = (77412,), y_test = (25804,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">,</span> <span class="n">y_testSP_12_15</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_12_15</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (96124, 65), X_test = (32042, 65)
y_train = (96124,), y_test = (32042,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">,</span> <span class="n">y_testSP_16_21</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_SP_16_21</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (73682, 65), X_test = (24561, 65)
y_train = (73682,), y_test = (24561,)
</pre></div></div>
</div>
</div>
<div class="section" id="id36">
<h3><strong>Other states</strong><a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">,</span> <span class="n">y_trainFora_00_03</span><span class="p">,</span> <span class="n">y_testFora_00_03</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_00_03</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (2592, 65), X_test = (865, 65)
y_train = (2592,), y_test = (865,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">,</span> <span class="n">y_trainFora_04_07</span><span class="p">,</span> <span class="n">y_testFora_04_07</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_04_07</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (3694, 65), X_test = (1232, 65)
y_train = (3694,), y_test = (1232,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">,</span> <span class="n">y_trainFora_08_11</span><span class="p">,</span> <span class="n">y_testFora_08_11</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_08_11</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (4536, 65), X_test = (1513, 65)
y_train = (4536,), y_test = (1513,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">,</span> <span class="n">y_trainFora_12_15</span><span class="p">,</span> <span class="n">y_testFora_12_15</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_12_15</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (6069, 65), X_test = (2024, 65)
y_train = (6069,), y_test = (2024,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20</span><span class="p">,</span> <span class="n">y_trainFora_16_20</span><span class="p">,</span> <span class="n">y_testFora_16_20</span> <span class="o">=</span> <span class="n">get_train_test</span><span class="p">(</span><span class="n">df_fora_16_20</span><span class="p">,</span> <span class="n">list_drop</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X_train = (6185, 65), X_test = (2062, 65)
y_train = (6185,), y_test = (2062,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id37">
<h2><strong>Encoder and normalization</strong><a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing it is necessary to perform the preprocessing in the training data, for this a function was created, <code class="docutils literal notranslate"><span class="pre">train_preprocessing</span></code>, it returns the data encoded (columns that are strings) and normalized. Training data is required for the function.</p>
<p>This process also will be done for the ten datasets that we have.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a>.</p>
</div></blockquote>
<div class="section" id="id38">
<h3><strong>SP</strong><a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">enc_SP_00_03</span><span class="p">,</span> <span class="n">norm_SP_00_03</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">enc_SP_04_07</span><span class="p">,</span> <span class="n">norm_SP_04_07</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">enc_SP_08_11</span><span class="p">,</span> <span class="n">norm_SP_08_11</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">enc_SP_12_15</span><span class="p">,</span> <span class="n">norm_SP_12_15</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">enc_SP_16_21</span><span class="p">,</span> <span class="n">norm_SP_16_21</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id39">
<h3><strong>Other states</strong><a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">enc_fora_00_03</span><span class="p">,</span> <span class="n">norm_fora_00_03</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">enc_fora_04_07</span><span class="p">,</span> <span class="n">norm_fora_04_07</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">enc_fora_08_11</span><span class="p">,</span> <span class="n">norm_fora_08_11</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">enc_fora_12_15</span><span class="p">,</span> <span class="n">norm_fora_12_15</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">enc_fora_16_20</span><span class="p">,</span> <span class="n">norm_fora_16_20</span> <span class="o">=</span> <span class="n">train_preprocessing</span><span class="p">(</span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">normalizer</span><span class="o">=</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id40">
<h2><strong>Balancing the data</strong><a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier, we have unbalanced data, more labels with value 0 than with value 1, more labels with value 1 and almost the same for each class. For unbalanced data, we will use methods to balance the data.</p>
<p>In both cases the oversampling method will be used, which creates new data for the label with less values (<code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">ob</span> <span class="pre">=</span> <span class="pre">0</span></code>), after that we have both labels with the same number of examples.</p>
<p>In the cases with almost same number of examples for both classes we will not use the oversampling.</p>
<div class="section" id="id41">
<h3><strong>SP</strong><a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_00_03</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    31736
0    14362
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_00_03</span><span class="p">,</span> <span class="n">y_trainSP_00_03</span><span class="p">)</span>
<span class="n">y_SP_00_03</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(63472,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_04_07</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    35390
0    22779
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_04_07</span><span class="p">,</span> <span class="n">y_trainSP_04_07</span><span class="p">)</span>
<span class="n">y_SP_04_07</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(70780,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_08_11</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    41426
0    35986
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_08_11</span><span class="p">,</span> <span class="n">y_trainSP_08_11</span><span class="p">)</span>
<span class="n">y_SP_08_11</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(82852,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_12_15</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    56707
1    39417
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_12_15</span><span class="p">,</span> <span class="n">y_trainSP_12_15</span><span class="p">)</span>
<span class="n">y_SP_12_15</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(113414,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainSP_16_21</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    52436
1    21246
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainSP_16_21</span><span class="p">,</span> <span class="n">y_trainSP_16_21</span><span class="p">)</span>
<span class="n">y_SP_16_21</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(104872,)
</pre></div></div>
</div>
</div>
<div class="section" id="id42">
<h3><strong>Other states</strong><a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_00_03</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    1583
0    1009
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_00_03</span><span class="p">,</span> <span class="n">y_trainFora_00_03</span><span class="p">)</span>
<span class="n">y_fora_00_03</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3166,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_04_07</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1    1909
0    1785
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_04_07</span><span class="p">,</span> <span class="n">y_trainFora_04_07</span><span class="p">)</span>
<span class="n">y_fora_04_07</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3818,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_08_11</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    2464
1    2072
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_08_11</span><span class="p">,</span> <span class="n">y_trainFora_08_11</span><span class="p">)</span>
<span class="n">y_fora_08_11</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4928,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_12_15</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    3989
1    2080
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_12_15</span><span class="p">,</span> <span class="n">y_trainFora_12_15</span><span class="p">)</span>
<span class="n">y_fora_12_15</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(7978,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of values for each label in the training data</span>
<span class="n">y_trainFora_16_20</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    4444
1    1741
Name: ob, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_fora_16_20</span><span class="p">,</span> <span class="n">y_fora_16_20</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_trainFora_16_20</span><span class="p">,</span> <span class="n">y_trainFora_16_20</span><span class="p">)</span>
<span class="n">y_fora_16_20</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning:

Function safe_indexing is deprecated; safe_indexing is deprecated in version 0.22 and will be removed in version 0.24.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(8888,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="id43">
<h2><strong>Training machine learning models</strong><a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h2>
<p>After dividing the data into training and testing, using the encoder, normalizing and balancing, the data is ready to be used by the machine learning models.</p>
<div class="section" id="id44">
<h3><strong>Preprocessing of testing data</strong><a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h3>
<p>The preprocessing of the test data was also done using a function, <code class="docutils literal notranslate"><span class="pre">test_preprocessing</span></code>, passing the test data and the encoder and normalizer, trained to the training data, as parameters, and applied for all datasets that we have.</p>
<blockquote>
<div><p>See the complete function in the <a class="reference external" href="https://cancer-project.readthedocs.io/en/latest/Cancer%20Libraries%20and%20functions.html#Models">functions section</a></p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP</span>
<span class="n">X_testSP_00_03_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_00_03</span><span class="p">,</span> <span class="n">enc_SP_00_03</span><span class="p">,</span> <span class="n">norm_SP_00_03</span><span class="p">)</span>
<span class="n">X_testSP_04_07_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_04_07</span><span class="p">,</span> <span class="n">enc_SP_04_07</span><span class="p">,</span> <span class="n">norm_SP_04_07</span><span class="p">)</span>
<span class="n">X_testSP_08_11_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_08_11</span><span class="p">,</span> <span class="n">enc_SP_08_11</span><span class="p">,</span> <span class="n">norm_SP_08_11</span><span class="p">)</span>
<span class="n">X_testSP_12_15_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_12_15</span><span class="p">,</span> <span class="n">enc_SP_12_15</span><span class="p">,</span> <span class="n">norm_SP_12_15</span><span class="p">)</span>
<span class="n">X_testSP_16_21_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testSP_16_21</span><span class="p">,</span> <span class="n">enc_SP_16_21</span><span class="p">,</span> <span class="n">norm_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states</span>
<span class="n">X_testFora_00_03_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_00_03</span><span class="p">,</span> <span class="n">enc_fora_00_03</span><span class="p">,</span> <span class="n">norm_fora_00_03</span><span class="p">)</span>
<span class="n">X_testFora_04_07_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_04_07</span><span class="p">,</span> <span class="n">enc_fora_04_07</span><span class="p">,</span> <span class="n">norm_fora_04_07</span><span class="p">)</span>
<span class="n">X_testFora_08_11_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_08_11</span><span class="p">,</span> <span class="n">enc_fora_08_11</span><span class="p">,</span> <span class="n">norm_fora_08_11</span><span class="p">)</span>
<span class="n">X_testFora_12_15_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_12_15</span><span class="p">,</span> <span class="n">enc_fora_12_15</span><span class="p">,</span> <span class="n">norm_fora_12_15</span><span class="p">)</span>
<span class="n">X_testFora_16_20_</span> <span class="o">=</span> <span class="n">test_preprocessing</span><span class="p">(</span><span class="n">X_testFora_16_20</span><span class="p">,</span> <span class="n">enc_fora_16_20</span><span class="p">,</span> <span class="n">norm_fora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id45">
<h3><strong>Random Forest</strong><a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h3>
<p>The first model is the Random Forest, the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> will be used as a parameter, to obtain the same training values of the model every time it is runned.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> was used, except in the 2008 to 2011 dataset for SP, because even after balancing the data the models still have difficulty to learn the class with fewer examples.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">rf_sp_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">rf_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 1, 1: 100}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03_</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_498_0.png" src="_images/Label_-_ob_498_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2000 to 2003, shows a good performance of the model.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that we obtained a confusion matrix with the main diagonal unbalanced, so it is necessary to adjust the weights of the classes for a better performance.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_500_0.png" src="_images/Label_-_ob_500_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>. The last two being the difference, in days, between treatment and consultation and between treatment and diagnosis, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">rf_sp_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">rf_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 1, 1: 100}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07_</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_503_0.png" src="_images/Label_-_ob_503_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2004 to 2007, shows a good performance of the model, with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_505_0.png" src="_images/Label_-_ob_505_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, the last three being the difference, in days, between diagnosis and consultation, between treatment and consultation and between treatmnet and diagnosis, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">rf_sp_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> <span class="c1">#class_weight={0:1, 1:100}</span>
<span class="n">rf_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0, class_weight=None,
                       criterion=&#39;gini&#39;, max_depth=None, max_features=&#39;auto&#39;,
                       max_leaf_nodes=None, max_samples=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=100,
                       n_jobs=None, oob_score=False, random_state=10, verbose=0,
                       warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11_</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_508_0.png" src="_images/Label_-_ob_508_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2008 to 2011, shows a good performance of the model, with 80% of accuray.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that the balance of the data worked, because it was not necessary to use a higher weight for the class with fewer examples in the training of the model and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_510_0.png" src="_images/Label_-_ob_510_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPO</span></code> and <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">rf_sp_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 100, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15_</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_513_0.png" src="_images/Label_-_ob_513_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2012 to 2015, shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that we obtained a confusion matrix with the main diagonal a little unbalanced.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_515_0.png" src="_images/Label_-_ob_515_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>, the last three being the difference, in days, between diagnosis and consultation, treatment and consultation and between treatmnet and diagnosis, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">rf_sp_16_21</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 100, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21_</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_518_0.png" src="_images/Label_-_ob_518_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the SP data from 2016 to 2021, shows a good performance of the model.</p>
</div></blockquote>
<blockquote>
<div><p>It is also noticed that we obtained a confusion matrix with the main diagonal unbalanced, so it is necessary to adjust the weights of the classes for a better performance.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_520_0.png" src="_images/Label_-_ob_520_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">N</span></code>, and <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, the last one being the difference, in days, between diagnosis and consultation.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">rf_fora_00_03</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">100</span><span class="p">})</span>
<span class="n">rf_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 1, 1: 100}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03_</span><span class="p">,</span> <span class="n">y_testFora_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_524_0.png" src="_images/Label_-_ob_524_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with the other states data from 2000 to 2003, also shows a good performance of the model, and we have a balanced main diagonal in the confusion matrix.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_526_0.png" src="_images/Label_-_ob_526_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code>. The last two being the difference, in days, between treatment and consultation and between treatment and diagnosis, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">rf_fora_04_07</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> <span class="c1"># class_weight={0:10, 1:1})</span>
<span class="n">rf_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0, class_weight=None,
                       criterion=&#39;gini&#39;, max_depth=None, max_features=&#39;auto&#39;,
                       max_leaf_nodes=None, max_samples=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=100,
                       n_jobs=None, oob_score=False, random_state=10, verbose=0,
                       warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07_</span><span class="p">,</span> <span class="n">y_testFora_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_529_0.png" src="_images/Label_-_ob_529_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2004 to 2007, also shows a good performance of the model, with 77% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_531_0.png" src="_images/Label_-_ob_531_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">rf_fora_08_11</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 100, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11_</span><span class="p">,</span> <span class="n">y_testFora_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_534_0.png" src="_images/Label_-_ob_534_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2008 to 2011, also shows a good performance of the model, we have a balanced main diagonal in the confusion matrix, with 80% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_536_0.png" src="_images/Label_-_ob_536_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t2</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>, the last two being the difference, in days, between treatment and diagnosis and between diagnosis and consultation, respectively.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">rf_fora_12_15</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 10000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15_</span><span class="p">,</span> <span class="n">y_testFora_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_539_0.png" src="_images/Label_-_ob_539_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2012 to 2015, also shows a good performance of the model, but we have a little unbalanced main diagonal in the confusion matrix, it means that we have to adjust the class weights in the model training, in order to obtain a balanced diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_541_0.png" src="_images/Label_-_ob_541_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">IBGE</span></code>, <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code>. <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code> is the difference between diagnosis and consultation and <code class="docutils literal notranslate"><span class="pre">delta_t3</span></code> is the difference, in days, between treatment and diagnosis.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">rf_fora_16_20</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">rf_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_16_20</span><span class="p">,</span> <span class="n">y_fora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                       class_weight={0: 10000, 1: 1}, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       max_samples=None, min_impurity_decrease=0.0,
                       min_impurity_split=None, min_samples_leaf=1,
                       min_samples_split=2, min_weight_fraction_leaf=0.0,
                       n_estimators=100, n_jobs=None, oob_score=False,
                       random_state=10, verbose=0, warm_start=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20_</span><span class="p">,</span> <span class="n">y_testFora_16_20</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_544_0.png" src="_images/Label_-_ob_544_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the Random Forest, with other states data from 2016 to 2020, also shows a good performance of the model, with 83% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">rf_fora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_546_0.png" src="_images/Label_-_ob_546_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features in the model were <code class="docutils literal notranslate"><span class="pre">ANODIAG</span></code>, <code class="docutils literal notranslate"><span class="pre">IDADE</span></code>, <code class="docutils literal notranslate"><span class="pre">IBGE</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_t1</span></code>. The last one being the difference, in days, between diagnosis and consultation.</p>
</div></blockquote>
</div>
<div class="section" id="id46">
<h3><strong>XGBoost</strong><a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h3>
<p>The training of the XGBoost models follows the same pattern with <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. The hyperparameter <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> was also used in some trainings, in order to obtain a balanced main diagonal in the confusion matrix.</p>
<p>The hyperparameter <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> was chosen as 15 because the default value for this hyperparameter is 3, a low value for the amount of data we have.</p>
<p><strong>SP</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2000 to 2003</span>
<span class="n">xgb_sp_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">xgb_sp_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_00_03</span><span class="p">,</span> <span class="n">y_SP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.25, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03_</span><span class="p">,</span> <span class="n">y_testSP_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_552_0.png" src="_images/Label_-_ob_552_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2000 to 2003, shows a good performance of the model, with 79% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that was necessary to use a lower weight for the class with more examples and the confusion matrix have the main diagonal balanced.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_00_03</span><span class="p">,</span> <span class="n">X_testSP_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_554_0.png" src="_images/Label_-_ob_554_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">REC02</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2004 to 2007</span>
<span class="n">xgb_sp_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">xgb_sp_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_04_07</span><span class="p">,</span> <span class="n">y_SP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.6, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07_</span><span class="p">,</span> <span class="n">y_testSP_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_557_0.png" src="_images/Label_-_ob_557_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2004 to 2007, shows a good performance of the model, with 79% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, it was not necessary to use a lower weight for the class with more examples and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_04_07</span><span class="p">,</span> <span class="n">X_testSP_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_559_0.png" src="_images/Label_-_ob_559_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2008 to 2011</span>
<span class="n">xgb_sp_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_sp_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_08_11</span><span class="p">,</span> <span class="n">y_SP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11_</span><span class="p">,</span> <span class="n">y_testSP_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_562_0.png" src="_images/Label_-_ob_562_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2008 to 2011, shows a good performance of the model, with 80% pf accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, because it was not necessary to use the <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> parameter and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_08_11</span><span class="p">,</span> <span class="n">X_testSP_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_564_0.png" src="_images/Label_-_ob_564_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2012 to 2015</span>
<span class="n">xgb_sp_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xgb_sp_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_12_15</span><span class="p">,</span> <span class="n">y_SP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=2, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15_</span><span class="p">,</span> <span class="n">y_testSP_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_567_0.png" src="_images/Label_-_ob_567_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2012 to 2015, shows a good performance of the model, with 82% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, it was necessary to use a higher weight for the class with fewer examples and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_12_15</span><span class="p">,</span> <span class="n">X_testSP_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_569_0.png" src="_images/Label_-_ob_569_0.png" />
</div>
</div>
<blockquote>
<div><p>Here we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage over the others. Following we have <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># SP - 2016 to 2021</span>
<span class="n">xgb_sp_16_21</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                 <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">xgb_sp_16_21</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_SP_16_21</span><span class="p">,</span> <span class="n">y_SP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=10, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21_</span><span class="p">,</span> <span class="n">y_testSP_16_21</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_572_0.png" src="_images/Label_-_ob_572_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with the SP data from 2016 to 2021, shows a good performance of the model, with 81% of accuracy.</p>
</div></blockquote>
<blockquote>
<div><p>We also noticed that the balance of the data worked, it was necessary to use a higher weight for the class with fewer examples and we obtained a confusion matrix with the balanced main diagonal.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_sp_16_21</span><span class="p">,</span> <span class="n">X_testSP_16_21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_574_0.png" src="_images/Label_-_ob_574_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>, <code class="docutils literal notranslate"><span class="pre">TOPOGRUP</span></code> and <code class="docutils literal notranslate"><span class="pre">GLEASON</span></code>.</p>
</div></blockquote>
<p><strong>Other states</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2000 to 2003</span>
<span class="n">xgb_fora_00_03</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                   <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">xgb_fora_00_03</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_00_03</span><span class="p">,</span> <span class="n">y_fora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=0.5, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03_</span><span class="p">,</span> <span class="n">y_testFora_00_03</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_578_0.png" src="_images/Label_-_ob_578_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2000 to 2003, also shows a good performance of the model.</p>
</div></blockquote>
<blockquote>
<div><p>We also obtained a confusion matrix with the balanced main diagonal, with 74% and 76%.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_00_03</span><span class="p">,</span> <span class="n">X_testFora_00_03</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_580_0.png" src="_images/Label_-_ob_580_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">CIRURGIA</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2004 to 2007</span>
<span class="n">xgb_fora_04_07</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_04_07</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_04_07</span><span class="p">,</span> <span class="n">y_fora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07_</span><span class="p">,</span> <span class="n">y_testFora_04_07</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_583_0.png" src="_images/Label_-_ob_583_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2004 to 2007, also shows a good performance of the model with 78% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_04_07</span><span class="p">,</span> <span class="n">X_testFora_04_07</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_585_0.png" src="_images/Label_-_ob_585_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, with a lot of advantage as seen in the previous analysis. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">G</span></code> and <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2008 to 2011</span>
<span class="n">xgb_fora_08_11</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_08_11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_08_11</span><span class="p">,</span> <span class="n">y_fora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=3, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11_</span><span class="p">,</span> <span class="n">y_testFora_08_11</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_588_0.png" src="_images/Label_-_ob_588_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states from 2008 to 2011, also shows a good performance of the model with 79% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_08_11</span><span class="p">,</span> <span class="n">X_testFora_08_11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_590_0.png" src="_images/Label_-_ob_590_0.png" />
</div>
</div>
<blockquote>
<div><p>Again we noticed that the most used feature was <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, but not with a lot of advantage. The following most important features were <code class="docutils literal notranslate"><span class="pre">REC01</span></code>, <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code> and <code class="docutils literal notranslate"><span class="pre">OUTROAPOS</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2012 to 2015</span>
<span class="n">xgb_fora_12_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_12_15</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_12_15</span><span class="p">,</span> <span class="n">y_fora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=10, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15_</span><span class="p">,</span> <span class="n">y_testFora_12_15</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_593_0.png" src="_images/Label_-_ob_593_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states data from 2012 to 2015, also shows a good performance of the model with 81% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_12_15</span><span class="p">,</span> <span class="n">X_testFora_12_15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_595_0.png" src="_images/Label_-_ob_595_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">CATEATEND</span></code>, <code class="docutils literal notranslate"><span class="pre">RADIOAPOS</span></code> and <code class="docutils literal notranslate"><span class="pre">QUIMIO</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Other states - 2016 to 2020</span>
<span class="n">xgb_fora_16_20</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                  <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">xgb_fora_16_20</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fora_16_20</span><span class="p">,</span> <span class="n">y_fora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0,
              learning_rate=0.1, max_delta_step=0, max_depth=15,
              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,
              nthread=None, objective=&#39;binary:logistic&#39;, random_state=10,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=20, seed=None,
              silent=None, subsample=1, verbosity=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20_</span><span class="p">,</span> <span class="n">y_testFora_16_20</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_598_0.png" src="_images/Label_-_ob_598_0.png" />
</div>
</div>
<blockquote>
<div><p>The confusion matrix obtained for the XGBoost, with other states from 2016 to 2020, shows the best performance comparing with the other models, with 82% of accuracy.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_feat_importances</span><span class="p">(</span><span class="n">xgb_fora_16_20</span><span class="p">,</span> <span class="n">X_testFora_16_20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Label_-_ob_600_0.png" src="_images/Label_-_ob_600_0.png" />
</div>
</div>
<blockquote>
<div><p>The four most important features were <code class="docutils literal notranslate"><span class="pre">ECGRUP</span></code>, <code class="docutils literal notranslate"><span class="pre">GLEASON</span></code>, <code class="docutils literal notranslate"><span class="pre">PSA</span></code> and <code class="docutils literal notranslate"><span class="pre">RECNENHUM</span></code>.</p>
</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Lucas Buk Cardoso.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>